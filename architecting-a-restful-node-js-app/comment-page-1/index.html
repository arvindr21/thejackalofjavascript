<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="alexaVerifyID" content="tHZTfJpU56tqERN4vjth74jHqBM"/>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="./xmlrpc.php">
<!-- <link href='http://fonts.googleapis.com/css?family=Exo+2' rel='stylesheet' type='text/css'> -->
<link rel="shortcut icon" href="./wp-content/uploads/2014/02/favicon.ico" type="image/x-icon">
<meta name="keywords" content="Javascript, HTML5, CSS3, ES6, Ecmascript, Hybrid Apps, Mobile Web Development, Desktop Apps, Apps, Arvind R, Arvind Ravulavaru, The Jackal of Javascript">
<link rel="icon" href="./wp-content/uploads/2014/02/favicon.ico" type="image/x-icon">
<!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'> -->
<link rel="stylesheet" type="text/css" href="./wp-content/cache/wpfc-minified/61cc3c87f2aa625d55d3026ecc452e96/1511014149index.css" media="all"/>
<!-- Performance scores of this site is tuned by WP Performance Score Booster plugin v1.5 - http://wordpress.org/plugins/wp-performance-score-booster -->
<!-- Jetpack Site Verification Tags -->
<meta name="google-site-verification" content="1QBi99oBZzn4xisTyRUgPd4BXjQ-6Tu09iK6V_bviIY" />
<meta name="msvalidate.01" content="33E048D3C4E943B6450230EA909E12C6" />
<meta name="p:domain_verify" content="662a829c1b5ccc13015f1cc5d00ec7e4" />
<!-- This site is optimized with the Yoast SEO plugin v3.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Architecting a Secure RESTful Node.js app | The Jackal of Javascript</title>
<meta name="description" content="Architecting a Secure RESTful Node.js app In this post, we will take a look at architecting a Node.js app that will act as a REST API server for all of our"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="./architecting-a-restful-node-js-app/" />
<link rel="publisher" href="https://plus.google.com/ArvindRavulavaru"/>
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Architecting a Secure RESTful Node.js app | The Jackal of Javascript" />
<meta property="og:description" content="Architecting a Secure RESTful Node.js app In this post, we will take a look at architecting a Node.js app that will act as a REST API server for all of our" />
<meta property="og:url" content="./architecting-a-restful-node-js-app/" />
<meta property="og:site_name" content="The Jackal of Javascript" />
<meta property="article:publisher" content="https://www.facebook.com/arvindravulavaru" />
<meta property="article:section" content="Angularjs" />
<meta property="article:published_time" content="2014-09-22T09:38:15+05:30" />
<meta property="article:modified_time" content="2014-10-01T10:32:56+05:30" />
<meta property="og:updated_time" content="2014-10-01T10:32:56+05:30" />
<meta property="og:image" content="./wp-content/uploads/2014/09/minimal-341x300.png" />
<meta property="og:image" content="./wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.25.11-pm.png" />
<meta property="og:image" content="./wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.30.01-pm-451x38.png" />
<meta property="og:image" content="./wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.35.18-pm-451x29.png" />
<meta property="og:image" content="./wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.37.08-pm-451x30.png" />
<meta property="og:image" content="./wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.40.59-pm-451x29.png" />
<meta property="og:image" content="./wp-content/uploads/2014/09/Screen-Shot-2014-09-22-at-9.02.40-am-451x104.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Architecting a Secure RESTful Node.js app In this post, we will take a look at architecting a Node.js app that will act as a REST API server for all of our" />
<meta name="twitter:title" content="Architecting a Secure RESTful Node.js app | The Jackal of Javascript" />
<meta name="twitter:site" content="@arvindr21" />
<meta name="twitter:image" content="./wp-content/uploads/2014/09/minimal-341x300.png" />
<meta name="twitter:creator" content="@arvindr21" />
<!-- / Yoast SEO plugin. -->
<script type="text/javascript">
window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":".\/wp-includes\/js\/wp-emoji-release.min.js"}};
!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
display: inline !important;
border: none !important;
box-shadow: none !important;
height: 1em !important;
width: 1em !important;
margin: 0 .07em !important;
vertical-align: -0.1em !important;
background: none !important;
padding: 0 !important;
}
</style>
<!-- <link rel='stylesheet' id='savrix-style.css-css'  href='./wp-content/plugins/savrix-android-market/savrix-style-only-play.css' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='validate-engine-css-css'  href='./wp-content/plugins/wysija-newsletters/css/validationEngine.jquery.css' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='crayon-css'  href='./wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='crayon-theme-arduino-ide-css'  href='./wp-content/plugins/crayon-syntax-highlighter/themes/arduino-ide/arduino-ide.css' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='crayon-font-droid-sans-mono-css'  href='./wp-content/plugins/crayon-syntax-highlighter/fonts/droid-sans-mono.css' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='orgseries-default-css-css'  href='./wp-content/plugins/organize-series/orgSeries.css' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='responsive-lightbox-prettyphoto-css'  href='./wp-content/plugins/responsive-lightbox/assets/prettyphoto/css/prettyPhoto.css' type='text/css' media='all' /> -->
<link rel="stylesheet" type="text/css" href="./wp-content/cache/wpfc-minified/9f9f3b5f286a1b327e6bb0fdb1185c24/1511014149index.css" media="all"/>
<link rel='stylesheet' id='font-awesome-css'  href='//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css' type='text/css' media='screen' />
<!-- <link rel='stylesheet' id='ssbaFont-css'  href='//fonts.googleapis.com/css?family=Indie+Flower&#038;ver=4.2.16' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='wpfront-notification-bar-css'  href='./wp-content/plugins/wpfront-notification-bar/css/wpfront-notification-bar.css' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='sorbet-style-css'  href='./wp-content/themes/sorbet/style.css' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='sorbet-source-sans-pro-css'  href='http://fonts.googleapis.com/css?family=Source+Sans+Pro%3A300%2C400%2C700%2C300italic%2C400italic%2C700italic&#038;subset=latin%2Clatin-ext&#038;ver=4.2.16' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='sorbet-pt-serif-css'  href='http://fonts.googleapis.com/css?family=PT+Serif%3A400%2C700%2C400italic%2C700italic&#038;subset=latin%2Clatin-ext&#038;ver=4.2.16' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='sorbet-genericons-css'  href='./wp-content/themes/sorbet/genericons/genericons.css' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='easy_table_style-css'  href='./wp-content/plugins/easy-table/themes/default/style.css' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='upprev-css-css'  href='./wp-content/plugins/upprev/styles/upprev.css' type='text/css' media='all' /> -->
<!-- <link rel='stylesheet' id='jetpack_css-css'  href='./wp-content/plugins/jetpack/css/jetpack.css' type='text/css' media='all' /> -->
<link rel="stylesheet" type="text/css" href="./wp-content/cache/wpfc-minified/3af13bcd925b3eaa358c8ad5070bb07b/1511014148index.css" media="all"/>
<!-- This site uses the Google Analytics by Yoast plugin v5.4.6 - Universal enabled - https://yoast.com/wordpress/plugins/google-analytics/ -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');
__gaTracker('create', 'UA-47881846-1', 'auto');
__gaTracker('set', 'forceSSL', true);
__gaTracker('require', 'displayfeatures');
__gaTracker('send','pageview');
</script>
<!-- / Google Analytics by Yoast -->
<script type="text/javascript">
var iworks_upprev = { animation: 'flyout', position: 'right', offset_percent: 75, offset_element: '#comments', css_width: 360, css_side: 5, compare: 'simple', url_new_window: 0, ga_track_views: 1, ga_track_clicks: 1, ga_opt_noninteraction: 1, title: 'Architecting a Secure RESTful Node.js app' };
</script>
<script src='./wp-content/cache/wpfc-minified/1f21a7a8ca343ebb57ffeb4ab24afbd9/1511014152index.js' type="text/javascript"></script>
<!-- <script type='text/javascript' src='./wp-includes/js/jquery/jquery.js'></script> -->
<!-- <script type='text/javascript' src='./wp-includes/js/jquery/jquery-migrate.min.js'></script> -->
<!-- <script type='text/javascript' src='./wp-content/plugins/jetpack/modules/related-posts/related-posts.js'></script> -->
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":".\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src='./wp-content/cache/wpfc-minified/052c748258385b6c23fc6642e73a4285/1511014152index.js' type="text/javascript"></script>
<!-- <script type='text/javascript' src='./wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js'></script> -->
<!-- <script type='text/javascript' src='./wp-content/plugins/responsive-lightbox/assets/prettyphoto/js/jquery.prettyPhoto.js'></script> -->
<script type='text/javascript'>
/* <![CDATA[ */
var rlArgs = {"script":"prettyphoto","selector":"lightbox","customEvents":"","activeGalleries":"1","animationSpeed":"normal","slideshow":"0","slideshowDelay":"5000","slideshowAutoplay":"0","opacity":"0.75","showTitle":"1","allowResize":"1","allowExpand":"1","width":"1080","height":"720","separator":"\/","theme":"pp_default","horizontalPadding":"20","hideFlash":"0","wmode":"opaque","videoAutoplay":"0","modal":"0","deeplinking":"0","overlayGallery":"1","keyboardShortcuts":"1","social":"0"};
/* ]]> */
</script>
<script src='./wp-content/cache/wpfc-minified/d57c91500961bea5aea0e849cf08f7e7/1511014151index.js' type="text/javascript"></script>
<!-- <script type='text/javascript' src='./wp-content/plugins/responsive-lightbox/js/front.js'></script> -->
<!-- <script type='text/javascript' src='./wp-content/plugins/wpfront-notification-bar/jquery-plugins/jquery.c.js'></script> -->
<!-- <script type='text/javascript' src='./wp-content/plugins/wpfront-notification-bar/js/wpfront-notification-bar.js'></script> -->
<!-- <script type='text/javascript' src='./wp-content/plugins/upprev/scripts/upprev.js'></script> -->
<script type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js'></script>
<meta name="generator" content="WordPress 4.2.16" />
<style>
.scroll-back-to-top-wrapper {
position: fixed;
opacity: 0;
visibility: hidden;
overflow: hidden;
text-align: center;
z-index: 99999999;
background-color: #777777;
color: #eeeeee;
width: 50px;
height: 48px;
line-height: 48px;
right: 30px;
bottom: 30px;
padding-top: 2px;
border-top-left-radius: 10px;
border-top-right-radius: 10px;
border-bottom-right-radius: 10px;
border-bottom-left-radius: 10px;
-webkit-transition: all 0.5s ease-in-out;
-moz-transition: all 0.5s ease-in-out;
-ms-transition: all 0.5s ease-in-out;
-o-transition: all 0.5s ease-in-out;
transition: all 0.5s ease-in-out;
}
.scroll-back-to-top-wrapper:hover {
background-color: #888888;
color: #eeeeee;
}
.scroll-back-to-top-wrapper.show {
visibility:visible;
cursor:pointer;
opacity: 1.0;
}
.scroll-back-to-top-wrapper i.fa {
line-height: inherit;
}
.scroll-back-to-top-wrapper .fa-lg {
vertical-align: 0;
}
</style><style type="text/css">	.ssba {
}
.ssba img
{
width: 35px !important;
padding: 6px;
border:  0;
box-shadow: none !important;
display: inline !important;
vertical-align: middle;
}
.ssba, .ssba a
{
text-decoration:none;
border:0;
background: none;
font-family: Indie Flower;
font-size: 	20px;
}.ssba_sharecount:after, .ssba_sharecount:before {
right: 100%;
border: solid transparent;
content: " ";
height: 0;
width: 0;
position: absolute;
pointer-events: none;
}
.ssba_sharecount:after {
border-color: rgba(224, 221, 221, 0);
border-right-color: #f5f5f5;
border-width: 5px;
top: 50%;
margin-top: -5px;
}
.ssba_sharecount:before {
border-color: rgba(85, 94, 88, 0);
border-right-color: #e0dddd;
border-width: 6px;
top: 50%;
margin-top: -6px;
}
.ssba_sharecount {
font: 11px Arial, Helvetica, sans-serif;
padding: 5px;
-khtml-border-radius: 6px;
-o-border-radius: 6px;
-webkit-border-radius: 6px;
-moz-border-radius: 6px;
border-radius: 6px;
position: relative;
border: 1px solid #e0dddd;color: #555e58;
background: #ffffff;
}
.ssba_sharecount:after {
border-right-color: #ffffff;
}</style><style id="popup-maker-themes"  type="text/css">/* Popup Theme 2995: Default Theme */
.popmake-overlay.theme-2995, .popmake-overlay.theme-default-theme { background-color: rgba( 255, 255, 255, 1 ) } 
.popmake.theme-2995, .popmake.theme-default-theme { padding: 18px; border-radius: 0px; border: 1px none #000000; box-shadow: 1px 1px 3px 0px rgba( 2, 2, 2, 0.23 ); background-color: rgba( 249, 249, 249, 1 ) } 
.popmake.theme-2995 .popmake-title, .popmake.theme-default-theme .popmake-title { color: #000000; text-align: left; text-shadow: 0px 0px 0px rgba( 2, 2, 2, 0.23 ); font-family: inherit; font-weight: inherit; font-size: 32px; font-style: normal; line-height: 36px } 
.popmake.theme-2995 .popmake-content, .popmake.theme-default-theme .popmake-content { color: #8c8c8c; font-family: inherit; font-weight: inherit; font-style: normal } 
.popmake.theme-2995 > .popmake-close, .popmake.theme-default-theme > .popmake-close { height: 20px; width: 20px; left: auto; right: 0px; bottom: auto; top: 0px; padding: 8px; color: #ffffff; font-family: inherit; font-weight: inherit; font-size: 12px; font-style: normal; line-height: 14px; border: 1px none #ffffff; border-radius: 0px; box-shadow: 0px 0px 0px 0px rgba( 2, 2, 2, 0.23 ); text-shadow: 0px 0px 0px rgba( 0, 0, 0, 0.23 ); background-color: rgba( 0, 183, 205, 1 ) } 
</style>
<link rel='dns-prefetch' href='//i0.wp.com'>
<link rel='dns-prefetch' href='//i1.wp.com'>
<link rel='dns-prefetch' href='//i2.wp.com'>
<link rel='dns-prefetch' href='//widgets.wp.com'>
<link rel='dns-prefetch' href='//s0.wp.com'>
<link rel='dns-prefetch' href='//0.gravatar.com'>
<link rel='dns-prefetch' href='//1.gravatar.com'>
<link rel='dns-prefetch' href='//2.gravatar.com'>
<style type="text/css">
#upprev_box{bottom:5px;width:360px;right:5px;display:block;right:-415px;display:block;}
</style>
</head>
<body class="single single-post postid-2043 single-format-standard right-sidebar">
<div id="page" class="hfeed site">
<header id="masthead" class="site-header" role="banner">
<div class="site-header-wrapper">
<div class="site-branding">
<h1 class="site-title"><a href="./" rel="home">The Jackal of Javascript</a></h1>
<h2 class="site-description">Knowing is different &amp; Doing is different</h2>
</div>
<div class="toggles">
<div id="menu-toggle" class="toggle active" title="Menu"><span class="screen-reader-text">Menu</span></div>
<div id="search-toggle" class="toggle" title="Search"><span class="screen-reader-text">Search</span></div>
</div>
</div>
</header><!-- #masthead -->
<div id="menu-toggle-nav" class="panel">
<nav id="site-navigation" class="main-navigation" role="navigation">
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
<div class="menu-main-container"><ul id="menu-main" class="menu"><li id="menu-item-2579" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-2579"><a href="./">Home</a></li>
<li id="menu-item-2595" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2595"><a href="./portfolio/">About  me</a></li>
<li id="menu-item-2580" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2580"><a href="./history-of-the-web/">History of the Web</a></li>
<li id="menu-item-2726" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2726"><a href="./javascript-101/">Javascript 101</a></li>
<li id="menu-item-2581" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2581"><a href="./contact-request/">Request</a></li>
</ul></div>		</nav><!-- #site-navigation -->
</div>
<div id="search-toggle-nav" class="panel">
<div class="search-wrapper">
<form role="search" method="get" class="search-form" action="./">
<label>
<span class="screen-reader-text">Search for:</span>
<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s">
</label>
<input type="submit" class="search-submit" value="Search">
</form>
</div>
</div>
<div id="content" class="site-content">
<div id="primary" class="content-area">
<main id="main" class="site-main" role="main">
<article id="post-2043" class="post-2043 post type-post status-publish format-standard hentry category-angularjs category-architecture category-expressjs category-javascript category-node category-npm category-setup category-tutorial">
<header class="entry-header">
<h1 class="entry-title">Architecting a Secure RESTful Node.js app</h1>	</header><!-- .entry-header -->
<div class="entry-content">
<!-- Simple Share Buttons Adder (6.1.5) simplesharebuttons.com --><div class="ssba ssba-wrap"><div style="text-align:left"><a href="http://twitter.com/share?url=./architecting-a-restful-node-js-app/&amp;text=Architecting+a+Secure+RESTful+Node.js+app+From+The+Jackal+of+Javascript+by+%40arvindr21" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://twitter.com/share?url=./architecting-a-restful-node-js-app/&amp;text=Architecting+a+Secure+RESTful+Node.js+app+From+The+Jackal+of+Javascript+by+%40arvindr21', '');" data-site="" class="ssba_twitter_share"   target="_blank"  rel="nofollow"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i2.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/twitter.png?w=646" title="Twitter" class="ssba ssba-img" alt="Tweet about this on Twitter" data-recalc-dims="1" /><noscript><img src="http://i2.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/twitter.png?w=646" title="Twitter" class="ssba ssba-img" alt="Tweet about this on Twitter" data-recalc-dims="1" /></noscript></a><a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=./architecting-a-restful-node-js-app/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.linkedin.com/shareArticle?mini=true&amp;url=./architecting-a-restful-node-js-app/', '');" data-site="linkedin" class="ssba_linkedin_share ssba_share_link"   target="_blank"  rel="nofollow"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i1.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/linkedin.png?w=646" title="LinkedIn" class="ssba ssba-img" alt="Share on LinkedIn" data-recalc-dims="1" /><noscript><img src="http://i1.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/linkedin.png?w=646" title="LinkedIn" class="ssba ssba-img" alt="Share on LinkedIn" data-recalc-dims="1" /></noscript></a><span class="ssba_sharecount">48</span><a href="https://plus.google.com/share?url=./architecting-a-restful-node-js-app/" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://plus.google.com/share?url=./architecting-a-restful-node-js-app/', '');" data-site="" class="ssba_google_share"   target="_blank"  rel="nofollow"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i2.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/google.png?w=646" title="Google+" class="ssba ssba-img" alt="Share on Google+" data-recalc-dims="1" /><noscript><img src="http://i2.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/google.png?w=646" title="Google+" class="ssba ssba-img" alt="Share on Google+" data-recalc-dims="1" /></noscript></a><span class="ssba_sharecount">0</span><a href="http://reddit.com/submit?url=./architecting-a-restful-node-js-app/&amp;title=Architecting a Secure RESTful Node.js app" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://reddit.com/submit?url=./architecting-a-restful-node-js-app/&amp;title=Architecting a Secure RESTful Node.js app', '');" data-site="reddit" class="ssba_reddit_share"   target="_blank"  rel="nofollow"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/reddit.png?w=646" title="Reddit" class="ssba ssba-img" alt="Share on Reddit" data-recalc-dims="1" /><noscript><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/reddit.png?w=646" title="Reddit" class="ssba ssba-img" alt="Share on Reddit" data-recalc-dims="1" /></noscript></a><span class="ssba_sharecount">0</span><a href="https://bufferapp.com/add?url=./architecting-a-restful-node-js-app/&amp;text=From The Jackal of Javascript Architecting a Secure RESTful Node.js app" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://bufferapp.com/add?url=./architecting-a-restful-node-js-app/&amp;text=From The Jackal of Javascript Architecting a Secure RESTful Node.js app', '');" data-site="buffer" class="ssba_buffer_share"   target="_blank"  rel="nofollow"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i1.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/buffer.png?w=646" title="Buffer" class="ssba ssba-img" alt="Buffer this page" data-recalc-dims="1" /><noscript><img src="http://i1.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/buffer.png?w=646" title="Buffer" class="ssba ssba-img" alt="Buffer this page" data-recalc-dims="1" /></noscript></a><a href="https://flattr.com/submit/auto?user_id=arvindr21&amp;title=Architecting a Secure RESTful Node.js app&amp;url=https://flattr.com/profile/arvindr21" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://flattr.com/submit/auto?user_id=arvindr21&amp;title=Architecting a Secure RESTful Node.js app&amp;url=https://flattr.com/profile/arvindr21', '');" data-site="flattr" class="ssba_flattr_share"   target="_blank"  rel="nofollow"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/flattr.png?w=646" title="Flattr" class="ssba ssba-img" alt="Flattr the author" data-recalc-dims="1" /><noscript><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/flattr.png?w=646" title="Flattr" class="ssba ssba-img" alt="Flattr the author" data-recalc-dims="1" /></noscript></a><a data-site="email" class="ssba_email_share" href="/cdn-cgi/l/email-protection#f9c68a8c9b939c9a8dc4b88b9a91908d9c9a8d90979ed998d9aa9c9a8c8b9cd9abbcaaad9f8c95d9b7969d9cd7938ad9988989df989489c29b969d80c4bf8b9694d9ad919cd9b3989a929895d9969fd9b3988f988a9a8b90898ddccbc9918d8d89c3d6d68d919c93989a929895969f93988f988a9a8b90898dd79a9694d6988b9a91908d9c9a8d90979ed498d48b9c8a8d9f8c95d497969d9cd4938ad4988989d6"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/email.png?w=646" title="Email" class="ssba ssba-img" alt="Email this to someone" data-recalc-dims="1" /><noscript><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/email.png?w=646" title="Email" class="ssba ssba-img" alt="Email this to someone" data-recalc-dims="1" /></noscript></a><a data-site="print" class="ssba_print ssba_share_link" href="#" onclick="window.print()"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/print.png?w=646" title="Print" class="ssba ssba-img" alt="Print this page" data-recalc-dims="1" /><noscript><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/print.png?w=646" title="Print" class="ssba ssba-img" alt="Print this page" data-recalc-dims="1" /></noscript></a></div></div><h1 class="disp-none">Architecting a Secure RESTful Node.js app</h1>
<p>In this post, we will take a look at architecting a Node.js app that will act as a REST API server for all of our clients. We will be implementing a Token Based Authentication to authenticate and authorize the client to access the application data.</p>
<p>This application design is targeted at systems that would like to implement its own REST API with a custom authentication. To showcase how one can consume the REST API with authentication, we will be writing an Angular.js client.</p>
<p>This post is inspired by <a href="http://www.kdelemme.com/2014/03/09/authentication-with-angularjs-and-a-node-js-rest-api/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.kdelemme.com/2014/03/09/authentication-with-angularjs-and-a-node-js-rest-api/', 'Authentication with AngularJS and a Node.js REST api');" title="Authentication with AngularJS and a Node.js REST api"  target="_blank">Authentication with AngularJS and a Node.js REST api</a>.</p>
<p>You can find the completed code <a href="https://github.com/arvindr21/myRESTApp" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://github.com/arvindr21/myRESTApp', 'here');" title="myRESTApp"  target="_blank">here</a>.</p>
<p>So, let us get started.<span id="more-2043"></span></p>
<h2>REST API</h2>
<p>If you are new to REST API, I would highly recommend watching the below video</p>
<p style="text-align: center;">
<!-- iframe plugin v.4.2 wordpress.org/plugins/iframe/ -->
<iframe width="560" height="315" src="//www.youtube.com/embed/7YcW25PHnAA?rel=0" frameborder="0" 0="allowfullscreen" scrolling="yes" class="iframe-class"></iframe>
</p>
<p style="text-align: left;">Also do checkout <a href="http://www.restapitutorial.com/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.restapitutorial.com/', 'restapitutorial.com');" title="restapitutorial.com"  target="_blank">restapitutorial.com</a> and <a href="http://www.restapitutorial.com/httpstatuscodes.html" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.restapitutorial.com/httpstatuscodes.html', 'HTTP Status codes');" title="HTTP Status Codes"  target="_blank">HTTP Status codes</a> for more info.</p>
<h2 style="text-align: left;">Security</h2>
<p>If you are new to implementing security or want to gain a fair idea, I would recommend watching the below video</p>
<p style="text-align: center;"> 
<!-- iframe plugin v.4.2 wordpress.org/plugins/iframe/ -->
<iframe width="560" height="315" src="//www.youtube.com/embed/E6o3IKcQABY?rel=0" frameborder="0" 0="allowfullscreen" scrolling="yes" class="iframe-class"></iframe>
</p>
<h2>Architecture</h2>
<p>The key difference between a traditional application server and a RESTful server is that the RESTful server dispatches only data for an end point and not a web page. This is very advantageous when you want to have a mobile app or a tablet app built on top of your existing application data. This way the time to market your app idea is very low. You build your application logic only once and then consume it from any RESTful client.</p>
<p>Now the question which arises is how do we know if the client accessing our REST API is genuine? Here is one of the possible solution.</p>
<p>I have used the below architecture with a couple of my projects and it seemed to be pretty sturdy.</p>
<p><a href="http://i1.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/minimal.png" data-rel="lightbox-0" title=""><img class="size-medium wp-image-2086 aligncenter" src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i2.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/minimal-341x300.png?resize=341%2C300" alt="minimal" data-recalc-dims="1" /><noscript><img class="size-medium wp-image-2086 aligncenter" src="http://i2.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/minimal-341x300.png?resize=341%2C300" alt="minimal" data-recalc-dims="1" /></noscript></a></p>
<p>As you can see from the above diagram, the architecture is pretty flexible and can be used by any client that can consume a REST API.</p>
<p>Any client which would like to access the data from our system should first fire a request to a <em>/login</em> route (<em>or endpoint</em>) with a valid username and a password. We then check if the credentials are valid. If they are valid, we would send an user object back to the client along with an access token.</p>
<p>This token has an expiration time associated with it. And the client is expected to send this token to the server everytime a request is made to fetch the data. This is our custom way of authenticating a client.</p>
<p>For your app, you can either issue a username/password for your client (<em>an Android app or Angular app</em>) to connect and make API calls or you can use your customer&#8217;s credentials to make the call too.</p>
<p>As soon as a user makes a call to one of our API endpoints, we redirect the request to the authentication middleware. This middleware is responsible for authenticating the client by first processing the token. If the token is not present/invalid or expired, it will throw a 401 HTTP status code. If the request has a valid token and is not yet expired, we will invoke the next middleware in the stack.</p>
<p>If you want, you can also add another layer of security. You can request the client to send the logged in user&#8217;s username along with the token. This way, first we will authenticate the token and then the client. This is authentication and authorization.  This approach will also help you to check if a given user is allowed to access a route and its data.</p>
<p>Simple and easy right? We will implement the same now to get a feel of the architecture.</p>
<h2>Setup the REST Server</h2>
<p>Create a new folder named <em>myRESTApp</em>. Inside that folder, create a folder named <em>server</em>. We will first create a new node project. Open a new terminal/prompt from inside the <em>server</em> folder and run</p>
<p style="text-align: center;">
<span id="crayon-5a104183ab27e480390633" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-e">npm </span><span class="crayon-v">init</span></span></span></p>
<p>Fill it up as applicable. Now, we will add a few dependencies. Run</p>
<p style="text-align: center;">
<span id="crayon-5a104183ab294821941406" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-e">npm </span><span class="crayon-v">install</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">save </span><span class="crayon-e">express </span><span class="crayon-v">body</span><span class="crayon-o">-</span><span class="crayon-e">parser </span><span class="crayon-e">morgan </span><span class="crayon-v">jwt</span><span class="crayon-o">-</span><span class="crayon-v">simple</span></span></span></p>
<p>We are going to use Express as our server side framework, jwt-simple module to generate JSON Web Tokens. These tokens will be used as access tokens between the server and client.</p>
<p>Our final <em>package.json</em> would look like</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab29c641380380" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">package.json</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
{
"name": "myRESTfulApp",
"version": "0.1.0",
"description": "myRESTfulApp",
"main": "server.js",
"scripts": {
"test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
},
"author": "Arvind Ravulavaru",
"license": "MIT",
"dependencies": {
"body-parser": "^1.8.3",
"express": "^4.9.4",
"jwt-simple": "^0.2.0",
"morgan": "^1.3.1"
}
}</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab29c641380380-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab29c641380380-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab29c641380380-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab29c641380380-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab29c641380380-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab29c641380380-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab29c641380380-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab29c641380380-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab29c641380380-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab29c641380380-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab29c641380380-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab29c641380380-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab29c641380380-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab29c641380380-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab29c641380380-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab29c641380380-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab29c641380380-17">17</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab29c641380380-1"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab29c641380380-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">"name"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"myRESTfulApp"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab29c641380380-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">"version"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"0.1.0"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab29c641380380-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">"description"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"myRESTfulApp"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab29c641380380-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">"main"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"server.js"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab29c641380380-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">"scripts"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab29c641380380-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"test"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab29c641380380-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab29c641380380-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">"author"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"Arvind Ravulavaru"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab29c641380380-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">"license"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"MIT"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab29c641380380-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">"dependencies"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab29c641380380-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"body-parser"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"^1.8.3"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab29c641380380-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"express"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"^4.9.4"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab29c641380380-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"jwt-simple"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"^0.2.0"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab29c641380380-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"morgan"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"^1.3.1"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab29c641380380-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab29c641380380-17"><span class="crayon-sy">}</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0088 seconds] -->
<p>Now, we will setup our server. At the root of <em>server</em> folder, create a file named <em>server.js</em>. This will be the entry point into our node application.</p>
<p>Update <em>server.js</em> as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab2a6293332185" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">server.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var express = require('express');
var path = require('path');
var logger = require('morgan');
var bodyParser = require('body-parser');
var app = express();
app.use(logger('dev'));
app.use(bodyParser.json());
app.all('/*', function(req, res, next) {
// CORS headers
res.header("Access-Control-Allow-Origin", "*"); // restrict it to the required domain
res.header('Access-Control-Allow-Methods', 'GET,PUT,POST,DELETE,OPTIONS');
// Set custom headers for CORS
res.header('Access-Control-Allow-Headers', 'Content-type,Accept,X-Access-Token,X-Key');
if (req.method == 'OPTIONS') {
res.status(200).end();
} else {
next();
}
});
// Auth Middleware - This will check if the token is valid
// Only the requests that start with /api/v1/* will be checked for the token.
// Any URL's that do not follow the below pattern should be avoided unless you 
// are sure that authentication is not needed
app.all('/api/v1/*', [require('./middlewares/validateRequest')]);
app.use('/', require('./routes'));
// If no route is matched by now, it must be a 404
app.use(function(req, res, next) {
var err = new Error('Not Found');
err.status = 404;
next(err);
});
// Start the server
app.set('port', process.env.PORT || 3000);
var server = app.listen(app.get('port'), function() {
console.log('Express server listening on port ' + server.address().port);
});</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-18">18</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-20">20</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-22">22</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-24">24</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-26">26</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-28">28</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-30">30</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-32">32</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-34">34</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-36">36</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-38">38</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-40">40</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-42">42</div><div class="crayon-num" data-line="crayon-5a104183ab2a6293332185-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2a6293332185-44">44</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab2a6293332185-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">express</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'express'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'path'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-3"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">logger</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'morgan'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-4"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">bodyParser</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'body-parser'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-6"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">express</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-8"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-e">logger</span><span class="crayon-sy">(</span><span class="crayon-s">'dev'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-9"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-v">bodyParser</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-10">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-11"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">all</span><span class="crayon-sy">(</span><span class="crayon-s">'/*'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">next</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// CORS headers</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">"Access-Control-Allow-Origin"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"*"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// restrict it to the required domain</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Access-Control-Allow-Methods'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'GET,PUT,POST,DELETE,OPTIONS'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-15"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// Set custom headers for CORS</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">header</span><span class="crayon-sy">(</span><span class="crayon-s">'Access-Control-Allow-Headers'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Content-type,Accept,X-Access-Token,X-Key'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">method</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'OPTIONS'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">status</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">end</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-19"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">next</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-21"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-22"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-24"><span class="crayon-c">// Auth Middleware - This will check if the token is valid</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-25"><span class="crayon-c">// Only the requests that start with /api/v1/* will be checked for the token.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-26"><span class="crayon-c">// Any URL's that do not follow the below pattern should be avoided unless you </span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-27"><span class="crayon-c">// are sure that authentication is not needed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-28"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">all</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/*'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'./middlewares/validateRequest'</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-30"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-s">'/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'./routes'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-31">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-32"><span class="crayon-c">// If no route is matched by now, it must be a 404</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-33"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">next</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-34"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">err</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Error</span><span class="crayon-sy">(</span><span class="crayon-s">'Not Found'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-35"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">err</span><span class="crayon-sy">.</span><span class="crayon-v">status</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">404</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-36"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">next</span><span class="crayon-sy">(</span><span class="crayon-v">err</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-37"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-38">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-39"><span class="crayon-c">// Start the server</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-40"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-s">'port'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">process</span><span class="crayon-sy">.</span><span class="crayon-v">env</span><span class="crayon-sy">.</span><span class="crayon-v">PORT</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-cn">3000</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-42"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">server</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">listen</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'port'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2a6293332185-43"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">'Express server listening on port '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">server</span><span class="crayon-sy">.</span><span class="crayon-e">address</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">port</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2a6293332185-44"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0184 seconds] -->
<p>Things to notice</p>
<p><strong>Line 28</strong> : The middleware that we are <em>going to write</em> to authenticate and authorize the request.</p>
<p><strong>Line 30</strong> : The list of routes for our application. We will create this file soon.</p>
<p><strong>Line 42</strong> : Start the server</p>
<p><strong>Line 11</strong> : Enable Cross Origin Resource Sharing</p>
<p>Remaining config is pretty standard Express stuff.</p>
<p><strong>[Important]</strong> : You should consider adding HTTPS support to you app. Not only for login, but for every request. You can find more info about setting up HTTPS <a href="http://www.hacksparrow.com/express-js-https.html" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.hacksparrow.com/express-js-https.html', 'here');" title="How to set up a HTTPS Express.js Server"  target="_blank">here</a>. Thanks to <a title="Ward Bell Comment" href="./architecting-a-restful-node-js-app/#comment-1614075726">Ward Bell</a> for pointing it out.</p>
<p>Now, we will work on the routes. For the purpose of this post, we will create 3 types of routes</p>
<ol>
<li>Routes that do not need authentication or authorization like the login. Or an About Us, Contact details etc.</li>
<li>Routes that need authentication to access the underlying resource. Like a list of products or any data that would be specific to the user.</li>
<li>Routes that need authentication as well as authorization. Like deleting users or updating configs etc. (<em>like an admin task</em>). For this authentication alone would not suffice, you need to be authorized to access that resource.</li>
</ol>
<p>Create a new folder named <em>routes</em> inside the <em>server</em> folder. Inside the <em>routes</em> folder create a new file named <em>index.js</em>. This file will hold all the routes needed for our app.</p>
<p>Updated <em>index.js </em> as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab2b4192479225" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">server/routes/index.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var express = require('express');
var router = express.Router();
var auth = require('./auth.js');
var products = require('./products.js');
var user = require('./users.js');
/*
* Routes that can be accessed by any one
*/
router.post('/login', auth.login);
/*
* Routes that can be accessed only by autheticated users
*/
router.get('/api/v1/products', products.getAll);
router.get('/api/v1/product/:id', products.getOne);
router.post('/api/v1/product/', products.create);
router.put('/api/v1/product/:id', products.update);
router.delete('/api/v1/product/:id', products.delete);
/*
* Routes that can be accessed only by authenticated &amp; authorized users
*/
router.get('/api/v1/admin/users', user.getAll);
router.get('/api/v1/admin/user/:id', user.getOne);
router.post('/api/v1/admin/user/', user.create);
router.put('/api/v1/admin/user/:id', user.update);
router.delete('/api/v1/admin/user/:id', user.delete);
module.exports = router;</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-18">18</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-20">20</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-22">22</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-24">24</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-26">26</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-28">28</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2b4192479225-30">30</div><div class="crayon-num" data-line="crayon-5a104183ab2b4192479225-31">31</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab2b4192479225-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">express</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'express'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">router</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">express</span><span class="crayon-sy">.</span><span class="crayon-e">Router</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-4"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">auth</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'./auth.js'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-5"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">products</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'./products.js'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-6"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">user</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'./users.js'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-8"><span class="crayon-c">/*</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-9"><span class="crayon-c"> * Routes that can be accessed by any one</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-10"><span class="crayon-c"> */</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-11"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/login'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">auth</span><span class="crayon-sy">.</span><span class="crayon-v">login</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-12">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-13"><span class="crayon-c">/*</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-14"><span class="crayon-c"> * Routes that can be accessed only by autheticated users</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-15"><span class="crayon-c"> */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-16"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/products'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">products</span><span class="crayon-sy">.</span><span class="crayon-v">getAll</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-17"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/product/:id'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">products</span><span class="crayon-sy">.</span><span class="crayon-v">getOne</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-18"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/product/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">products</span><span class="crayon-sy">.</span><span class="crayon-v">create</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-19"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/product/:id'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">products</span><span class="crayon-sy">.</span><span class="crayon-v">update</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-20"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">delete</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/product/:id'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">products</span><span class="crayon-sy">.</span><span class="crayon-v">delete</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-22"><span class="crayon-c">/*</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-23"><span class="crayon-c"> * Routes that can be accessed only by authenticated &amp; authorized users</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-24"><span class="crayon-c"> */</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-25"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/admin/users'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">getAll</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-26"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/admin/user/:id'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">getOne</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-27"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/admin/user/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">create</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-28"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/admin/user/:id'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">update</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-29"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">delete</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/admin/user/:id'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">delete</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2b4192479225-30">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2b4192479225-31"><span class="crayon-v">module</span><span class="crayon-sy">.</span><span class="crayon-v">exports</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">router</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0129 seconds] -->
<p>Things to notice</p>
<p><strong>Lines 4 &#8211; 6</strong> : Externalized the business logic for each route</p>
<p><strong>Line 11:</strong> This is the login route. A client that would like to interact with our data, should first hit this URL, get the token and then only will be authorized to access the remaining routes</p>
<p><strong>Lines 16 &#8211; 20 :</strong> A dummy set of API methods to access a product. This can be any resource you would like to expose to your clients. Do notice the <em>/api/v1/</em> at the beginning of the route. This is cue for the authentication middleware to validate the request. If you do not provide the <em>/api/v1/</em>, the validation will be skipped. As you can see from line 11.</p>
<p><strong>Line 25 &#8211; 29</strong> : A dummy set of Admin API methods to manage a user. Do notice the <em>/api/v1/. </em></p>
<p>Now, we will build the logic for each of the 3 routes. First Login. Create a new file named <em>auth.js</em> inside the <em>routes </em>folder. This file will contain the logic to authenticate the user and generate an access token when the login is successful.</p>
<p>Update <em>auth.js</em> as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab2c0279560274" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">server/routes/auth.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var jwt = require('jwt-simple');
var auth = {
login: function(req, res) {
var username = req.body.username || '';
var password = req.body.password || '';
if (username == '' || password == '') {
res.status(401);
res.json({
"status": 401,
"message": "Invalid credentials"
});
return;
}
// Fire a query to your DB and check if the credentials are valid
var dbUserObj = auth.validate(username, password);
if (!dbUserObj) { // If authentication fails, we send a 401 back
res.status(401);
res.json({
"status": 401,
"message": "Invalid credentials"
});
return;
}
if (dbUserObj) {
// If authentication is success, we will generate a token
// and dispatch it to the client
res.json(genToken(dbUserObj));
}
},
validate: function(username, password) {
// spoofing the DB response for simplicity
var dbUserObj = { // spoofing a userobject from the DB. 
name: 'arvind',
role: 'admin',
username: 'arvind@myapp.com'
};
return dbUserObj;
},
validateUser: function(username) {
// spoofing the DB response for simplicity
var dbUserObj = { // spoofing a userobject from the DB. 
name: 'arvind',
role: 'admin',
username: 'arvind@myapp.com'
};
return dbUserObj;
},
}
// private method
function genToken(user) {
var expires = expiresIn(7); // 7 days
var token = jwt.encode({
exp: expires
}, require('../config/secret')());
return {
token: token,
expires: expires,
user: user
};
}
function expiresIn(numDays) {
var dateObj = new Date();
return dateObj.setDate(dateObj.getDate() + numDays);
}
module.exports = auth;</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-18">18</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-20">20</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-22">22</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-24">24</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-26">26</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-28">28</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-30">30</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-32">32</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-34">34</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-36">36</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-38">38</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-40">40</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-42">42</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-44">44</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-46">46</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-48">48</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-50">50</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-52">52</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-54">54</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-56">56</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-58">58</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-60">60</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-62">62</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-64">64</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-66">66</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-68">68</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-70">70</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-72">72</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-74">74</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-76">76</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-78">78</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-80">80</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2c0279560274-82">82</div><div class="crayon-num" data-line="crayon-5a104183ab2c0279560274-83">83</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab2c0279560274-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">jwt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'jwt-simple'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-2">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-3"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">auth</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-4">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">login</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-6">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">username</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-v">username</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-v">password</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">username</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">status</span><span class="crayon-sy">(</span><span class="crayon-cn">401</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"status"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">401</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"message"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"Invalid credentials"</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-18">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Fire a query to your DB and check if the credentials are valid</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">dbUserObj</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">auth</span><span class="crayon-sy">.</span><span class="crayon-e">validate</span><span class="crayon-sy">(</span><span class="crayon-v">username</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-21"><span class="crayon-h">&nbsp;&nbsp; </span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">dbUserObj</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">// If authentication fails, we send a 401 back</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">status</span><span class="crayon-sy">(</span><span class="crayon-cn">401</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"status"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">401</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"message"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"Invalid credentials"</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-30">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">dbUserObj</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-32">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// If authentication is success, we will generate a token</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// and dispatch it to the client</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-35">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-e">genToken</span><span class="crayon-sy">(</span><span class="crayon-v">dbUserObj</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-38">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-39"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-40">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-41"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">validate</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">username</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// spoofing the DB response for simplicity</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">dbUserObj</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">// spoofing a userobject from the DB. </span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'arvind'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">role</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'admin'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">username</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1c7d6e6a7572785c71657d6c6c327f7371">[email&#160;protected]</a>'</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-48">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dbUserObj</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-50"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-51">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-52"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">validateUser</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">username</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// spoofing the DB response for simplicity</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">dbUserObj</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">// spoofing a userobject from the DB. </span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'arvind'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">role</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'admin'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">username</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2a4b585c43444e6a47534b5a5a04494547">[email&#160;protected]</a>'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-59">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dbUserObj</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-61"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-62"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-63">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-64"><span class="crayon-c">// private method</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-65"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">genToken</span><span class="crayon-sy">(</span><span class="crayon-v">user</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-66"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">expires</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">expiresIn</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// 7 days</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-67"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">jwt</span><span class="crayon-sy">.</span><span class="crayon-e">encode</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">exp</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">expires</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-69"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'../config/secret'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-70">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-71"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">token</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">expires</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">expires</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">user</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">user</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-75"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-76"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-77">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-78"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">expiresIn</span><span class="crayon-sy">(</span><span class="crayon-v">numDays</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-79"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">dateObj</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-r">Date</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-80"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dateObj</span><span class="crayon-sy">.</span><span class="crayon-e">setDate</span><span class="crayon-sy">(</span><span class="crayon-v">dateObj</span><span class="crayon-sy">.</span><span class="crayon-e">getDate</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">numDays</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-81"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2c0279560274-82">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2c0279560274-83"><span class="crayon-v">module</span><span class="crayon-sy">.</span><span class="crayon-v">exports</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">auth</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0265 seconds] -->
<p>Things to notice</p>
<p><strong>Line 10</strong> : If the username or password is invalid/not present, we will throw a 401</p>
<p><strong>Line 20 </strong>: At this point, we will fire a call to DB and check if the credentials are valid. To keep this example simple, I have spoofed the response as a success &amp; built a dummy DB response.</p>
<p><strong>Line 23</strong> : If the authentication fails, we send back a 401</p>
<p><strong>Line 36</strong> : If everything is fine so far, we respond with a token</p>
<p><strong>Line 65</strong> : This method is responsible for generating the JSON response that is expected from the login endpoint.</p>
<p><strong>Line 67</strong> : Generates the token with the provided expiration date and a app secret. We will create the app secret in a minute. Do note that the app secret is the only hook with which the decoding happens. If you change the secret after you dispatch a token, it may not be valid when it comes back from a client.</p>
<p>Now, we will create the secret. Create a new folder named <em>config </em>inside the <em>server </em>folder. Inside the <em>config</em> folder create a new file named <em>secret.js</em> and update it as</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab2ce330674560" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">server/config/secret.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
module.exports = function() {
return 'super.super.secret.shhh';
}</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab2ce330674560-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ce330674560-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab2ce330674560-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab2ce330674560-1"><span class="crayon-v">module</span><span class="crayon-sy">.</span><span class="crayon-v">exports</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ce330674560-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">'super.super.secret.shhh'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2ce330674560-3"><span class="crayon-sy">}</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Now, we will create the dummy API for products and users. Create a file named <em>products.js</em> inside the <em>routes</em> folder and update it as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab2e5383543341" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">routes/products.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var products = {
getAll: function(req, res) {
var allProducts = data; // Spoof a DB call
res.json(allProducts);
},
getOne: function(req, res) {
var id = req.params.id;
var product = data[0]; // Spoof a DB call
res.json(product);
},
create: function(req, res) {
var newProduct = req.body;
data.push(newProduct); // Spoof a DB call
res.json(newProduct);
},
update: function(req, res) {
var updateProduct = req.body;
var id = req.params.id;
data[id] = updateProduct // Spoof a DB call
res.json(updateProduct);
},
delete: function(req, res) {
var id = req.params.id;
data.splice(id, 1) // Spoof a DB call
res.json(true);
}
};
var data = [{
name: 'product 1',
id: '1'
}, {
name: 'product 2',
id: '2'
}, {
name: 'product 3',
id: '3'
}];
module.exports = products;</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-18">18</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-20">20</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-22">22</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-24">24</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-26">26</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-28">28</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-30">30</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-32">32</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-34">34</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-36">36</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-38">38</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-40">40</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-42">42</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2e5383543341-44">44</div><div class="crayon-num" data-line="crayon-5a104183ab2e5383543341-45">45</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab2e5383543341-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">products</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-2">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">getAll</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">allProducts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// Spoof a DB call</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-v">allProducts</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">getOne</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">params</span><span class="crayon-sy">.</span><span class="crayon-v">id</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">product</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// Spoof a DB call</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-v">product</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">create</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">newProduct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-v">newProduct</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// Spoof a DB call</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-v">newProduct</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-20"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">update</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">updateProduct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">params</span><span class="crayon-sy">.</span><span class="crayon-v">id</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">updateProduct</span><span class="crayon-h"> </span><span class="crayon-c">// Spoof a DB call</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-v">updateProduct</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-25"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-26">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-27"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">delete</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">params</span><span class="crayon-sy">.</span><span class="crayon-v">id</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">splice</span><span class="crayon-sy">(</span><span class="crayon-v">id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-c">// Spoof a DB call</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-31"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-32"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-34"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-35"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'product 1'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-36"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">id</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'1'</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-37"><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-38"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'product 2'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-39"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">id</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'2'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-40"><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-41"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'product 3'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-42"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">id</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'3'</span></div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-43"><span class="crayon-sy">}</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2e5383543341-44">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2e5383543341-45"><span class="crayon-v">module</span><span class="crayon-sy">.</span><span class="crayon-v">exports</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">products</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0099 seconds] -->
<p>And create another file named <em>users.js</em> and update it as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab2ef247032565" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">server/routes/users.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var users = {
getAll: function(req, res) {
var allusers = data; // Spoof a DB call
res.json(allusers);
},
getOne: function(req, res) {
var id = req.params.id;
var user = data[0]; // Spoof a DB call
res.json(user);
},
create: function(req, res) {
var newuser = req.body;
data.push(newuser); // Spoof a DB call
res.json(newuser);
},
update: function(req, res) {
var updateuser = req.body;
var id = req.params.id;
data[id] = updateuser // Spoof a DB call
res.json(updateuser);
},
delete: function(req, res) {
var id = req.params.id;
data.splice(id, 1) // Spoof a DB call
res.json(true);
}
};
var data = [{
name: 'user 1',
id: '1'
}, {
name: 'user 2',
id: '2'
}, {
name: 'user 3',
id: '3'
}];
module.exports = users;</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-18">18</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-20">20</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-22">22</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-24">24</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-26">26</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-28">28</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-30">30</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-32">32</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-34">34</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-36">36</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-38">38</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-40">40</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-42">42</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2ef247032565-44">44</div><div class="crayon-num" data-line="crayon-5a104183ab2ef247032565-45">45</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab2ef247032565-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">users</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-2">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">getAll</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">allusers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// Spoof a DB call</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-v">allusers</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">getOne</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">params</span><span class="crayon-sy">.</span><span class="crayon-v">id</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">user</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// Spoof a DB call</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-v">user</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">create</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">newuser</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-v">newuser</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// Spoof a DB call</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-v">newuser</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-20"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">update</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">updateuser</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">params</span><span class="crayon-sy">.</span><span class="crayon-v">id</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">updateuser</span><span class="crayon-h"> </span><span class="crayon-c">// Spoof a DB call</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-v">updateuser</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-25"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-26">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-27"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">delete</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">params</span><span class="crayon-sy">.</span><span class="crayon-v">id</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">splice</span><span class="crayon-sy">(</span><span class="crayon-v">id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-c">// Spoof a DB call</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-31"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-32"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-34"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-35"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'user 1'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-36"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">id</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'1'</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-37"><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-38"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'user 2'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-39"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">id</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'2'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-40"><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-41"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'user 3'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-42"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">id</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'3'</span></div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-43"><span class="crayon-sy">}</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2ef247032565-44">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2ef247032565-45"><span class="crayon-v">module</span><span class="crayon-sy">.</span><span class="crayon-v">exports</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">users</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0224 seconds] -->
<p>Now, we will create the validation middleware. Create a new folder named <em>middleware </em> inside the <em>server</em> folder. Inside the <i>middleware </i>folder create a new file named <em>validateRequest.js</em>. This will be the validation layer for the API requests.</p>
<p>Update <em>validateRequest.js</em> as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab2f9901868387" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">server/middlewares/validateRequest.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var jwt = require('jwt-simple');
var validateUser = require('../routes/auth').validateUser;
module.exports = function(req, res, next) {
// When performing a cross domain request, you will recieve
// a preflighted request first. This is to check if our the app
// is safe. 
// We skip the token outh for [OPTIONS] requests.
//if(req.method == 'OPTIONS') next();
var token = (req.body &amp;&amp; req.body.access_token) || (req.query &amp;&amp; req.query.access_token) || req.headers['x-access-token'];
var key = (req.body &amp;&amp; req.body.x_key) || (req.query &amp;&amp; req.query.x_key) || req.headers['x-key'];
if (token || key) {
try {
var decoded = jwt.decode(token, require('../config/secret.js')());
if (decoded.exp &lt;= Date.now()) {
res.status(400);
res.json({
"status": 400,
"message": "Token Expired"
});
return;
}
// Authorize the user to see if s/he can access our resources
var dbUser = validateUser(key); // The key would be the logged in user's username
if (dbUser) {
if ((req.url.indexOf('admin') &gt;= 0 &amp;&amp; dbUser.role == 'admin') || (req.url.indexOf('admin') &lt; 0 &amp;&amp; req.url.indexOf('/api/v1/') &gt;= 0)) {
next(); // To move to next middleware
} else {
res.status(403);
res.json({
"status": 403,
"message": "Not Authorized"
});
return;
}
} else {
// No user with this name exists, respond back with a 401
res.status(401);
res.json({
"status": 401,
"message": "Invalid User"
});
return;
}
} catch (err) {
res.status(500);
res.json({
"status": 500,
"message": "Oops something went wrong",
"error": err
});
}
} else {
res.status(401);
res.json({
"status": 401,
"message": "Invalid Token or Key"
});
return;
}
};</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-18">18</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-20">20</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-22">22</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-24">24</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-26">26</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-28">28</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-30">30</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-32">32</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-34">34</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-36">36</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-38">38</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-40">40</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-42">42</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-44">44</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-46">46</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-48">48</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-50">50</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-52">52</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-54">54</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-56">56</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-58">58</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-60">60</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-62">62</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-64">64</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-66">66</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-68">68</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab2f9901868387-70">70</div><div class="crayon-num" data-line="crayon-5a104183ab2f9901868387-71">71</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab2f9901868387-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">jwt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'jwt-simple'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">validateUser</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'../routes/auth'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">validateUser</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-4"><span class="crayon-v">module</span><span class="crayon-sy">.</span><span class="crayon-v">exports</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">next</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// When performing a cross domain request, you will recieve</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// a preflighted request first. This is to check if our the app</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// is safe. </span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// We skip the token outh for [OPTIONS] requests.</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//if(req.method == 'OPTIONS') next();</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-12">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-v">access_token</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">query</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">query</span><span class="crayon-sy">.</span><span class="crayon-v">access_token</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">headers</span><span class="crayon-sy">[</span><span class="crayon-s">'x-access-token'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">body</span><span class="crayon-sy">.</span><span class="crayon-v">x_key</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">query</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">query</span><span class="crayon-sy">.</span><span class="crayon-v">x_key</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">headers</span><span class="crayon-sy">[</span><span class="crayon-s">'x-key'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">decoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">jwt</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-v">token</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'../config/secret.js'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">decoded</span><span class="crayon-sy">.</span><span class="crayon-v">exp</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-v">Date</span><span class="crayon-sy">.</span><span class="crayon-e">now</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">status</span><span class="crayon-sy">(</span><span class="crayon-cn">400</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"status"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">400</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"message"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"Token Expired"</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-28">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Authorize the user to see if s/he can access our resources</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-30">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">dbUser</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">validateUser</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// The key would be the logged in user's username</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">dbUser</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-34">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">url</span><span class="crayon-sy">.</span><span class="crayon-e">indexOf</span><span class="crayon-sy">(</span><span class="crayon-s">'admin'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">dbUser</span><span class="crayon-sy">.</span><span class="crayon-v">role</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'admin'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">url</span><span class="crayon-sy">.</span><span class="crayon-e">indexOf</span><span class="crayon-sy">(</span><span class="crayon-s">'admin'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">url</span><span class="crayon-sy">.</span><span class="crayon-e">indexOf</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">next</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// To move to next middleware</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">status</span><span class="crayon-sy">(</span><span class="crayon-cn">403</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"status"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">403</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"message"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"Not Authorized"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// No user with this name exists, respond back with a 401</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">status</span><span class="crayon-sy">(</span><span class="crayon-cn">401</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"status"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">401</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"message"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"Invalid User"</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-54">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">catch</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">err</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">status</span><span class="crayon-sy">(</span><span class="crayon-cn">500</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"status"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">500</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"message"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"Oops something went wrong"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"error"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">err</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-63"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">status</span><span class="crayon-sy">(</span><span class="crayon-cn">401</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">res</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"status"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">401</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"message"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"Invalid Token or Key"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab2f9901868387-70"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab2f9901868387-71"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0388 seconds] -->
<p>Things to notice</p>
<p><strong>Line 13,14</strong> : We search for a token/key and in the request. This is the access token we have issued post successful login and key is the current logged in user&#8217;s username.</p>
<p><strong>Line 18</strong> : We decode the token and check its validity on line 20</p>
<p><strong>Line 31</strong> : We hit the DB to check if the current user is a valid user and also fetch his role.</p>
<p><strong>Line 35</strong> : We validate role vs url accessed and allow or deny accordingly.</p>
<p>All the other else cases would dispatch appropriate HTTP status codes.</p>
<p>That is all we need to build a secure REST API.</p>
<h2>Testing the REST API</h2>
<p>The process is pretty simple. First, we will fire a request to the <em>login</em> end point with dummy credentials. The response will contain a user object and the access token. Since we have spoofed the response to be a success, you will get a success response always. In your actual app, update this login to valid authentication.</p>
<p>Using that access token, we will make further request to our API.</p>
<p>I will be using CURL to fire the REST requests, you can use any REST client to do so.</p>
<p>Start our server by running</p>
<p style="text-align: center;">
<span id="crayon-5a104183ab307989970705" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-e">node </span><span class="crayon-v">server</span><span class="crayon-sy">.</span><span class="crayon-v">js</span></span></span>  or 
<span id="crayon-5a104183ab30f950779207" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-e">nodemon </span><span class="crayon-v">server</span><span class="crayon-sy">.</span><span class="crayon-v">js</span></span></span></p>
<h3>Brute Force</h3>
<p>Without any token, let us fire a request to get all the products</p>
<p><strong>URL</strong> : curl http://localhost:3000/api/v1/products</p>
<p><a href="http://i2.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.25.11-pm.png" data-rel="lightbox-1" title=""><img class="size-full wp-image-2095 aligncenter" src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i2.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.25.11-pm.png?resize=353%2C41" alt="Screen Shot 2014-09-21 at 11.25.11 pm" data-recalc-dims="1" /><noscript><img class="size-full wp-image-2095 aligncenter" src="http://i2.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.25.11-pm.png?resize=353%2C41" alt="Screen Shot 2014-09-21 at 11.25.11 pm" data-recalc-dims="1" /></noscript></a></p>
<p>As expected you will get a 401. You can also dispatch a 403 unauthorized here.</p>
<h3>Login</h3>
<p>Now, let us try logging in.</p>
<p><strong>URL</strong> : curl &#8211;data &#8220;{\&#8221;username\&#8221; : \&#8221;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d3b2a1a5babdb793beaab2a3a3fdb0bcbe">[email&#160;protected]</a>\&#8221;, \&#8221;password\&#8221; : \&#8221;pass123\&#8221;}&#8221; -H &#8220;content-type:application/json&#8221; http://localhost:3000/login</p>
<p>The username and password above are dummy. Do notice the header content-type. Without this, Bodyparser will not kick in. And the response would consist of a token and the user object.</p>
<p><a href="http://i1.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.30.01-pm.png" data-rel="lightbox-2" title=""><img class="size-medium wp-image-2097 aligncenter" src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i0.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.30.01-pm-451x38.png?resize=451%2C38" alt="Screen Shot 2014-09-21 at 11.30.01 pm" data-recalc-dims="1" /><noscript><img class="size-medium wp-image-2097 aligncenter" src="http://i0.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.30.01-pm-451x38.png?resize=451%2C38" alt="Screen Shot 2014-09-21 at 11.30.01 pm" data-recalc-dims="1" /></noscript></a></p>
<p>Now, we will make a copy of the token and we need to send this in the headers from now on.</p>
<h3>Fetch Products</h3>
<p>To fetch all products, you would run</p>
<p><strong>URL</strong> : curl -H &#8220;content-type:application/json&#8221; -H &#8220;x-access-token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0MTE5MjcyMDAzNjl9.cuUKFKsf2qhQJHToP-zBmObhMwi84rhnrhH03OdyzSA&#8221; -H &#8220;x-key:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7b1a090d12151f3b16021a0b0b55181416">[email&#160;protected]</a>&#8221; http://localhost:3000/api/v1/products</p>
<p><em>Do notice that I have updated the token in the above URL. Make sure you update the token before firing the request.</em></p>
<p>Do notice that we have another header named key. This will consist of the current logged in user&#8217;s username.</p>
<p>And we would get the response back as</p>
<h3><a href="http://i2.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.35.18-pm.png" data-rel="lightbox-3" title=""><img class="size-medium wp-image-2098 aligncenter" src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i2.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.35.18-pm-451x29.png?resize=451%2C29" alt="Screen Shot 2014-09-21 at 11.35.18 pm" data-recalc-dims="1" /><noscript><img class="size-medium wp-image-2098 aligncenter" src="http://i2.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.35.18-pm-451x29.png?resize=451%2C29" alt="Screen Shot 2014-09-21 at 11.35.18 pm" data-recalc-dims="1" /></noscript></a>Admin resources</h3>
<p>Since we have hardcoded the role for the current user to be admin, we will be able to access the admin URL&#8217;s too. You can fire a request like</p>
<p><strong>URL</strong> : curl -H &#8220;content-type:application/json&#8221; -H &#8220;x-access-token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0MTE5MjcyMDAzNjl9.cuUKFKsf2qhQJHToP-zBmObhMwi84rhnrhH03OdyzSA&#8221; -H &#8220;x-key:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="49283b3f20272d092430283939672a2624">[email&#160;protected]</a>&#8221; http://localhost:3000/api/v1/admin/users</p>
<p>And you should see the response like</p>
<p><a href="http://i1.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.37.08-pm.png" data-rel="lightbox-4" title=""><img class="size-medium wp-image-2099 aligncenter" src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i0.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.37.08-pm-451x30.png?resize=451%2C30" alt="Screen Shot 2014-09-21 at 11.37.08 pm" data-recalc-dims="1" /><noscript><img class="size-medium wp-image-2099 aligncenter" src="http://i0.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.37.08-pm-451x30.png?resize=451%2C30" alt="Screen Shot 2014-09-21 at 11.37.08 pm" data-recalc-dims="1" /></noscript></a>Now, let us test the authorization part. Navigate to <i>routes/auth.js</i> line 56, set the role to &#8216;user&#8217; and restart the server</p>
<p>Now, fire the request to get all users</p>
<p><strong>URL</strong> : curl -H &#8220;content-type:application/json&#8221; -H &#8220;x-access-token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0MTE5MjcyMDAzNjl9.cuUKFKsf2qhQJHToP-zBmObhMwi84rhnrhH03OdyzSA&#8221; -H &#8220;x-key:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="650417130c0b0125081c0415154b060a08">[email&#160;protected]</a>&#8221; http://localhost:3000/api/v1/admin/users</p>
<p>and you should see a &#8220;Not Authorized&#8221; error as expected.<a href="http://i1.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.40.59-pm.png" data-rel="lightbox-5" title=""><img class="size-medium wp-image-2100 aligncenter" src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i0.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.40.59-pm-451x29.png?resize=451%2C29" alt="Screen Shot 2014-09-21 at 11.40.59 pm" data-recalc-dims="1" /><noscript><img class="size-medium wp-image-2100 aligncenter" src="http://i0.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-21-at-11.40.59-pm-451x29.png?resize=451%2C29" alt="Screen Shot 2014-09-21 at 11.40.59 pm" data-recalc-dims="1" /></noscript></a>Simple and easy right!!</p>
<h2>Angular.js Client</h2>
<p>Now, we will build an Angular.js client that will consume the above API. Inside the <em>myRESTApp</em> folder, create another folder named <em>ngClient</em>. Open a new terminal/prompt here.</p>
<p>We will use a slush generator named <a href="https://github.com/arvindr21/slush-ng" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://github.com/arvindr21/slush-ng', 'slush-ng');" title="slush-ng"  target="_blank">slush-ng</a> (<em>written by me</em>) to scaffold a minimal Angular.js app. For that we will install gulp, slush and slush-ng globally. Execute</p>
<div class="table-responsive"><table  style="width:100%; "  class="easy-table easy-table-default " border="0">
<thead>
<tr><th >Windows</th>
<th > Mac/*nix</th>
</tr>
</thead>
<tbody>
<tr><td >
<span id="crayon-5a104183ab320633896065" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-i">npm</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">g</span><span class="crayon-h"> </span><span class="crayon-e">gulp </span><span class="crayon-e">slush </span><span class="crayon-v">slush</span><span class="crayon-o">-</span><span class="crayon-v">ng</span></span></span> </td>
<td > 
<span id="crayon-5a104183ab327196375140" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-e">sudo </span><span class="crayon-i">npm</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">g</span><span class="crayon-h"> </span><span class="crayon-e">gulp </span><span class="crayon-e">slush </span><span class="crayon-v">slush</span><span class="crayon-o">-</span><span class="crayon-v">ng</span></span></span></td>
</tr>
</tbody></table></div>
<p>Once this is done, from inside the <em>ngClient </em>folder, run</p>
<p style="text-align: center;">
<span id="crayon-5a104183ab32e576745609" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-e">slush </span><span class="crayon-v">ng</span></span></span></p>
<p>You can provide any name to your project. And slush will scaffold a minimal angular app and download the required dependencies.</p>
<p>To run the Angular.js app as is, we will run</p>
<p style="text-align: center;">
<span id="crayon-5a104183ab335911439444" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">gulp</span></span></span></p>
<p>This will start a new server on port 2772. Now you can navigate to 
<span id="crayon-5a104183ab33b042114410" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//localhost:2772</span></span></span> to see the scaffolded app in action.</p>
<p>This app is configured with routes, a sample directive a sample filter and an integration with the service layer. All you need to start off with a minimal Angular.js app.</p>
<h3>Authentication Layer</h3>
<p>The first thing we are going to do is setup an authentication factory on the client. Create a new folder named <em>auth </em>inside the <em>js</em> folder. Inside this folder, create a new file named <em>auth.factory.js</em>.</p>
<p>Update <em>auth.factory.js</em> as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab343493034411" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">ngClient/js/factory/auth.factory.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
myApp.factory('AuthenticationFactory', function($window) {
var auth = {
isLogged: false,
check: function() {
if ($window.sessionStorage.token &amp;&amp; $window.sessionStorage.user) {
this.isLogged = true;
} else {
this.isLogged = false;
delete this.user;
}
}
}
return auth;
});
myApp.factory('UserAuthFactory', function($window, $location, $http, AuthenticationFactory) {
return {
login: function(username, password) {
return $http.post('http://localhost:3000/login', {
username: username,
password: password
});
},
logout: function() {
if (AuthenticationFactory.isLogged) {
AuthenticationFactory.isLogged = false;
delete AuthenticationFactory.user;
delete AuthenticationFactory.userRole;
delete $window.sessionStorage.token;
delete $window.sessionStorage.user;
delete $window.sessionStorage.userRole;
$location.path("/login");
}
}
}
});
myApp.factory('TokenInterceptor', function($q, $window) {
return {
request: function(config) {
config.headers = config.headers || {};
if ($window.sessionStorage.token) {
config.headers['X-Access-Token'] = $window.sessionStorage.token;
config.headers['X-Key'] = $window.sessionStorage.user;
config.headers['Content-Type'] = "application/json";
}
return config || $q.when(config);
},
response: function(response) {
return response || $q.when(response);
}
};
});</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab343493034411-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-18">18</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-20">20</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-22">22</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-24">24</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-26">26</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-28">28</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-30">30</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-32">32</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-34">34</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-36">36</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-38">38</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-40">40</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-42">42</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-44">44</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-46">46</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-48">48</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-50">50</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-52">52</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-54">54</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-56">56</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-58">58</div><div class="crayon-num" data-line="crayon-5a104183ab343493034411-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab343493034411-60">60</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab343493034411-1"><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-e">factory</span><span class="crayon-sy">(</span><span class="crayon-s">'AuthenticationFactory'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-r">window</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">auth</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">isLogged</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">check</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">isLogged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">isLogged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">delete</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">auth</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-15"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-16">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab343493034411-17"><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-e">factory</span><span class="crayon-sy">(</span><span class="crayon-s">'UserAuthFactory'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-r">window</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-r">location</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">http</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">login</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">username</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'http://localhost:3000/login'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">username</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">username</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">password</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">password</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">logout</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-26">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab343493034411-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">isLogged</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-28">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab343493034411-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">isLogged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">delete</span><span class="crayon-h"> </span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">delete</span><span class="crayon-h"> </span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">userRole</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-32">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab343493034411-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">delete</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">delete</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">delete</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">userRole</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-36">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab343493034411-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">location</span><span class="crayon-sy">.</span><span class="crayon-e">path</span><span class="crayon-sy">(</span><span class="crayon-s">"/login"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-39">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-41"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-42"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-43">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-44"><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-e">factory</span><span class="crayon-sy">(</span><span class="crayon-s">'TokenInterceptor'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-r">window</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-45"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">request</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">headers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">headers</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">headers</span><span class="crayon-sy">[</span><span class="crayon-s">'X-Access-Token'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">headers</span><span class="crayon-sy">[</span><span class="crayon-s">'X-Key'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">headers</span><span class="crayon-sy">[</span><span class="crayon-s">'Content-Type'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"application/json"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">q</span><span class="crayon-sy">.</span><span class="crayon-e">when</span><span class="crayon-sy">(</span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-55">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">response</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">q</span><span class="crayon-sy">.</span><span class="crayon-e">when</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab343493034411-59"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab343493034411-60"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0345 seconds] -->
<p>Things to notice</p>
<p><strong>Line 1</strong> : <em>AuthenticationFactory. </em>This Factory is responsible for checking the user status on the client side.</p>
<p><strong>Line 17</strong> : <em>UserAuthFactory</em>. This factory is responsible for contacting the <em>login</em> endpoint and validating the user. And also logging out the user.</p>
<p><strong>Line 44</strong> : <em>TokenInterceptor</em>. This factory is responsible for sending in the access token and the key along with each request to the server.</p>
<p>Next, we will create a controller to manage the login. Create a file named <em>auth.controller.js</em> inside the <em>auth</em> folder. Update it as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab34f936081930" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">ngClient/js/auth/auth.controller.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
myApp.controller('LoginCtrl', ['$scope', '$window', '$location', 'UserAuthFactory', 'AuthenticationFactory',
function($scope, $window, $location, UserAuthFactory, AuthenticationFactory) {
$scope.user = {
username: 'arvind@myApp.com',
password: 'pass123'
};
$scope.login = function() {
var username = $scope.user.username,
password = $scope.user.password;
if (username !== undefined &amp;&amp; password !== undefined) {
UserAuthFactory.login(username, password).success(function(data) {
AuthenticationFactory.isLogged = true;
AuthenticationFactory.user = data.user.username;
AuthenticationFactory.userRole = data.user.role;
$window.sessionStorage.token = data.token;
$window.sessionStorage.user = data.user.username; // to fetch the user details on refresh
$window.sessionStorage.userRole = data.user.role; // to fetch the user details on refresh
$location.path("/");
}).error(function(status) {
alert('Oops something went wrong!');
});
} else {
alert('Invalid credentials');
}
};
}
]);</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-18">18</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-20">20</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-22">22</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-24">24</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-26">26</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-28">28</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-30">30</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-32">32</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-34">34</div><div class="crayon-num" data-line="crayon-5a104183ab34f936081930-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab34f936081930-36">36</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab34f936081930-1"><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-e">controller</span><span class="crayon-sy">(</span><span class="crayon-s">'LoginCtrl'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'$scope'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'$window'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'$location'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'UserAuthFactory'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'AuthenticationFactory'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-r">window</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-r">location</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">UserAuthFactory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">username</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="accddedac5c2c8ecc1d5eddcdc82cfc3c1">[email&#160;protected]</a>'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">password</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'pass123'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">.</span><span class="crayon-v">login</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">username</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">username</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">password</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">password</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-12">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab34f936081930-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">username</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-v">undefined</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-v">undefined</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">UserAuthFactory</span><span class="crayon-sy">.</span><span class="crayon-e">login</span><span class="crayon-sy">(</span><span class="crayon-v">username</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">success</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">isLogged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">username</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">userRole</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">role</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">username</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// to fetch the user details on refresh</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">userRole</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">role</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// to fetch the user details on refresh</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">location</span><span class="crayon-sy">.</span><span class="crayon-e">path</span><span class="crayon-sy">(</span><span class="crayon-s">"/"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">error</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-r">status</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-s">'Oops something went wrong!'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">alert</span><span class="crayon-sy">(</span><span class="crayon-s">'Invalid credentials'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab34f936081930-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-32">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab34f936081930-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-34">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab34f936081930-35"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab34f936081930-36"><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0223 seconds] -->
<p>Things to notice</p>
<p><strong>Line 3</strong> : We hard code a user, for easy testing (<em>lazy</em>)</p>
<p><strong>Line 14</strong> : We fire a request to the Login endpoint</p>
<p><strong>Line 16 &#8211; 22</strong> : We set client side session variables. We store the values in the <em>AuthenticationFactory</em> as well as <em>sessionStorage</em>. This way, if the user refreshes, we will still have the session on the client side.</p>
<p><strong>Line 24</strong> : Upon successful login, we will redirect the user to the home page.</p>
<p>On the client side, we will create a partial for Login. Inside the <em>partials </em>folder, create a new file named <em>login.html</em> and update it as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab35a763365756" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">ngClient/partials/login.html</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;legend&gt;Login Form&lt;/legend&gt;
&lt;div class="form-group"&gt;
&lt;label for="username"&gt;Username&lt;/label&gt;
&lt;input type="text" class="form-control" id="username" placeholder="Username" ng-model="user.username"&gt;
&lt;/div&gt;
&lt;div class="form-group"&gt;
&lt;label for="password"&gt;Password&lt;/label&gt;
&lt;input type="password" class="form-control" id="password" placeholder="Password" ng-model="user.password"&gt;
&lt;/div&gt;
&lt;button type="button" ng-click="login()" class="btn btn-primary"&gt;Submit&lt;/button&gt;</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab35a763365756-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab35a763365756-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab35a763365756-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab35a763365756-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab35a763365756-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab35a763365756-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab35a763365756-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab35a763365756-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab35a763365756-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab35a763365756-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab35a763365756-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab35a763365756-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab35a763365756-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab35a763365756-1"><span class="crayon-o">&lt;</span><span class="crayon-v">legend</span><span class="crayon-o">&gt;</span><span class="crayon-e">Login </span><span class="crayon-v">Form</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">legend</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab35a763365756-2">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab35a763365756-3"><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"form-group"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab35a763365756-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">label </span><span class="crayon-st">for</span><span class="crayon-o">=</span><span class="crayon-s">"username"</span><span class="crayon-o">&gt;</span><span class="crayon-v">Username</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">label</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab35a763365756-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"text"</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"form-control"</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"username"</span><span class="crayon-h"> </span><span class="crayon-v">placeholder</span><span class="crayon-o">=</span><span class="crayon-s">"Username"</span><span class="crayon-h"> </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">model</span><span class="crayon-o">=</span><span class="crayon-s">"user.username"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab35a763365756-6"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab35a763365756-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab35a763365756-8"><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"form-group"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab35a763365756-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">label </span><span class="crayon-st">for</span><span class="crayon-o">=</span><span class="crayon-s">"password"</span><span class="crayon-o">&gt;</span><span class="crayon-v">Password</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">label</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab35a763365756-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"password"</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"form-control"</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"password"</span><span class="crayon-h"> </span><span class="crayon-v">placeholder</span><span class="crayon-o">=</span><span class="crayon-s">"Password"</span><span class="crayon-h"> </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">model</span><span class="crayon-o">=</span><span class="crayon-s">"user.password"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab35a763365756-11"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab35a763365756-12">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab35a763365756-13"><span class="crayon-o">&lt;</span><span class="crayon-e">button </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"button"</span><span class="crayon-h"> </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">click</span><span class="crayon-o">=</span><span class="crayon-s">"login()"</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"btn btn-primary"</span><span class="crayon-o">&gt;</span><span class="crayon-v">Submit</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">button</span><span class="crayon-o">&gt;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0104 seconds] -->
<p>This partial will be associated with a Login Controller, which we created in <em>auth.controller.js</em>.</p>
<p>Now, we will setup our app. Open <i>js/app.js</i> and update it as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab363905832264" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">ngClient/js/app.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var myApp = angular.module('ngclient', ['ngRoute']);
myApp.config(function($routeProvider, $httpProvider) {
$httpProvider.interceptors.push('TokenInterceptor');
$routeProvider
.when('/login', {
templateUrl: 'partials/login.html',
controller: 'LoginCtrl',
access: {
requiredLogin: false
}
}).when('/', {
templateUrl: 'partials/home.html',
controller: 'HomeCtrl',
access: {
requiredLogin: true
}
}).when('/page1', {
templateUrl: 'partials/page1.html',
controller: 'Page1Ctrl',
access: {
requiredLogin: true
}
}).when('/page2', {
templateUrl: 'partials/page2.html',
controller: 'Page2Ctrl',
access: {
requiredLogin: true
}
}).when('/page3', {
templateUrl: 'partials/page3.html',
controller: 'Page3Ctrl',
access: {
requiredLogin: true
}
}).otherwise({
redirectTo: '/login'
});
});
myApp.run(function($rootScope, $window, $location, AuthenticationFactory) {
// when the page refreshes, check if the user is already logged in
AuthenticationFactory.check();
$rootScope.$on("$routeChangeStart", function(event, nextRoute, currentRoute) {
if ((nextRoute.access &amp;&amp; nextRoute.access.requiredLogin) &amp;&amp; !AuthenticationFactory.isLogged) {
$location.path("/login");
} else {
// check if user object exists else fetch it. This is incase of a page refresh
if (!AuthenticationFactory.user) AuthenticationFactory.user = $window.sessionStorage.user;
if (!AuthenticationFactory.userRole) AuthenticationFactory.userRole = $window.sessionStorage.userRole;
}
});
$rootScope.$on('$routeChangeSuccess', function(event, nextRoute, currentRoute) {
$rootScope.showMenu = AuthenticationFactory.isLogged;
$rootScope.role = AuthenticationFactory.userRole;
// if the user is already logged in, take him to the home page
if (AuthenticationFactory.isLogged == true &amp;&amp; $location.path() == '/login') {
$location.path('/');
}
});
});</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab363905832264-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-18">18</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-20">20</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-22">22</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-24">24</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-26">26</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-28">28</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-30">30</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-32">32</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-34">34</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-36">36</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-38">38</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-40">40</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-42">42</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-44">44</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-46">46</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-48">48</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-50">50</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-52">52</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-54">54</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-56">56</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-58">58</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-60">60</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-62">62</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab363905832264-64">64</div><div class="crayon-num" data-line="crayon-5a104183ab363905832264-65">65</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab363905832264-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">myApp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">angular</span><span class="crayon-sy">.</span><span class="crayon-e">module</span><span class="crayon-sy">(</span><span class="crayon-s">'ngclient'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'ngRoute'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-2">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab363905832264-3"><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-e">config</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">routeProvider</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">httpProvider</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-4">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab363905832264-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">httpProvider</span><span class="crayon-sy">.</span><span class="crayon-v">interceptors</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-s">'TokenInterceptor'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-6">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab363905832264-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-i">routeProvider</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-e">when</span><span class="crayon-sy">(</span><span class="crayon-s">'/login'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">templateUrl</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'partials/login.html'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">controller</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'LoginCtrl'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">access</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">requiredLogin</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">false</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">when</span><span class="crayon-sy">(</span><span class="crayon-s">'/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">templateUrl</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'partials/home.html'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">controller</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'HomeCtrl'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">access</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">requiredLogin</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">true</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">when</span><span class="crayon-sy">(</span><span class="crayon-s">'/page1'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">templateUrl</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'partials/page1.html'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">controller</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'Page1Ctrl'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">access</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">requiredLogin</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">true</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">when</span><span class="crayon-sy">(</span><span class="crayon-s">'/page2'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">templateUrl</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'partials/page2.html'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">controller</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'Page2Ctrl'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">access</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">requiredLogin</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">true</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">when</span><span class="crayon-sy">(</span><span class="crayon-s">'/page3'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">templateUrl</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'partials/page3.html'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">controller</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'Page3Ctrl'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">access</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">requiredLogin</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">true</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">otherwise</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">redirectTo</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'/login'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-41"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-42">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab363905832264-43"><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">rootScope</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-r">window</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-r">location</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-44"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// when the page refreshes, check if the user is already logged in</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-45"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-e">check</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-46">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab363905832264-47"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">rootScope</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-s">"$routeChangeStart"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">event</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nextRoute</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentRoute</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">nextRoute</span><span class="crayon-sy">.</span><span class="crayon-v">access</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">nextRoute</span><span class="crayon-sy">.</span><span class="crayon-v">access</span><span class="crayon-sy">.</span><span class="crayon-v">requiredLogin</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">isLogged</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">location</span><span class="crayon-sy">.</span><span class="crayon-e">path</span><span class="crayon-sy">(</span><span class="crayon-s">"/login"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// check if user object exists else fetch it. This is incase of a page refresh</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">userRole</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">userRole</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">userRole</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-55"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-56">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab363905832264-57"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">rootScope</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-s">'$routeChangeSuccess'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">event</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nextRoute</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentRoute</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">rootScope</span><span class="crayon-sy">.</span><span class="crayon-v">showMenu</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">isLogged</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">rootScope</span><span class="crayon-sy">.</span><span class="crayon-v">role</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">userRole</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// if the user is already logged in, take him to the home page</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">isLogged</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">location</span><span class="crayon-sy">.</span><span class="crayon-e">path</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'/login'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">location</span><span class="crayon-sy">.</span><span class="crayon-e">path</span><span class="crayon-sy">(</span><span class="crayon-s">'/'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab363905832264-64"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab363905832264-65"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0334 seconds] -->
<p>Things to notice</p>
<p><strong>Line 5</strong> : We have added the <em>TokenInterceptor.</em></p>
<p><strong>Line 8</strong> : New route <em>/login</em></p>
<p><strong>Line 12,18,24,30,36</strong> : Setting if the current route needs authentication.</p>
<p><strong>Line 43</strong> : We set up a few session variables to keep a track of user&#8217;s session. These variables are stored both in memory as well as browser&#8217;s session storage (<em>in case of a full page refresh we do not want the user to login again</em>).</p>
<p>Now, we will add the logout link. Open <em>partials/header.html</em> and update it as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab36f650856608" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">ngClient/partials/header.html</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;div class="navbar navbar-default navbar-fixed-top" role="navigation" ng-controller="HeaderCtrl"&gt;
&lt;div class="container"&gt;
&lt;div class="navbar-header"&gt;
&lt;button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse" ng-show="showMenu"&gt;
&lt;span class="sr-only"&gt;Toggle navigation&lt;/span&gt;
&lt;span class="icon-bar"&gt;&lt;/span&gt;
&lt;span class="icon-bar"&gt;&lt;/span&gt;
&lt;span class="icon-bar"&gt;&lt;/span&gt;
&lt;/button&gt; &lt;a class="navbar-brand" href="#/"&gt;ngClient&lt;/a&gt;
&lt;/div&gt;
&lt;div class="collapse navbar-collapse"&gt;
&lt;ul class="nav navbar-nav" ng-show="showMenu"&gt;
&lt;li ng-class="{active:isActive('/')}"&gt;&lt;a href="#"&gt;Home&lt;/a&gt;
&lt;/li&gt;
&lt;li ng-class="{active:isActive('/page1')}"&gt;&lt;a ng-href="#/page1"&gt;Page 1 (Sample Directive)&lt;/a&gt;
&lt;/li&gt;
&lt;li ng-class="{active:isActive('/page2')}"&gt;&lt;a ng-href="#/page2"&gt;Page 2 (Sample Filter)&lt;/a&gt;
&lt;/li&gt;
&lt;li ng-class="{active:isActive('/page3')}"&gt;&lt;a ng-href="#/page3"&gt;Page 3 (Sample Factory)&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="javascript:" ng-click="logout()"&gt;Logout&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-18">18</div><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-20">20</div><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-22">22</div><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-24">24</div><div class="crayon-num" data-line="crayon-5a104183ab36f650856608-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab36f650856608-26">26</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab36f650856608-1"><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"navbar navbar-default navbar-fixed-top"</span><span class="crayon-h"> </span><span class="crayon-v">role</span><span class="crayon-o">=</span><span class="crayon-s">"navigation"</span><span class="crayon-h"> </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">controller</span><span class="crayon-o">=</span><span class="crayon-s">"HeaderCtrl"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"container"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab36f650856608-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"navbar-header"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">button </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"button"</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"navbar-toggle collapsed"</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-o">-</span><span class="crayon-v">toggle</span><span class="crayon-o">=</span><span class="crayon-s">"collapse"</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-o">-</span><span class="crayon-v">target</span><span class="crayon-o">=</span><span class="crayon-s">".navbar-collapse"</span><span class="crayon-h"> </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">show</span><span class="crayon-o">=</span><span class="crayon-s">"showMenu"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab36f650856608-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">span </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"sr-only"</span><span class="crayon-o">&gt;</span><span class="crayon-e">Toggle </span><span class="crayon-v">navigation</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">span</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">span </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"icon-bar"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">span</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab36f650856608-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">span </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"icon-bar"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">span</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">span </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"icon-bar"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">span</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab36f650856608-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">button</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"navbar-brand"</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"#/"</span><span class="crayon-o">&gt;</span><span class="crayon-v">ngClient</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">a</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab36f650856608-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"collapse navbar-collapse"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">ul </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"nav navbar-nav"</span><span class="crayon-h"> </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">show</span><span class="crayon-o">=</span><span class="crayon-s">"showMenu"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab36f650856608-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">li </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"{active:isActive('/')}"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"#"</span><span class="crayon-o">&gt;</span><span class="crayon-v">Home</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">a</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">li</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab36f650856608-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">li </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"{active:isActive('/page1')}"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"#/page1"</span><span class="crayon-o">&gt;</span><span class="crayon-i">Page</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Sample </span><span class="crayon-v">Directive</span><span class="crayon-sy">)</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">a</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">li</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab36f650856608-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">li </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"{active:isActive('/page2')}"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"#/page2"</span><span class="crayon-o">&gt;</span><span class="crayon-i">Page</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Sample </span><span class="crayon-v">Filter</span><span class="crayon-sy">)</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">a</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">li</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab36f650856608-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">li </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"{active:isActive('/page3')}"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"#/page3"</span><span class="crayon-o">&gt;</span><span class="crayon-i">Page</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Sample </span><span class="crayon-v">Factory</span><span class="crayon-sy">)</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">a</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">li</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab36f650856608-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">li</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"javascript:"</span><span class="crayon-h"> </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">click</span><span class="crayon-o">=</span><span class="crayon-s">"logout()"</span><span class="crayon-o">&gt;</span><span class="crayon-v">Logout</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">a</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">li</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab36f650856608-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">ul</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab36f650856608-25"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab36f650856608-26"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0201 seconds] -->
<p>Things to notice</p>
<p><strong>Line 4,12</strong> : 
<span id="crayon-5a104183ab37a024535872" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">showMenu</span></span></span> expression will be true when the user is logged in. This way, we do not show the menu to the user if not logged in. This value will be updated in <em>app.js</em> line 58.</p>
<p><strong>Line 21</strong> : The logout link</p>
<p>Now, the functionality for the logout link. Open <em>controllers.js </em>and update the <em>HeaderCtrl </em>as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab381928217046" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">ngClient/js/controllers.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
myApp.controller("HeaderCtrl", ['$scope', '$location', 'UserAuthFactory',
function($scope, $location, UserAuthFactory) {
$scope.isActive = function(route) {
return route === $location.path();
}
$scope.logout = function () {
UserAuthFactory.logout();
}
}
]);
/// snipp</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab381928217046-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab381928217046-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab381928217046-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab381928217046-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab381928217046-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab381928217046-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab381928217046-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab381928217046-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab381928217046-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab381928217046-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab381928217046-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab381928217046-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab381928217046-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab381928217046-14">14</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab381928217046-1"><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-e">controller</span><span class="crayon-sy">(</span><span class="crayon-s">"HeaderCtrl"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'$scope'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'$location'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'UserAuthFactory'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab381928217046-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-r">location</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">UserAuthFactory</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab381928217046-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab381928217046-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">.</span><span class="crayon-v">isActive</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">route</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab381928217046-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">route</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">location</span><span class="crayon-sy">.</span><span class="crayon-e">path</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab381928217046-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab381928217046-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab381928217046-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">.</span><span class="crayon-v">logout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab381928217046-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">UserAuthFactory</span><span class="crayon-sy">.</span><span class="crayon-e">logout</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab381928217046-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab381928217046-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab381928217046-12"><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab381928217046-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab381928217046-14"><span class="crayon-c">/// snipp</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0084 seconds] -->
<p>The code so far will take care of the login. Now we will make a request to get all products after successful login.</p>
<p>We will create a new <em>dataFactory</em> to interact with the REST API. Open <em>factory.js </em>and update it as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab389352820198" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">ngClient/js/factory.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
myApp.factory('dataFactory', function($http) {
/** https://docs.angularjs.org/guide/providers **/
var urlBase = 'http://localhost:3000/api/v1/products';
var _prodFactory = {};
_prodFactory.getProducts = function() {
return $http.get(urlBase);
}; 
return _prodFactory;
});</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab389352820198-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab389352820198-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab389352820198-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab389352820198-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab389352820198-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab389352820198-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab389352820198-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab389352820198-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab389352820198-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab389352820198-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab389352820198-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab389352820198-1"><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-e">factory</span><span class="crayon-sy">(</span><span class="crayon-s">'dataFactory'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">http</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab389352820198-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">/** https://docs.angularjs.org/guide/providers **/</span></div><div class="crayon-line" id="crayon-5a104183ab389352820198-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-e ">urlBase</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'http://localhost:3000/api/v1/products'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab389352820198-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_prodFactory</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab389352820198-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab389352820198-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">_prodFactory</span><span class="crayon-sy">.</span><span class="crayon-v">getProducts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab389352820198-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">http</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">urlBase</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab389352820198-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5a104183ab389352820198-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab389352820198-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">_prodFactory</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab389352820198-11"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0043 seconds] -->
<p>A sample route to demonstrate the access of API methods post login.</p>
<p>Now in <em>controllers.js</em> update the <em>Page3Ctrl</em> as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab390269934758" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">ngClient/js/controllers.js</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">JavaScript</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
/// snipp
myApp.controller("Page3Ctrl", ['$scope', 'dataFactory',
function($scope, dataFactory) {
$scope.products = [];
// Access the factory and get the latest products list
dataFactory.getProducts().then(function(data) {
$scope.products = data.data;
});
}
]);</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab390269934758-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab390269934758-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab390269934758-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab390269934758-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab390269934758-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab390269934758-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab390269934758-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab390269934758-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab390269934758-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab390269934758-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab390269934758-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab390269934758-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab390269934758-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab390269934758-1"><span class="crayon-c">/// snipp</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab390269934758-2">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab390269934758-3"><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-e">controller</span><span class="crayon-sy">(</span><span class="crayon-s">"Page3Ctrl"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'$scope'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'dataFactory'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab390269934758-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataFactory</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab390269934758-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">.</span><span class="crayon-v">products</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab390269934758-6">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab390269934758-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Access the factory and get the latest products list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab390269934758-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dataFactory</span><span class="crayon-sy">.</span><span class="crayon-e">getProducts</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183ab390269934758-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">.</span><span class="crayon-v">products</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab390269934758-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183ab390269934758-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab390269934758-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183ab390269934758-13"><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0049 seconds] -->
<p>Pretty straight forward. Access the Factory, get the products and finally update the UI. Open <em>partials/page3.html </em>and update it as below</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab398240826130" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">ngClient/partials/page3.html</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;div class="container" ng-controller="Page3Ctrl"&gt;
&lt;div class="page-header"&gt;
&lt;h3&gt;List of products from the REST API
&lt;code&gt;/api/v1/products&lt;/code&gt;
&lt;/h3&gt;
&lt;/div&gt;
&lt;p class="lead"&gt;
&lt;table class="table table-striped"&gt;
&lt;tr&gt;
&lt;th&gt;ID&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;/tr&gt;
&lt;tr ng-repeat="p in products"&gt;
&lt;td&gt;{{p.id}}&lt;/td&gt;
&lt;td&gt;{{p.name}}&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;/p&gt;
&lt;/div&gt;</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab398240826130-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab398240826130-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab398240826130-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab398240826130-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab398240826130-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab398240826130-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab398240826130-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab398240826130-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab398240826130-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab398240826130-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab398240826130-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab398240826130-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab398240826130-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab398240826130-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab398240826130-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab398240826130-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab398240826130-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab398240826130-18">18</div><div class="crayon-num" data-line="crayon-5a104183ab398240826130-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab398240826130-20">20</div><div class="crayon-num" data-line="crayon-5a104183ab398240826130-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab398240826130-22">22</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab398240826130-1"><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"container"</span><span class="crayon-h"> </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">controller</span><span class="crayon-o">=</span><span class="crayon-s">"Page3Ctrl"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab398240826130-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"page-header"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab398240826130-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">h3</span><span class="crayon-o">&gt;</span><span class="crayon-e">List </span><span class="crayon-e">of </span><span class="crayon-e">products </span><span class="crayon-e">from </span><span class="crayon-e">the </span><span class="crayon-e">REST </span><span class="crayon-v">API</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab398240826130-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">code</span><span class="crayon-o">&gt;</span><span class="crayon-o">/</span><span class="crayon-v">api</span><span class="crayon-o">/</span><span class="crayon-v">v1</span><span class="crayon-o">/</span><span class="crayon-v">products</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">code</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab398240826130-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">h3</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab398240826130-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab398240826130-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab398240826130-8">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab398240826130-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-i">p</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"lead"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab398240826130-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">table </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"table table-striped"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab398240826130-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">tr</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab398240826130-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">th</span><span class="crayon-o">&gt;</span><span class="crayon-v">ID</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">th</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab398240826130-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">th</span><span class="crayon-o">&gt;</span><span class="crayon-v">Name</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">th</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab398240826130-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">tr</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab398240826130-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">tr </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">repeat</span><span class="crayon-o">=</span><span class="crayon-s">"p in products"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab398240826130-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">td</span><span class="crayon-o">&gt;</span><span class="crayon-sy">{</span><span class="crayon-sy">{</span><span class="crayon-v">p</span><span class="crayon-sy">.</span><span class="crayon-v">id</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-e">td</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab398240826130-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">td</span><span class="crayon-o">&gt;</span><span class="crayon-sy">{</span><span class="crayon-sy">{</span><span class="crayon-v">p</span><span class="crayon-sy">.</span><span class="crayon-v">name</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">td</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab398240826130-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">tr</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab398240826130-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">table</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab398240826130-20"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab398240826130-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab398240826130-22"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0044 seconds] -->
<p>Finally the <i>index.html</i>. Update it as below with the newly created js references</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183ab3a0190354507" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">ngClient/index.html</span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;!DOCTYPE html&gt;
&lt;html ng-app="ngclient"&gt;
&lt;head&gt;
&lt;title&gt;ngClient&lt;/title&gt;
&lt;link rel="stylesheet" type="text/css" href="libs/bootstrap/dist/css/bootstrap.min.css"&gt;
&lt;link rel="stylesheet" type="text/css" href="css/app.css"&gt;
&lt;script type="text/javascript" src="libs/angular/angular.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="libs/angular-route/angular-route.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="js/app.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="js/factory.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="js/filters.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="js/directives.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="js/controllers.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="js/auth/auth.factory.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="js/auth/auth.controller.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div ng-include="'partials/header.html'"&gt;&lt;/div&gt;
&lt;div class="container" ng-view&gt;&lt;/div&gt;
&lt;div ng-include="'partials/footer.html'"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-2">2</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-4">4</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-6">6</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-8">8</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-10">10</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-12">12</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-14">14</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-16">16</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-18">18</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-20">20</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-22">22</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-24">24</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-26">26</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-28">28</div><div class="crayon-num" data-line="crayon-5a104183ab3a0190354507-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183ab3a0190354507-30">30</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183ab3a0190354507-1"><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-e">DOCTYPE </span><span class="crayon-v">html</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-2"><span class="crayon-o">&lt;</span><span class="crayon-e">html </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">app</span><span class="crayon-o">=</span><span class="crayon-s">"ngclient"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-4"><span class="crayon-o">&lt;</span><span class="crayon-v">head</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">title</span><span class="crayon-o">&gt;</span><span class="crayon-v">ngClient</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">title</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-6">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">link </span><span class="crayon-v">rel</span><span class="crayon-o">=</span><span class="crayon-s">"stylesheet"</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/css"</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"libs/bootstrap/dist/css/bootstrap.min.css"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">link </span><span class="crayon-v">rel</span><span class="crayon-o">=</span><span class="crayon-s">"stylesheet"</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/css"</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"css/app.css"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-h"> </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"libs/angular/angular.min.js"</span><span class="crayon-o">&gt;</span><span class="crayon-ta">&lt;/script&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-h"> </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"libs/angular-route/angular-route.min.js"</span><span class="crayon-o">&gt;</span><span class="crayon-ta">&lt;/script&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-12">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-h"> </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"js/app.js"</span><span class="crayon-o">&gt;</span><span class="crayon-ta">&lt;/script&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-h"> </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"js/factory.js"</span><span class="crayon-o">&gt;</span><span class="crayon-ta">&lt;/script&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-15"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-h"> </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"js/filters.js"</span><span class="crayon-o">&gt;</span><span class="crayon-ta">&lt;/script&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-h"> </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"js/directives.js"</span><span class="crayon-o">&gt;</span><span class="crayon-ta">&lt;/script&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-h"> </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"js/controllers.js"</span><span class="crayon-o">&gt;</span><span class="crayon-ta">&lt;/script&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-18">&nbsp;</div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-19"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-h"> </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"js/auth/auth.factory.js"</span><span class="crayon-o">&gt;</span><span class="crayon-ta">&lt;/script&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-20"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-h"> </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"js/auth/auth.controller.js"</span><span class="crayon-o">&gt;</span><span class="crayon-ta">&lt;/script&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-22"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">head</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-24"><span class="crayon-o">&lt;</span><span class="crayon-v">body</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-25"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">include</span><span class="crayon-o">=</span><span class="crayon-s">"'partials/header.html'"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-26"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"container"</span><span class="crayon-h"> </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">view</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-27"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-v">ng</span><span class="crayon-o">-</span><span class="crayon-v">include</span><span class="crayon-o">=</span><span class="crayon-s">"'partials/footer.html'"</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-28"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">body</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5a104183ab3a0190354507-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183ab3a0190354507-30"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">html</span><span class="crayon-o">&gt;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0072 seconds] -->
<p>That is it. Back to browser (<em>with 
<span id="crayon-5a104183ab3aa886671699" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">gulp</span></span></span> command </em><em>running in the background</em>) and navigate to 
<span id="crayon-5a104183ab3b0368035062" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//localhost:2772</span></span></span>. You should see a login page</p>
<p>Click on Submit and you should see the home page. Now click on logout and you should be logged out. Log back in and click on Page 3 (Sample Factory) link in the menu. Now, you should see a list of products from the REST endpoint.</p>
<p><a href="http://i0.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-22-at-9.02.40-am.png" data-rel="lightbox-6" title=""><img class="size-medium wp-image-2102 aligncenter" src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i1.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-22-at-9.02.40-am-451x104.png?resize=451%2C104" alt="Screen Shot 2014-09-22 at 9.02.40 am" data-recalc-dims="1" /><noscript><img class="size-medium wp-image-2102 aligncenter" src="http://i1.wp.com/thejackalofjavascript.com/wp-content/uploads/2014/09/Screen-Shot-2014-09-22-at-9.02.40-am-451x104.png?resize=451%2C104" alt="Screen Shot 2014-09-22 at 9.02.40 am" data-recalc-dims="1" /></noscript></a></p>
<p>Simple, easy, secure and scalable architecture for your awesome apps!</p>
<hr />
<p>Thanks for reading! Do comment.<br />
@arvindr21</p>
<!-- Simple Share Buttons Adder (6.1.5) simplesharebuttons.com --><div class="ssba ssba-wrap"><div style="text-align:left"><a href="http://twitter.com/share?url=./architecting-a-restful-node-js-app/&amp;text=Architecting+a+Secure+RESTful+Node.js+app+From+The+Jackal+of+Javascript+by+%40arvindr21" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://twitter.com/share?url=./architecting-a-restful-node-js-app/&amp;text=Architecting+a+Secure+RESTful+Node.js+app+From+The+Jackal+of+Javascript+by+%40arvindr21', '');" data-site="" class="ssba_twitter_share"   target="_blank"  rel="nofollow"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i2.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/twitter.png?w=646" title="Twitter" class="ssba ssba-img" alt="Tweet about this on Twitter" data-recalc-dims="1" /><noscript><img src="http://i2.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/twitter.png?w=646" title="Twitter" class="ssba ssba-img" alt="Tweet about this on Twitter" data-recalc-dims="1" /></noscript></a><a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=./architecting-a-restful-node-js-app/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.linkedin.com/shareArticle?mini=true&amp;url=./architecting-a-restful-node-js-app/', '');" data-site="linkedin" class="ssba_linkedin_share ssba_share_link"   target="_blank"  rel="nofollow"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i1.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/linkedin.png?w=646" title="LinkedIn" class="ssba ssba-img" alt="Share on LinkedIn" data-recalc-dims="1" /><noscript><img src="http://i1.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/linkedin.png?w=646" title="LinkedIn" class="ssba ssba-img" alt="Share on LinkedIn" data-recalc-dims="1" /></noscript></a><span class="ssba_sharecount">48</span><a href="https://plus.google.com/share?url=./architecting-a-restful-node-js-app/" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://plus.google.com/share?url=./architecting-a-restful-node-js-app/', '');" data-site="" class="ssba_google_share"   target="_blank"  rel="nofollow"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i2.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/google.png?w=646" title="Google+" class="ssba ssba-img" alt="Share on Google+" data-recalc-dims="1" /><noscript><img src="http://i2.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/google.png?w=646" title="Google+" class="ssba ssba-img" alt="Share on Google+" data-recalc-dims="1" /></noscript></a><span class="ssba_sharecount">0</span><a href="http://reddit.com/submit?url=./architecting-a-restful-node-js-app/&amp;title=Architecting a Secure RESTful Node.js app" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://reddit.com/submit?url=./architecting-a-restful-node-js-app/&amp;title=Architecting a Secure RESTful Node.js app', '');" data-site="reddit" class="ssba_reddit_share"   target="_blank"  rel="nofollow"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/reddit.png?w=646" title="Reddit" class="ssba ssba-img" alt="Share on Reddit" data-recalc-dims="1" /><noscript><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/reddit.png?w=646" title="Reddit" class="ssba ssba-img" alt="Share on Reddit" data-recalc-dims="1" /></noscript></a><span class="ssba_sharecount">0</span><a href="https://bufferapp.com/add?url=./architecting-a-restful-node-js-app/&amp;text=From The Jackal of Javascript Architecting a Secure RESTful Node.js app" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://bufferapp.com/add?url=./architecting-a-restful-node-js-app/&amp;text=From The Jackal of Javascript Architecting a Secure RESTful Node.js app', '');" data-site="buffer" class="ssba_buffer_share"   target="_blank"  rel="nofollow"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i1.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/buffer.png?w=646" title="Buffer" class="ssba ssba-img" alt="Buffer this page" data-recalc-dims="1" /><noscript><img src="http://i1.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/buffer.png?w=646" title="Buffer" class="ssba ssba-img" alt="Buffer this page" data-recalc-dims="1" /></noscript></a><a href="https://flattr.com/submit/auto?user_id=arvindr21&amp;title=Architecting a Secure RESTful Node.js app&amp;url=https://flattr.com/profile/arvindr21" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://flattr.com/submit/auto?user_id=arvindr21&amp;title=Architecting a Secure RESTful Node.js app&amp;url=https://flattr.com/profile/arvindr21', '');" data-site="flattr" class="ssba_flattr_share"   target="_blank"  rel="nofollow"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/flattr.png?w=646" title="Flattr" class="ssba ssba-img" alt="Flattr the author" data-recalc-dims="1" /><noscript><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/flattr.png?w=646" title="Flattr" class="ssba ssba-img" alt="Flattr the author" data-recalc-dims="1" /></noscript></a><a data-site="email" class="ssba_email_share" href="/cdn-cgi/l/email-protection#8ab5f9ffe8e0efe9feb7cbf8e9e2e3feefe9fee3e4edaaebaad9efe9fff8efaad8cfd9deecffe6aac4e5eeefa4e0f9aaebfafaacebe7fab1e8e5eef3b7ccf8e5e7aadee2efaac0ebe9e1ebe6aae5ecaac0ebfcebf9e9f8e3fafeafb8bae2fefefab0a5a5fee2efe0ebe9e1ebe6e5ece0ebfcebf9e9f8e3fafea4e9e5e7a5ebf8e9e2e3feefe9fee3e4eda7eba7f8eff9feecffe6a7e4e5eeefa7e0f9a7ebfafaa5"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/email.png?w=646" title="Email" class="ssba ssba-img" alt="Email this to someone" data-recalc-dims="1" /><noscript><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/email.png?w=646" title="Email" class="ssba ssba-img" alt="Email this to someone" data-recalc-dims="1" /></noscript></a><a data-site="print" class="ssba_print ssba_share_link" href="#" onclick="window.print()"><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/lazy-load/images/1x1.trans.gif" data-lazy-src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/print.png?w=646" title="Print" class="ssba ssba-img" alt="Print this page" data-recalc-dims="1" /><noscript><img src="http://i0.wp.com/thejackalofjavascript.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/print.png?w=646" title="Print" class="ssba ssba-img" alt="Print this page" data-recalc-dims="1" /></noscript></a></div></div><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-70838519-2043-5a1041847b17f' data-src='//widgets.wp.com/likes/#blog_id=70838519&amp;post_id=2043&amp;origin=thejackalofjavascript.com&amp;obj_id=70838519-2043-5a1041847b17f' data-name='like-post-frame-70838519-2043-5a1041847b17f'><h3 class='sd-title'>Like this:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height:55px'><span class='button'><span>Like</span></span> <span class="loading">Loading...</span></div><span class='sd-text-color'></span><a class='sd-link-color'></a></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>
<div class="entry-content">
</div><!-- .entry-content -->
<footer class="entry-meta">
<span class="post-date"><a href="./architecting-a-restful-node-js-app/" title="9:38 am" rel="bookmark"><time class="entry-date" datetime="2014-09-22T09:38:15+00:00">September 22, 2014</time></a></span><span class="byline"><span class="author vcard"><a class="url fn n" href="./author/arvind-ravulavaru/" title="View all posts by Arvind Ravulavaru" rel="author">Arvind Ravulavaru</a></span></span>					</footer><!-- .entry-meta -->
</article><!-- #post-## -->
<nav class="navigation post-navigation" role="navigation">
<h1 class="screen-reader-text">Post navigation</h1>
<div class="nav-links">
<div class="nav-previous"><a href="./maintaining-a-private-npm-registry/" rel="prev"><span class="meta-nav screen-reader-text">&larr;</span></a></div><div class="nav-next"><a href="./ionic-twilio-and-node-scheduler-part-2/" rel="next"><span class="meta-nav screen-reader-text">&rarr;</span></a></div>		</div><!-- .nav-links -->
</nav><!-- .navigation -->
<div id="disqus_thread">
<div id="dsq-content">
<div class="navigation">
<div class="nav-previous">
<span class="meta-nav">&larr;</span>&nbsp;
</div>
<div class="nav-next">
<a href="./architecting-a-restful-node-js-app/#comments" >Newer Comments</a>                    &nbsp;<span class="meta-nav">&rarr;</span>
</div>
</div> <!-- .navigation -->
<ul id="dsq-comments">
<li class="comment even thread-even depth-1" id="dsq-comment-2770">
<div id="dsq-comment-header-2770" class="dsq-comment-header">
<cite id="dsq-cite-2770">
<span id="dsq-author-user-2770">prateek</span>
</cite>
</div>
<div id="dsq-comment-body-2770" class="dsq-comment-body">
<div id="dsq-comment-message-2770" class="dsq-comment-message"><p>Hi Arvind,</p>
<p>First of all thank you for providing a detailed conceptual insight into creating a secure Restful Nodejs application. It is really helpful for beginners like me. </p>
<p>I would really appreciate if you could help me resolve my issue:</p>
<p>So in my middleware validateRequest.js, I check if my token is expired, if it has expired I return a new oUser object with a fresh token. Problem is oUser always returns &#8216;undefined&#8217; inspite of the fact that &#8216;checkToken&#8217; gets called and a new token is generated in the db.  :</p>
<p>module.exports = function(req, res, next) {<br />
if (req.body.token) {<br />
var decoded = jwt.decode(req.body.token, require(&#8216;../config/secret&#8217;)());<br />
if( token_is_expired ) { //token expire logic<br />
var oUser = checkToken(decoded); //call to routes/authToken.js<br />
if(oUser){<br />
res.json({success: true, response:oUser});<br />
}else{<br />
res.json({success: false, response:{msg:&#8221;There was some problem&#8221;}});<br />
return;<br />
}<br />
}else{<br />
next();<br />
}<br />
} else {<br />
res.json({success: false, response:{msg:&#8221;Invalid Token&#8221;}});return;<br />
}<br />
}</p>
<p>Has this got anything to do with aysnc or non-blocking call? Appreciate any help.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2771">
<div id="dsq-comment-header-2771" class="dsq-comment-header">
<cite id="dsq-cite-2771">
<span id="dsq-author-user-2771">prateek</span>
</cite>
</div>
<div id="dsq-comment-body-2771" class="dsq-comment-body">
<div id="dsq-comment-message-2771" class="dsq-comment-message"><p>I was able to solve this. Instead of :<br />
var oUser = checkToken(decoded);<br />
I used a function callback as below:<br />
checkToken(decoded, function(err, res){<br />
console.log(res);<br />
});<br />
Once again thanks for the great article.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-2757">
<div id="dsq-comment-header-2757" class="dsq-comment-header">
<cite id="dsq-cite-2757">
<span id="dsq-author-user-2757">johaness vix</span>
</cite>
</div>
<div id="dsq-comment-body-2757" class="dsq-comment-body">
<div id="dsq-comment-message-2757" class="dsq-comment-message"><p>are you passing user and password in plain? how to avoid doing that?</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="dsq-comment-2668">
<div id="dsq-comment-header-2668" class="dsq-comment-header">
<cite id="dsq-cite-2668">
<span id="dsq-author-user-2668">John</span>
</cite>
</div>
<div id="dsq-comment-body-2668" class="dsq-comment-body">
<div id="dsq-comment-message-2668" class="dsq-comment-message"><p>Hi Arvind,</p>
<p>How to handle user log out at server side? when user logs out what we need to do with the valid token?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2682">
<div id="dsq-comment-header-2682" class="dsq-comment-header">
<cite id="dsq-cite-2682">
./                <span id="dsq-author-user-2682">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2682" class="dsq-comment-body">
<div id="dsq-comment-message-2682" class="dsq-comment-message"><p>Hello John, </p>
<p>Our server is RESTful, that means it is stateless. You need not do anything with the server (with the above architecture). On the client side when the user clicks on logout, we clear the local persistence of the token. Like</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183afdb4971597629" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
myApp.factory('UserAuthFactory', function($window, $location, $http, AuthenticationFactory) {
return {
/// snipp 
logout: function() {
if (AuthenticationFactory.isLogged) {
AuthenticationFactory.isLogged = false;
delete AuthenticationFactory.user;
delete AuthenticationFactory.userRole;
delete $window.sessionStorage.token;
delete $window.sessionStorage.user;
delete $window.sessionStorage.userRole;
$location.path("/login");
}
}
}
});
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183afdb4971597629-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183afdb4971597629-2">2</div><div class="crayon-num" data-line="crayon-5a104183afdb4971597629-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183afdb4971597629-4">4</div><div class="crayon-num" data-line="crayon-5a104183afdb4971597629-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183afdb4971597629-6">6</div><div class="crayon-num" data-line="crayon-5a104183afdb4971597629-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183afdb4971597629-8">8</div><div class="crayon-num" data-line="crayon-5a104183afdb4971597629-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183afdb4971597629-10">10</div><div class="crayon-num" data-line="crayon-5a104183afdb4971597629-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183afdb4971597629-12">12</div><div class="crayon-num" data-line="crayon-5a104183afdb4971597629-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183afdb4971597629-14">14</div><div class="crayon-num" data-line="crayon-5a104183afdb4971597629-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183afdb4971597629-16">16</div><div class="crayon-num" data-line="crayon-5a104183afdb4971597629-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183afdb4971597629-18">18</div><div class="crayon-num" data-line="crayon-5a104183afdb4971597629-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183afdb4971597629-20">20</div><div class="crayon-num" data-line="crayon-5a104183afdb4971597629-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183afdb4971597629-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183afdb4971597629-2"><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-e">factory</span><span class="crayon-sy">(</span><span class="crayon-s">'UserAuthFactory'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">location</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">http</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183afdb4971597629-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183afdb4971597629-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183afdb4971597629-5"><span class="crayon-h"> </span><span class="crayon-c">/// snipp </span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183afdb4971597629-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">logout</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183afdb4971597629-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">isLogged</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183afdb4971597629-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">isLogged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183afdb4971597629-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">delete </span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183afdb4971597629-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">delete </span><span class="crayon-v">AuthenticationFactory</span><span class="crayon-sy">.</span><span class="crayon-v">userRole</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183afdb4971597629-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183afdb4971597629-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">delete</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183afdb4971597629-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">delete</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183afdb4971597629-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">delete</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">userRole</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183afdb4971597629-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-v">location</span><span class="crayon-sy">.</span><span class="crayon-e">path</span><span class="crayon-sy">(</span><span class="crayon-s">"/login"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183afdb4971597629-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183afdb4971597629-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183afdb4971597629-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183afdb4971597629-19"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183afdb4971597629-20">&nbsp;</div><div class="crayon-line" id="crayon-5a104183afdb4971597629-21">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0038 seconds] -->
<p></p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-2659">
<div id="dsq-comment-header-2659" class="dsq-comment-header">
<cite id="dsq-cite-2659">
<span id="dsq-author-user-2659">Patrick R</span>
</cite>
</div>
<div id="dsq-comment-body-2659" class="dsq-comment-body">
<div id="dsq-comment-message-2659" class="dsq-comment-message"><p>Any reason I could be hitting the following errors:</p>
<p>[18:53:33] Server started <a href="http://localhost:2772" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:2772', 'http://localhost:2772');" rel="nofollow">http://localhost:2772</a><br />
[18:53:33] LiveReload started on port 35729<br />
Error: Forbidden<br />
at createError (/apps/backend/projects/myRESTApp-master/ngClient/node_modules/gulp-connect/node_modules/connect/node_modules/serve-index/index.js:188:13)<br />
at Object.directory [as handle] (/apps/backend/projects/myRESTApp-master/ngClient/node_modules/gulp-connect/node_modules/connect/node_modules/serve-index/index.js:100:46)<br />
at next (/apps/backend/projects/myRESTApp-master/ngClient/node_modules/gulp-connect/node_modules/connect/lib/proto.js:194:15)<br />
at SendStream.error (/apps/backend/projects/myRESTApp-master/ngClient/node_modules/gulp-connect/node_modules/connect/node_modules/serve-static/index.js:86:37)<br />
at SendStream.emit (events.js:107:17)<br />
at SendStream.error (/apps/backend/projects/myRESTApp-master/ngClient/node_modules/gulp-connect/node_modules/connect/node_modules/serve-static/node_modules/send/lib/send.js:172:51)<br />
at SendStream.onStatError (/apps/backend/projects/myRESTApp-master/ngClient/node_modules/gulp-connect/node_modules/connect/node_modules/serve-static/node_modules/send/lib/send.js:285:48)<br />
at /apps/backend/projects/myRESTApp-master/ngClient/node_modules/gulp-connect/node_modules/connect/node_modules/serve-static/node_modules/send/lib/send.js:378:26<br />
at FSReqWrap.oncomplete (fs.js:95:15)</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2826">
<div id="dsq-comment-header-2826" class="dsq-comment-header">
<cite id="dsq-cite-2826">
<span id="dsq-author-user-2826">Mark Terrey</span>
</cite>
</div>
<div id="dsq-comment-body-2826" class="dsq-comment-body">
<div id="dsq-comment-message-2826" class="dsq-comment-message"><p>did you work this one out?</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2939">
<div id="dsq-comment-header-2939" class="dsq-comment-header">
<cite id="dsq-cite-2939">
<span id="dsq-author-user-2939">Daniel Abrão</span>
</cite>
</div>
<div id="dsq-comment-body-2939" class="dsq-comment-body">
<div id="dsq-comment-message-2939" class="dsq-comment-message"><p>change this snippet on server.js:</p>
<p>app.all(&#8216;/*&#8217;, function(req, res, next) {</p>
<p>// CORS headers</p>
<p>res.header(&#8220;Access-Control-Allow-Origin&#8221;, &#8220;*&#8221;); // restrict it to the required domain</p>
<p>res.header(&#8216;Access-Control-Allow-Methods&#8217;, &#8216;GET,PUT,POST,DELETE,OPTIONS&#8217;);</p>
<p>// Set custom headers for CORS</p>
<p>res.header(&#8216;Access-Control-Allow-Headers&#8217;, &#8216;Content-type,Accept,X-Access-Token,X-Key&#8217;);</p>
<p>if (req.method == &#8216;OPTIONS&#8217;) {</p>
<p>res.status(200).end();</p>
<p>} else {</p>
<p>next();</p>
<p>}</p>
<p>});</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-2977">
<div id="dsq-comment-header-2977" class="dsq-comment-header">
<cite id="dsq-cite-2977">
<span id="dsq-author-user-2977">Gaurav Arora</span>
</cite>
</div>
<div id="dsq-comment-body-2977" class="dsq-comment-body">
<div id="dsq-comment-message-2977" class="dsq-comment-message"><p>I get the error despite the changes you mentioned.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="dsq-comment-2644">
<div id="dsq-comment-header-2644" class="dsq-comment-header">
<cite id="dsq-cite-2644">
<span id="dsq-author-user-2644">Patrick R</span>
</cite>
</div>
<div id="dsq-comment-body-2644" class="dsq-comment-body">
<div id="dsq-comment-message-2644" class="dsq-comment-message"><p>Am on linux (RHEL)&#8230;I get the following. What&#8217;s missing?</p>
<p>curl –data &#8220;{&#8220;username&#8221; : &#8220;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b0d1c2c6d9ded4f0ddc9d1c0c09ed3dfdd">[email&#160;protected]</a>&#8221;, &#8220;password&#8221; : &#8220;pass123&#8243;}&#8221; -H &#8220;content-type:application/json&#8221; <a href="http://localhost:3000/login" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:3000/login', 'http://localhost:3000/login');" rel="nofollow">http://localhost:3000/login</a></p>
<p>curl: (6) Could not resolve host: xn--data-z86a; Name or service not known</p>
<p>[1/2]: &#8220;username&#8221; : &#8220;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2f4e5d5946414b6f42564e5f5f014c4042">[email&#160;protected]</a>&#8221; &#8211;&gt; </p>
<p>&#8211;_curl_&#8211;&#8220;username&#8221; : &#8220;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="751407031c1b1135180c1405055b161a18">[email&#160;protected]</a>&#8221;</p>
<p>curl: (6) Could not resolve host: myapp.com&#8221;; Name or service not known</p>
<p>[2/2]:  &#8220;password&#8221; : &#8220;pass123&#8243; &#8211;&gt; </p>
<p>&#8211;_curl_&#8211; &#8220;password&#8221; : &#8220;pass123&#8243;</p>
<p>curl: (6) Could not resolve host:  &#8220;password&#8221; ; Name or service not known</p>
<p>Error: Not Found &nbsp; &nbsp;at /apps/backend/projects/myRESTApp-master/server/server.js:34:13 &nbsp; &nbsp;at Layer.handle [as handle_request] (/apps/backend/projects/myRESTApp-master/server/node_modules/express/lib/router/layer.js:82:5) &nbsp; &nbsp;at trim_prefix (/apps/backend/projects/myRESTApp-master/server/node_modules/express/lib/router/index.js:302:13) &nbsp; &nbsp;at /apps/backend/projects/myRESTApp-master/server/node_modules/express/lib/router/index.js:270:7 &nbsp; &nbsp;at Function.proto.process_params (/apps/backend/projects/myRESTApp-master/server/node_modules/express/lib/router/index.js:321:12) &nbsp; &nbsp;at next (/apps/backend/projects/myRESTApp-master/server/node_modules/express/lib/router/index.js:261:10) &nbsp; &nbsp;at /apps/backend/projects/myRESTApp-master/server/node_modules/express/lib/router/index.js:603:15 &nbsp; &nbsp;at next (/apps/backend/projects/myRESTApp-master/server/node_modules/express/lib/router/index.js:246:14) &nbsp; &nbsp;at Function.proto.handle (/apps/backend/projects/myRESTApp-master/server/node_modules/express/lib/router/index.js:166:3) &nbsp; &nbsp;at router (/apps/backend/projects/myRESTApp-master/server/node_modules/express/lib/router/index.js:35:12)</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2646">
<div id="dsq-comment-header-2646" class="dsq-comment-header">
<cite id="dsq-cite-2646">
<span id="dsq-author-user-2646">Kev</span>
</cite>
</div>
<div id="dsq-comment-body-2646" class="dsq-comment-body">
<div id="dsq-comment-message-2646" class="dsq-comment-message"><p>Patrick R, please try this</p>
<p><code>curl -d '{"username":"<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b0d1c2c6d9ded4f0ddc9d1c0c09ed3dfdd">[email&#160;protected]</a>", "password": "pass123"}' -H 'Content-type: application/json' http://localhost:3000/login</code></p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2657">
<div id="dsq-comment-header-2657" class="dsq-comment-header">
<cite id="dsq-cite-2657">
<span id="dsq-author-user-2657">Patrick R</span>
</cite>
</div>
<div id="dsq-comment-body-2657" class="dsq-comment-body">
<div id="dsq-comment-message-2657" class="dsq-comment-message"><p>thank you! worked</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-2609">
<div id="dsq-comment-header-2609" class="dsq-comment-header">
<cite id="dsq-cite-2609">
<span id="dsq-author-user-2609">Brooks Wood</span>
</cite>
</div>
<div id="dsq-comment-body-2609" class="dsq-comment-body">
<div id="dsq-comment-message-2609" class="dsq-comment-message"><p>Excellent article and thank you!</p>
<p>I have connected this example to my database and I am abel to successfully log in.  When I try to get a list of &#8220;readings&#8221; in this case instead of &#8220;products&#8221; in your example my return is empty.  Any thoughts on the best way to return a JSON get request from the an API endpoint/db?  I have attached a few screenshots of my revised coders</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2610">
<div id="dsq-comment-header-2610" class="dsq-comment-header">
<cite id="dsq-cite-2610">
./                <span id="dsq-author-user-2610">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2610" class="dsq-comment-body">
<div id="dsq-comment-message-2610" class="dsq-comment-message"><p>Hello Brooks, Thanks!</p>
<p>Quick question, when you navigate to <code>http://localhost:3000/readings</code> in the browser what happens?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-3" id="dsq-comment-2612">
<div id="dsq-comment-header-2612" class="dsq-comment-header">
<cite id="dsq-cite-2612">
<span id="dsq-author-user-2612">Brooks Wood</span>
</cite>
</div>
<div id="dsq-comment-body-2612" class="dsq-comment-body">
<div id="dsq-comment-message-2612" class="dsq-comment-message"><p>Hi Arvind, thanks for the response. </p>
<p>As long as I use postman and customer headers with JWT and username I get this JSON Response: </p>
<p>[</p>
<p>  {</p>
<p>    &#8220;_id&#8221; : &#8220;55501da53506aaa9494d0fd6&#8243;,</p>
<p>    &#8220;coreid&#8221; : &#8220;55555&#8221;,</p>
<p>    &#8220;__v&#8221; : 0,</p>
<p>    &#8220;temp&#8221; : &#8220;98dF&#8221;,</p>
<p>    &#8220;alert&#8221; : &#8220;none&#8221;</p>
<p>  }</p>
<p>]</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-4" id="dsq-comment-2613">
<div id="dsq-comment-header-2613" class="dsq-comment-header">
<cite id="dsq-cite-2613">
./                <span id="dsq-author-user-2613">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2613" class="dsq-comment-body">
<div id="dsq-comment-message-2613" class="dsq-comment-message"><p>I noticed that your ng-repeat is <code>reading in readings</code> but you are using <code>r.coreid</code> and <code>r.temp</code> to display the values. Shouldn&#8217;t this be <code>reading.coreid</code> or <code>reading.temp</code> ? Could that be the issue?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-5" id="dsq-comment-2616">
<div id="dsq-comment-header-2616" class="dsq-comment-header">
<cite id="dsq-cite-2616">
<span id="dsq-author-user-2616">Brooks Wood</span>
</cite>
</div>
<div id="dsq-comment-body-2616" class="dsq-comment-body">
<div id="dsq-comment-message-2616" class="dsq-comment-message"><p>I have tried several variations and just tried again as &#8216;reading.coreid&#8217; and &#8216;reading.temp&#8217; the outcome is the same.  Blank result. </p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2617">
<div id="dsq-comment-header-2617" class="dsq-comment-header">
<cite id="dsq-cite-2617">
./                <span id="dsq-author-user-2617">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2617" class="dsq-comment-body">
<div id="dsq-comment-message-2617" class="dsq-comment-message"><p>Hmm.. can you try console logging the response in your controller (<code>data.data</code>) and see what is the value?</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even depth-5" id="dsq-comment-2620">
<div id="dsq-comment-header-2620" class="dsq-comment-header">
<cite id="dsq-cite-2620">
<span id="dsq-author-user-2620">Brooks Wood</span>
</cite>
</div>
<div id="dsq-comment-body-2620" class="dsq-comment-body">
<div id="dsq-comment-message-2620" class="dsq-comment-message"><p>Here is what I added but I am not familiar with getting console.log output results while using gulp.  Do you have any thoughts?</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2621">
<div id="dsq-comment-header-2621" class="dsq-comment-header">
<cite id="dsq-cite-2621">
<span id="dsq-author-user-2621">Brooks Wood</span>
</cite>
</div>
<div id="dsq-comment-body-2621" class="dsq-comment-body">
<div id="dsq-comment-message-2621" class="dsq-comment-message"><p>IMG Attached</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even depth-5" id="dsq-comment-2622">
<div id="dsq-comment-header-2622" class="dsq-comment-header">
<cite id="dsq-cite-2622">
./                <span id="dsq-author-user-2622">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2622" class="dsq-comment-body">
<div id="dsq-comment-message-2622" class="dsq-comment-message"><p>Try this</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b05c6121440884" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
readingsFactory.getReading().then(function(data){
console.log(data.data);
$scope.readings = data.data;
});
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b05c6121440884-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b05c6121440884-2">2</div><div class="crayon-num" data-line="crayon-5a104183b05c6121440884-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b05c6121440884-4">4</div><div class="crayon-num" data-line="crayon-5a104183b05c6121440884-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b05c6121440884-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b05c6121440884-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b05c6121440884-2"><span class="crayon-v">readingsFactory</span><span class="crayon-sy">.</span><span class="crayon-e">getReading</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183b05c6121440884-3"><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b05c6121440884-4"><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">.</span><span class="crayon-v">readings</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b05c6121440884-5"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b05c6121440884-6">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0015 seconds] -->
<p></p>
<p>Save the file and refresh the page. Next, open developer tools and you should see something logged in the console tab.</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2623">
<div id="dsq-comment-header-2623" class="dsq-comment-header">
<cite id="dsq-cite-2623">
<span id="dsq-author-user-2623">Brooks Wood</span>
</cite>
</div>
<div id="dsq-comment-body-2623" class="dsq-comment-body">
<div id="dsq-comment-message-2623" class="dsq-comment-message"><p>Here is the console output &#8211; attached is an image of my controller and factory</p>
<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<p>[Error] Error: Can&#8217;t find variable: readFactory</p>
<p><a href="http://localhost:2772/js/controllers.js:40:16" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:2772/js/controllers.js:40:16', 'http://localhost:2772/js/controllers.js:40:16');" rel="nofollow">http://localhost:2772/js/controllers.js:40:16</a></p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1d795d7569696d">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:35:41</p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="cda4a3beb9aca3b9a4acb9a88da5b9b9bd">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:35:166</p>
<p><a href="http://localhost:2772/libs/angular/angular.min.js:67:562" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:2772/libs/angular/angular.min.js:67:562', 'http://localhost:2772/libs/angular/angular.min.js:67:562');" rel="nofollow">http://localhost:2772/libs/angular/angular.min.js:67:562</a></p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f79b9e999cb79f838387">[email&#160;protected]</a>://localhost:2772/libs/angular-route/angular-route.min.js:7:249</p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="440e042c303034">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:54:374</p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e582a58d919195">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:47:257</p>
<p><a href="http://localhost:2772/libs/angular/angular.min.js:46:378" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:2772/libs/angular/angular.min.js:46:378', 'http://localhost:2772/libs/angular/angular.min.js:46:378');" rel="nofollow">http://localhost:2772/libs/angular/angular.min.js:46:378</a></p>
<p><a href="http://localhost:2772/libs/angular/angular.min.js:48:218" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:2772/libs/angular/angular.min.js:48:218', 'http://localhost:2772/libs/angular/angular.min.js:48:218');" rel="nofollow">http://localhost:2772/libs/angular/angular.min.js:48:218</a></p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7700371f030307">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:52:30</p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0b7d4b637f7f7b">[email&#160;protected]</a>://localhost:2772/libs/angular-route/angular-route.min.js:6:498</p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="250147574a444146445651654d515155">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:115:310</p>
<p><a href="http://localhost:2772/libs/angular-route/angular-route.min.js:11:189" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:2772/libs/angular-route/angular-route.min.js:11:189', 'http://localhost:2772/libs/angular-route/angular-route.min.js:11:189');" rel="nofollow">http://localhost:2772/libs/angular-route/angular-route.min.js:11:189</a></p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e2a8a28a969692">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:101:96</p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5d171d3529292d">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:101:96</p>
<p><a href="http://localhost:2772/libs/angular/angular.min.js:102:260" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:2772/libs/angular/angular.min.js:102:260', 'http://localhost:2772/libs/angular/angular.min.js:102:260');" rel="nofollow">http://localhost:2772/libs/angular/angular.min.js:102:260</a></p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="03276675626f436b777773">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:113:32</p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7357171a14160007331b070703">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:110:122</p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b692d7c6c6dacff6dec2c2c6">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:113:369</p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f79ab79f838387">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:72:460</p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="394e79514d4d49">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:77:796</p>
<p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b5dadbc7d0d4d1ccc6c1d4c1d0d6ddd4dbd2d0f5ddc1c1c5">[email&#160;protected]</a>://localhost:2772/libs/angular/angular.min.js:79:25 </p>
<p>	(anonymous function) (angular.min.js, line 92)</p>
<p>	(anonymous function) (angular.min.js, line 68)</p>
<p>	J (angular.min.js, line 54)</p>
<p>	g (angular.min.js, line 47)</p>
<p>	(anonymous function) (angular.min.js, line 46)</p>
<p>	(anonymous function) (angular.min.js, line 48)</p>
<p>	w (angular.min.js, line 52)</p>
<p>	v (angular-route.min.js, line 6)</p>
<p>	$broadcast (angular.min.js, line 115)</p>
<p>	(anonymous function) (angular-route.min.js, line 11)</p>
<p>	J (angular.min.js, line 101)</p>
<p>	J (angular.min.js, line 101)</p>
<p>	(anonymous function) (angular.min.js, line 102)</p>
<p>	$eval (angular.min.js, line 113)</p>
<p>	$digest (angular.min.js, line 110)</p>
<p>	$apply (angular.min.js, line 113)</p>
<p>	m (angular.min.js, line 72)</p>
<p>	w (angular.min.js, line 77)</p>
<p>	onreadystatechange (angular.min.js, line 79)</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even depth-5" id="dsq-comment-2624">
<div id="dsq-comment-header-2624" class="dsq-comment-header">
<cite id="dsq-cite-2624">
./                <span id="dsq-author-user-2624">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2624" class="dsq-comment-body">
<div id="dsq-comment-message-2624" class="dsq-comment-message"><p>Damn! how could I have missed that!! The variable alias name of your factory is dataFactory and not readingsFactory. Change your code to</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b0434114352498" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
dataFactory.getReading().then(function(data){
console.log(data.data);
$scope.readings = data.data;
});
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b0434114352498-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0434114352498-2">2</div><div class="crayon-num" data-line="crayon-5a104183b0434114352498-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0434114352498-4">4</div><div class="crayon-num" data-line="crayon-5a104183b0434114352498-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0434114352498-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b0434114352498-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0434114352498-2"><span class="crayon-v">dataFactory</span><span class="crayon-sy">.</span><span class="crayon-e">getReading</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183b0434114352498-3"><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0434114352498-4"><span class="crayon-sy">$</span><span class="crayon-v">scope</span><span class="crayon-sy">.</span><span class="crayon-v">readings</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b0434114352498-5"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0434114352498-6">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0013 seconds] -->
<p></p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2626">
<div id="dsq-comment-header-2626" class="dsq-comment-header">
<cite id="dsq-cite-2626">
<span id="dsq-author-user-2626">Brooks Wood</span>
</cite>
</div>
<div id="dsq-comment-body-2626" class="dsq-comment-body">
<div id="dsq-comment-message-2626" class="dsq-comment-message"><p>Thank you that did resolved all client issues.  The server side is now returning 401 error.  Its interesting because I am able to login successfully.  The same user and token through postman works perfect.</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even depth-5" id="dsq-comment-2630">
<div id="dsq-comment-header-2630" class="dsq-comment-header">
<cite id="dsq-cite-2630">
<span id="dsq-author-user-2630">Brooks Wood</span>
</cite>
</div>
<div id="dsq-comment-body-2630" class="dsq-comment-body">
<div id="dsq-comment-message-2630" class="dsq-comment-message"><p>Hello Arvind!  </p>
<p>Thank you for the your help on this so far.  I think am very close at this point.  When inspecting the headers in an attempt to get the &#8216;Readings&#8217; return.  I noticed the the http$ interceptor is only passing along the token.  The username and role are &#8220;undefined&#8221;.  I am assuming this is why I am getting a 401.  </p>
<p>Attached are the screenshots.  My app.js screenshot shows what appears to be the user information being stored and sent along with each request after auth.  Do you have any thoughts or guidance?</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2631">
<div id="dsq-comment-header-2631" class="dsq-comment-header">
<cite id="dsq-cite-2631">
<span id="dsq-author-user-2631">Brooks Wood</span>
</cite>
</div>
<div id="dsq-comment-body-2631" class="dsq-comment-body">
<div id="dsq-comment-message-2631" class="dsq-comment-message"><p>I was able to get this working finally.  Based my API I had to change </p>
<p>auth.controller.js line22 to $window.sessionStorage.user = data.user; instead of &#8216;data.user.username&#8217;</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even depth-5" id="dsq-comment-2636">
<div id="dsq-comment-header-2636" class="dsq-comment-header">
<cite id="dsq-cite-2636">
./                <span id="dsq-author-user-2636">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2636" class="dsq-comment-body">
<div id="dsq-comment-message-2636" class="dsq-comment-message"><p>ah! ok! Looks like the complete architecture is setup now!</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2647">
<div id="dsq-comment-header-2647" class="dsq-comment-header">
<cite id="dsq-cite-2647">
<span id="dsq-author-user-2647">Kev</span>
</cite>
</div>
<div id="dsq-comment-body-2647" class="dsq-comment-body">
<div id="dsq-comment-message-2647" class="dsq-comment-message"><p>Hi Brooks, glad that you had it working. I&#8217;d like to connect to nedb (user with encrypted password). Can you shed some lights how to integrate with this secure restful feature? Thanks in advance.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-2602">
<div id="dsq-comment-header-2602" class="dsq-comment-header">
<cite id="dsq-cite-2602">
<span id="dsq-author-user-2602">Sam</span>
</cite>
</div>
<div id="dsq-comment-body-2602" class="dsq-comment-body">
<div id="dsq-comment-message-2602" class="dsq-comment-message"><p>Hi, Is there a way I can restrict this endpoint:  (router.delete(&#8216;/api/v1/product/:id&#8217;, products.delete);) to be accessed from a specific IP?. Thanks Sam</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2603">
<div id="dsq-comment-header-2603" class="dsq-comment-header">
<cite id="dsq-cite-2603">
./                <span id="dsq-author-user-2603">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2603" class="dsq-comment-body">
<div id="dsq-comment-message-2603" class="dsq-comment-message"><p>Hey Sam,</p>
<p>Yes, you can create a middleware that gets added to your delete route. All the middleware does is gets the IP from the request and validates if it can execute the delete operation. If yes, you can call the <code>next()</code> or else you return an error <code>req.status(403).send("You do not have access to delete this resource")</code></p>
<p>Your code would look something like</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b0b3e372868658" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// ipcheck.js
// list of allowed IPs
var allowed = [
'127.0.0.1',
'192.168.2.12'
];
// the middleware function
module.exports = function() {
return function(req, res, next) {
if (allowed.indexOf(req.connection.remoteAddress) === -1) {
req.status(403).send("You do not have access to delete this resource")
} else {
next();
}
}
};
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b0b3e372868658-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0b3e372868658-2">2</div><div class="crayon-num" data-line="crayon-5a104183b0b3e372868658-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0b3e372868658-4">4</div><div class="crayon-num" data-line="crayon-5a104183b0b3e372868658-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0b3e372868658-6">6</div><div class="crayon-num" data-line="crayon-5a104183b0b3e372868658-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0b3e372868658-8">8</div><div class="crayon-num" data-line="crayon-5a104183b0b3e372868658-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0b3e372868658-10">10</div><div class="crayon-num" data-line="crayon-5a104183b0b3e372868658-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0b3e372868658-12">12</div><div class="crayon-num" data-line="crayon-5a104183b0b3e372868658-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0b3e372868658-14">14</div><div class="crayon-num" data-line="crayon-5a104183b0b3e372868658-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0b3e372868658-16">16</div><div class="crayon-num" data-line="crayon-5a104183b0b3e372868658-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0b3e372868658-18">18</div><div class="crayon-num" data-line="crayon-5a104183b0b3e372868658-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0b3e372868658-20">20</div><div class="crayon-num" data-line="crayon-5a104183b0b3e372868658-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b0b3e372868658-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0b3e372868658-2">&nbsp;</div><div class="crayon-line" id="crayon-5a104183b0b3e372868658-3"><span class="crayon-c">// ipcheck.js</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0b3e372868658-4">&nbsp;</div><div class="crayon-line" id="crayon-5a104183b0b3e372868658-5"><span class="crayon-c">// list of allowed IPs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0b3e372868658-6"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">allowed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></div><div class="crayon-line" id="crayon-5a104183b0b3e372868658-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'127.0.0.1'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0b3e372868658-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'192.168.2.12'</span></div><div class="crayon-line" id="crayon-5a104183b0b3e372868658-9"><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0b3e372868658-10">&nbsp;</div><div class="crayon-line" id="crayon-5a104183b0b3e372868658-11"><span class="crayon-c">// the middleware function</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0b3e372868658-12"><span class="crayon-v">module</span><span class="crayon-sy">.</span><span class="crayon-v">exports</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183b0b3e372868658-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">res</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">next</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0b3e372868658-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">allowed</span><span class="crayon-sy">.</span><span class="crayon-e">indexOf</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">connection</span><span class="crayon-sy">.</span><span class="crayon-v">remoteAddress</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183b0b3e372868658-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-e">status</span><span class="crayon-sy">(</span><span class="crayon-cn">403</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">send</span><span class="crayon-sy">(</span><span class="crayon-s">"You do not have access to delete this resource"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0b3e372868658-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183b0b3e372868658-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">next</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0b3e372868658-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183b0b3e372868658-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0b3e372868658-20"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b0b3e372868658-21">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0033 seconds] -->
<p></p>
<p>And you can use this middleware on your delete request</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b0b47414217955" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var ipcheck = require('./ipcheck.js');
/// snipp
router.delete('/api/v1/product/:id', ipcheck, products.delete);
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b0b47414217955-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0b47414217955-2">2</div><div class="crayon-num" data-line="crayon-5a104183b0b47414217955-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b0b47414217955-4">4</div><div class="crayon-num" data-line="crayon-5a104183b0b47414217955-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b0b47414217955-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0b47414217955-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">ipcheck</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'./ipcheck.js'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b0b47414217955-3"><span class="crayon-c">/// snipp</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b0b47414217955-4"><span class="crayon-v">router</span><span class="crayon-sy">.</span><span class="crayon-e">delete</span><span class="crayon-sy">(</span><span class="crayon-s">'/api/v1/product/:id'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ipcheck</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">products</span><span class="crayon-sy">.</span><span class="crayon-v">delete</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b0b47414217955-5">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p></p>
<p>More info : <a href="http://www.hacksparrow.com/how-to-write-midddleware-for-connect-express-js.html" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://www.hacksparrow.com/how-to-write-midddleware-for-connect-express-js.html', 'http://www.hacksparrow.com/how-to-write-midddleware-for-connect-express-js.html');" rel="nofollow">http://www.hacksparrow.com/how-to-write-midddleware-for-connect-express-js.html</a></p>
<p>Thanks.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-2597">
<div id="dsq-comment-header-2597" class="dsq-comment-header">
<cite id="dsq-cite-2597">
<span id="dsq-author-user-2597">Robin Duda</span>
</cite>
</div>
<div id="dsq-comment-body-2597" class="dsq-comment-body">
<div id="dsq-comment-message-2597" class="dsq-comment-message"><p>Using bodyParser, the content type of req.body parameters are not limited to strings. An attacker may post to the server specifying the JSON-type, req.body would then contain an object. If you send this object to the database without verifying it&#8217;s type, injections are possible. Consider the following payload for /login, { username: &#8220;administrator&#8221;, password: {&#8220;$gt&#8221;:&#8221;&#8221;} }. </p>
<p>How do you handle this scenario?</p>
<p>&#8220;You can request the client to send the logged in user’s username along with the token. This way, first we will authenticate the token and then the client.&#8221; </p>
<p>How does this improve security when a token is generated by a /login? Should the tokens not be bound to an user on the server? </p>
<p>If an attacker acquires only the token, it cannot be used since the username is also required. But the token and username are always sent together, thus if the attacker gains access to the token the username will also be available.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2607">
<div id="dsq-comment-header-2607" class="dsq-comment-header">
<cite id="dsq-cite-2607">
./                <span id="dsq-author-user-2607">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2607" class="dsq-comment-body">
<div id="dsq-comment-message-2607" class="dsq-comment-message"><p>Hey Robin, </p>
<p>Very valid points. To answer the question, based on my knowledge</p>
<p>1. The password which is sent from the client in plain text, will be hashed. So they no more look like injectable pieces of mongoDB queries. And as far as the application logic goes, we are no where evaluating the password. So I think we should be safe. (Let me know if I missed something here)</p>
<p>2. So, there is where the concept of OAuth 2.0 comes into picture. Where the client and server exchange tokens which gets created based on an API key. That solution would be a full blow OAuth server, that registers a client with a API key and then allows it to make calls to it.<br />
Did that answer your question?</p>
<p>Thanks,<br />
Arvind.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-3" id="dsq-comment-2608">
<div id="dsq-comment-header-2608" class="dsq-comment-header">
<cite id="dsq-cite-2608">
<span id="dsq-author-user-2608">Robin Duda</span>
</cite>
</div>
<div id="dsq-comment-body-2608" class="dsq-comment-body">
<div id="dsq-comment-message-2608" class="dsq-comment-message"><p>Thank you for the reply.</p>
<p>Yes the password will be hashed before it is added to a query, however if the password is itself an object the hashing function will fail. The hashing function will throw an exception since it expects a buffer and not an object, the server will most likely crash.</p>
<p>The username should still be able to inject queries if it&#8217;s passed directly into one. Depending on the implementation the attacker might be able to attempt a login to all accounts at once with one password, or attempt logins to accounts without knowing their username. I am unsure whether the second password parameter could be modified or nullified, like SQL );&#8211;</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-4" id="dsq-comment-2611">
<div id="dsq-comment-header-2611" class="dsq-comment-header">
<cite id="dsq-cite-2611">
./                <span id="dsq-author-user-2611">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2611" class="dsq-comment-body">
<div id="dsq-comment-message-2611" class="dsq-comment-message"><p>Good point! Have not tried it though. I will give it a try. This article was my first attempt at security in Nodejs. I have learned a lot since then. I will probably write one more article with a couple of new approaches. Thanks for your comments!!</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-2557">
<div id="dsq-comment-header-2557" class="dsq-comment-header">
<cite id="dsq-cite-2557">
http://www.i-visionblog.com/                <span id="dsq-author-user-2557">s.shivasurya</span>
</cite>
</div>
<div id="dsq-comment-body-2557" class="dsq-comment-body">
<div id="dsq-comment-message-2557" class="dsq-comment-message"><p>really awesome !</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-2542">
<div id="dsq-comment-header-2542" class="dsq-comment-header">
<cite id="dsq-cite-2542">
<span id="dsq-author-user-2542">Maxime ROBERT</span>
</cite>
</div>
<div id="dsq-comment-body-2542" class="dsq-comment-body">
<div id="dsq-comment-message-2542" class="dsq-comment-message"><p>Hi, thx for this great tutorial Arvind !<br />
I have a problem when i try to log in.</p>
<p>The error is the following : &#8220;Error: Not Found  &nbsp; &nbsp;at /home/maxime/Desktop/myRESTApp-master/server/server.js:34:13&#8243;</p>
<p>Do you have any idea why ? </p>
<p>Cheers</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2543">
<div id="dsq-comment-header-2543" class="dsq-comment-header">
<cite id="dsq-cite-2543">
./                <span id="dsq-author-user-2543">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2543" class="dsq-comment-body">
<div id="dsq-comment-message-2543" class="dsq-comment-message"><p>Hi Robert. Thanks! May I know to which end point are you making a request to?</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2544">
<div id="dsq-comment-header-2544" class="dsq-comment-header">
<cite id="dsq-cite-2544">
https://friendly-account.fr                <span id="dsq-author-user-2544">Maxime ROBERT</span>
</cite>
</div>
<div id="dsq-comment-body-2544" class="dsq-comment-body">
<div id="dsq-comment-message-2544" class="dsq-comment-message"><p>Not sure of what you mean, correct me if i&#8217;m not answering well.<br />
(what do you call &#8220;end point&#8221; ?)</p>
<p>I&#8217;m trying to reach the api with postman at the following url : <a href="http://localhost:3000/login?username=arvind@myapp.com&#038;password=pass123" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:3000/login?username=arvind@myapp.com&amp;password=pass123', 'http://localhost:3000/login?username=arvind@myapp.com&amp;password=pass123');" rel="nofollow">http://localhost:3000/<span class="__cf_email__" data-cfemail="204c4f47494e1f555345524e414d451d415256494e44604d594150500e434f4d">[email&#160;protected]</span>&#038;password=pass123</a></p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-2546">
<div id="dsq-comment-header-2546" class="dsq-comment-header">
<cite id="dsq-cite-2546">
./                <span id="dsq-author-user-2546">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2546" class="dsq-comment-body">
<div id="dsq-comment-message-2546" class="dsq-comment-message"><p>The end point here is /login. And if you see the routes, /login is of type post. So,  you cannot use the browser address bar to make the call. You need to create a new request with type post to <a href="http://localhost:3000/login" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:3000/login', 'http://localhost:3000/login');" rel="nofollow">http://localhost:3000/login</a> and send the username and password as request body or Payload. You can either use curl to make a request or a chrome extension like postman to do the same. </p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="dsq-comment-2492">
<div id="dsq-comment-header-2492" class="dsq-comment-header">
<cite id="dsq-cite-2492">
<span id="dsq-author-user-2492">Lamar</span>
</cite>
</div>
<div id="dsq-comment-body-2492" class="dsq-comment-body">
<div id="dsq-comment-message-2492" class="dsq-comment-message"><p>Wouldn&#8217;t it be more secure to do this in auth.js:</p>
<p>function genToken(user) {<br />
var expires = expiresIn(7); // 7 days<br />
var token = jwt.encode({<br />
exp: expires,<br />
user: user // add the user object to the token<br />
}, require(&#8216;../config/secret&#8217;)());</p>
<p>Then later in middlewares/validateRequest.js do this:</p>
<p>var dbUser = validateUser(decoded.user.name); // The key would be the logged in user&#8217;s username</p>
<p>This way you can eliminate the need for the extra &#8216;x-key&#8217; header and you will prevent a user from escalating privileges by:<br />
1. getting a valid token for a user that has lower permissions<br />
2. passing that valid token and an &#8216;x-key&#8217; of an admin user</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2493">
<div id="dsq-comment-header-2493" class="dsq-comment-header">
<cite id="dsq-cite-2493">
./                <span id="dsq-author-user-2493">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2493" class="dsq-comment-body">
<div id="dsq-comment-message-2493" class="dsq-comment-message"><p>Hello Lamar, Yes, You can could do that as well.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2650">
<div id="dsq-comment-header-2650" class="dsq-comment-header">
<cite id="dsq-cite-2650">
<span id="dsq-author-user-2650">Buri Erich</span>
</cite>
</div>
<div id="dsq-comment-body-2650" class="dsq-comment-body">
<div id="dsq-comment-message-2650" class="dsq-comment-message"><p>It&#8217;s a great tutorial, thank you!<br />
But what Lamar pointed out is a not a &#8220;could do&#8221;, it&#8217;s  a MUST DO! You should fix this in the tutorial as people copy &amp; paste and distribute this vulnerability!</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-2656">
<div id="dsq-comment-header-2656" class="dsq-comment-header">
<cite id="dsq-cite-2656">
./                <span id="dsq-author-user-2656">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2656" class="dsq-comment-body">
<div id="dsq-comment-message-2656" class="dsq-comment-message"><p>Thanks Buri. Sure. I am planning to write one more article (I don&#8217;t know when!) on all the things I learnt after I wrote this one. I will add this and more to that! Thanks for pointing it out!</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="dsq-comment-2810">
<div id="dsq-comment-header-2810" class="dsq-comment-header">
<cite id="dsq-cite-2810">
<span id="dsq-author-user-2810">Thomas Dunne</span>
</cite>
</div>
<div id="dsq-comment-body-2810" class="dsq-comment-body">
<div id="dsq-comment-message-2810" class="dsq-comment-message"><p>I think this is very important to implement too. Without it, everyone can get admin level privileges by just changing this header.</p>
<p>Also, removing the password field of the user object (ignoring the fact that the password shouldn&#8217;t be stored, just a hash + random salt), before sending it back to the client would be beneficial in cases that the /login endpoint was the only one secured by an SSL cert.</p>
<p>Quick question: is using a secret-encrypted access token beneficial? Wouldn&#8217;t storing a shorter, random token (until it expired or is invalidated) be better?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-3205">
<div id="dsq-comment-header-3205" class="dsq-comment-header">
<cite id="dsq-cite-3205">
http://kolyjjj.github.io                <span id="dsq-author-user-3205">koly</span>
</cite>
</div>
<div id="dsq-comment-body-3205" class="dsq-comment-body">
<div id="dsq-comment-message-3205" class="dsq-comment-message"><p>I believe it is more safe to use a random token, however if a random token is used, you need a relationship between the user and the token, and somewhere to store it. So if a random token is used, we may need back-end storage(redis or database) to store the mapping between user and the token, so when the token is sent to server, server can know the user from the token by a query.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="dsq-comment-3120">
<div id="dsq-comment-header-3120" class="dsq-comment-header">
<cite id="dsq-cite-3120">
<span id="dsq-author-user-3120">Marco Solari</span>
</cite>
</div>
<div id="dsq-comment-body-3120" class="dsq-comment-body">
<div id="dsq-comment-message-3120" class="dsq-comment-message"><p>This is for sure very important.<br />
Just a question: how to get the username on the client, if you only have the encripted token? Should you decript it client-side, too? I&#8217;m a bit confused&#8230; <img src="./wp-includes/images/smilies/frownie.png" alt=":-(" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even depth-2" id="dsq-comment-3145">
<div id="dsq-comment-header-3145" class="dsq-comment-header">
<cite id="dsq-cite-3145">
<span id="dsq-author-user-3145">aldopraherda</span>
</cite>
</div>
<div id="dsq-comment-body-3145" class="dsq-comment-body">
<div id="dsq-comment-message-3145" class="dsq-comment-message"><p>Hi Lamar<br />
do you have updated code about this vulnerability if yes please share</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-2490">
<div id="dsq-comment-header-2490" class="dsq-comment-header">
<cite id="dsq-cite-2490">
<span id="dsq-author-user-2490">Varma Bhupatiraju</span>
</cite>
</div>
<div id="dsq-comment-body-2490" class="dsq-comment-body">
<div id="dsq-comment-message-2490" class="dsq-comment-message"><p>Great start to securing Node services. Well done Arvind!!!</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-2466">
<div id="dsq-comment-header-2466" class="dsq-comment-header">
<cite id="dsq-cite-2466">
<span id="dsq-author-user-2466">salesmen library</span>
</cite>
</div>
<div id="dsq-comment-body-2466" class="dsq-comment-body">
<div id="dsq-comment-message-2466" class="dsq-comment-message"><p>Hi @arvindravulavaru:disqus I am trying to replace your DB spoof object with an object from the database, however, I am unable to make it work. Could you please help me out?<br />
I am using Bookshelf ORM, with MySQL database. I added a new function to users.js for checkLogin case as below:</p>
<p>checkLogin: function(username, password) {</p>
<p>      return new Users({&#8216;username':username, &#8216;password_hash': password}).fetch()<br />
.then(function(user) {<br />
return user.toJSON();<br />
}).catch(function(error) {<br />
console.log(error);<br />
return &#8221;;<br />
});<br />
}</p>
<p>and in auth.js replaced the dbSpoof with:</p>
<p>validate: function(username, password) {<br />
// spoofing the DB response for simplicity<br />
// var dbUserObj = { // spoofing a userobject from the DB.<br />
//   name: &#8216;sales.men&#8217;,<br />
//   role: &#8216;admin&#8217;,<br />
//   username: &#8216;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="493a28252c3a67242c27092e24282025672a2624">[email&#160;protected]</a>&#8217;<br />
// };<br />
var dbUserObj = users.checkLogin(username, password);</p>
<p>    return dbUserObj;<br />
},</p>
<p>When I console.log dbUserObj, it returns a promise object and since the below is always true, I do not receive an error when I pass in the wrong credentials:</p>
<p>if (!dbUserObj) { // If authentication fails, we send a 401 back<br />
res.status(401);<br />
res.json({<br />
&#8220;status&#8221;: 401,<br />
&#8220;message&#8221;: &#8220;Invalid credentials&#8221;<br />
});<br />
return;<br />
}</p>
<p>    if (dbUserObj) {</p>
<p>      // If authentication is success, we will generate a token<br />
// and dispatch it to the client</p>
<p>      res.json(genToken(dbUserObj));<br />
}</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2472">
<div id="dsq-comment-header-2472" class="dsq-comment-header">
<cite id="dsq-cite-2472">
<span id="dsq-author-user-2472">salesmen library</span>
</cite>
</div>
<div id="dsq-comment-body-2472" class="dsq-comment-body">
<div id="dsq-comment-message-2472" class="dsq-comment-message"><p>Hey @arvindravulavaru:disqus, I have solved this problem. Cheers.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-3" id="dsq-comment-2473">
<div id="dsq-comment-header-2473" class="dsq-comment-header">
<cite id="dsq-cite-2473">
./                <span id="dsq-author-user-2473">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2473" class="dsq-comment-body">
<div id="dsq-comment-message-2473" class="dsq-comment-message"><p>Cool! What was the issue?</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-4" id="dsq-comment-2475">
<div id="dsq-comment-header-2475" class="dsq-comment-header">
<cite id="dsq-cite-2475">
<span id="dsq-author-user-2475">salesmen library</span>
</cite>
</div>
<div id="dsq-comment-body-2475" class="dsq-comment-body">
<div id="dsq-comment-message-2475" class="dsq-comment-message"><p>The world of async. I was trying to get the async function to return the value. I changed the code to use promises and pass in the result from async function to generate token later. <img src="./wp-includes/images/smilies/simple-smile.png" alt=":)" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
</div>
</div>
<ul class="children">
<li class="comment even depth-5" id="dsq-comment-2476">
<div id="dsq-comment-header-2476" class="dsq-comment-header">
<cite id="dsq-cite-2476">
<span id="dsq-author-user-2476">salesmen library</span>
</cite>
</div>
<div id="dsq-comment-body-2476" class="dsq-comment-body">
<div id="dsq-comment-message-2476" class="dsq-comment-message"><p>As well, because bookshelf returns a promise.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-2457">
<div id="dsq-comment-header-2457" class="dsq-comment-header">
<cite id="dsq-cite-2457">
<span id="dsq-author-user-2457">salesmen library</span>
</cite>
</div>
<div id="dsq-comment-body-2457" class="dsq-comment-body">
<div id="dsq-comment-message-2457" class="dsq-comment-message"><p>@arvindravulavaru:disqus<br />
Great article. Thanks a lot!<br />
I have a question.. When I POST using REST client &#8220;http://localhost:3000/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="aec2c1c9c7c091dbddcbdcc0cfc3cb93ddcfc2cbdd80c3cbc0eec9c3cfc7c280cdc1c3">[email&#160;protected]</a>&amp;password=abc112&#8243;, I receive an error : </p>
<p>{<br />
status: 401<br />
message: &#8220;Invalid credentials&#8221;<br />
}<br />
I have the following line of code in server.js<br />
app.use(bodyParser.json());<br />
As I tried debugging a bit, I found that it never reaches to the database call section in auth.js. I read the comments below as well and tried content-type:application/json but to no avail.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2458">
<div id="dsq-comment-header-2458" class="dsq-comment-header">
<cite id="dsq-cite-2458">
<span id="dsq-author-user-2458">salesmen library</span>
</cite>
</div>
<div id="dsq-comment-body-2458" class="dsq-comment-body">
<div id="dsq-comment-message-2458" class="dsq-comment-message"><p>Hey, I found the solution: I am using a windows client with CURL now..<br />
curl -D- -X POST &#8211;data @tests/test-data.json -H &#8220;Content-Type: application/json&#8221; <a href="http://localhost:3000/login" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:3000/login', 'http://localhost:3000/login');" rel="nofollow">http://localhost:3000/login</a><br />
contents of the file have the json data to post.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2463">
<div id="dsq-comment-header-2463" class="dsq-comment-header">
<cite id="dsq-cite-2463">
./                <span id="dsq-author-user-2463">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2463" class="dsq-comment-body">
<div id="dsq-comment-message-2463" class="dsq-comment-message"><p>Is this not working</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b1538043830179" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
curl –data “{”username” : ”arvind@myapp.com”, ”password” : ”pass123”}” -H “content-type:application/json” http://localhost:3000/login</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b1538043830179-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b1538043830179-1"><span class="crayon-h"> </span><span class="crayon-e">curl</span><span class="crayon-h"> </span>–<span class="crayon-e">data</span><span class="crayon-h"> </span>“<span class="crayon-sy">{</span>”<span class="crayon-i">username</span>”<span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span>”<span class="crayon-v">arvind</span><span class="crayon-sy">@</span><span class="crayon-v">myapp</span><span class="crayon-sy">.</span><span class="crayon-i">com</span>”<span class="crayon-sy">,</span><span class="crayon-h"> </span>”<span class="crayon-i">password</span>”<span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span>”<span class="crayon-i">pass123</span>”<span class="crayon-sy">}</span>”<span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">H</span><span class="crayon-h"> </span>“<span class="crayon-v">content</span><span class="crayon-o">-</span><span class="crayon-v">type</span><span class="crayon-o">:</span><span class="crayon-v">application</span><span class="crayon-o">/</span><span class="crayon-i">json</span>”<span class="crayon-h"> </span><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//localhost:3000/login</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0015 seconds] -->
<p></p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-2464">
<div id="dsq-comment-header-2464" class="dsq-comment-header">
<cite id="dsq-cite-2464">
<span id="dsq-author-user-2464">salesmen library</span>
</cite>
</div>
<div id="dsq-comment-body-2464" class="dsq-comment-body">
<div id="dsq-comment-message-2464" class="dsq-comment-message"><p>No it isn&#8217;t on windows. I suspect because of a different version of curl or the requirement of explicitly setting the arguments -X POST.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-5" id="dsq-comment-2664">
<div id="dsq-comment-header-2664" class="dsq-comment-header">
<cite id="dsq-cite-2664">
<span id="dsq-author-user-2664">Patrick R</span>
</cite>
</div>
<div id="dsq-comment-body-2664" class="dsq-comment-body">
<div id="dsq-comment-message-2664" class="dsq-comment-message"><p>Kevin suggested this to me, and it worked for me.</p>
<p>curl -d &#8216;{&#8220;username&#8221;:&#8221;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3c5d4e4a5552587c51455d4c4c125f5351">[email&#160;protected]</a>&#8221;, &#8220;password&#8221;: &#8220;pass123&#8243;}&#8217; -H &#8216;Content-type: application/json&#8217; <a href="http://localhost:3000/login" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:3000/login', 'http://localhost:3000/login');" rel="nofollow">http://localhost:3000/login</a></p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-4" id="dsq-comment-2465">
<div id="dsq-comment-header-2465" class="dsq-comment-header">
<cite id="dsq-cite-2465">
<span id="dsq-author-user-2465">salesmen library</span>
</cite>
</div>
<div id="dsq-comment-body-2465" class="dsq-comment-body">
<div id="dsq-comment-message-2465" class="dsq-comment-message"><p>@arvindravulavaru:disqus<br />
Hey Arvind, I was just thinking, why haven&#8217;t you used promises?<br />
Moreover, how could I implement the SCIM architecture as it is believed that the person having an account only uses the app and must login.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-5" id="dsq-comment-2686">
<div id="dsq-comment-header-2686" class="dsq-comment-header">
<cite id="dsq-cite-2686">
./                <span id="dsq-author-user-2686">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2686" class="dsq-comment-body">
<div id="dsq-comment-message-2686" class="dsq-comment-message"><p>Sorry I missed your comment somehow.</p>
<p>Use promises where?  Also can you elaborate on the SCIM and how it can applied here?</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-2455">
<div id="dsq-comment-header-2455" class="dsq-comment-header">
<cite id="dsq-cite-2455">
<span id="dsq-author-user-2455">b4dblog</span>
</cite>
</div>
<div id="dsq-comment-body-2455" class="dsq-comment-body">
<div id="dsq-comment-message-2455" class="dsq-comment-message"><p>Tnks mate!</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-2450">
<div id="dsq-comment-header-2450" class="dsq-comment-header">
<cite id="dsq-cite-2450">
<span id="dsq-author-user-2450">Anil</span>
</cite>
</div>
<div id="dsq-comment-body-2450" class="dsq-comment-body">
<div id="dsq-comment-message-2450" class="dsq-comment-message"><p>Hello Arvind,</p>
<p>I have a question may sound silly but asking.<br />
After authentication client will have a valid token with username in it, is it necessary to query db for checking username on every api request with valid token? can&#8217;t we just check if token is valid and and get username from it and use it without querying db for checking the username as token is valid. Don&#8217;t you think every api request will fire a db query thousands of api request and with every request a db query that will create a lot of extra load on database server.</p>
<p>Thanks,<br />
Anil</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2451">
<div id="dsq-comment-header-2451" class="dsq-comment-header">
<cite id="dsq-cite-2451">
./                <span id="dsq-author-user-2451">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2451" class="dsq-comment-body">
<div id="dsq-comment-message-2451" class="dsq-comment-message"><p>Hello Anil,</p>
<p>This DB call on every request will add an extra security to the app. Imagine a user has expired his/her paid subscription to your app. His token was generated when his subscription was valid. How do you check with every request if the user is authorized/subscribed to use your app? </p>
<p>This extra DB call will gets more info. about the user so that you can make decisions about his/her access. Imagine you have role based routes/APIs that a certain segment of users can only access. This extra call will help you with that. In the above scenario, you may argue that you would send the user&#8217;s role along with the token &amp; email. In that case, the extra DB call would not be needed to make a decision on the Route/API access. </p>
<p>But in the first case, you would need to be 100% sure that no one is mooching off your app. </p>
<p>Does this makes sense? </p>
<p>Also, if you are worried about the DB query performance, I recommend</p>
<p>1. <a href="http://docs.mongodb.org/manual/faq/fundamentals/#does-mongodb-handle-caching" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://docs.mongodb.org/manual/faq/fundamentals/#does-mongodb-handle-caching', 'MongoDB Cache');" rel="nofollow">MongoDB Cache</a></p>
<p>2. <a href="http://stackoverflow.com/questions/14243588/caching-repeating-query-results-in-mongodb" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://stackoverflow.com/questions/14243588/caching-repeating-query-results-in-mongodb', 'Caching repeating query results in MongoDB');" rel="nofollow">Caching repeating query results in MongoDB</a></p>
<p>3. <a href="https://github.com/conancat/mongoose-redis-cache" onclick="__gaTracker('send', 'event', 'outbound-comment', 'https://github.com/conancat/mongoose-redis-cache', 'mongoose-redis-cache');" rel="nofollow">mongoose-redis-cache</a></p>
<p>Thanks.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2452">
<div id="dsq-comment-header-2452" class="dsq-comment-header">
<cite id="dsq-cite-2452">
<span id="dsq-author-user-2452">Anil</span>
</cite>
</div>
<div id="dsq-comment-body-2452" class="dsq-comment-body">
<div id="dsq-comment-message-2452" class="dsq-comment-message"><p>Thanks Arvind.<br />
If the user is not in a scenario of subscription based api then do you think its ok without checking for username by querying DB? what do you recommend should I check by DB call on every api call?</p>
<p>Also one more question related to deployment, is it ok to deploy MongoDB server on the same application server where I am hosting the api or Mongodb server should be deployed on a separate server than application server? If we can deploy both on same server do you think it will create any performance issue for the apis?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-2453">
<div id="dsq-comment-header-2453" class="dsq-comment-header">
<cite id="dsq-cite-2453">
./                <span id="dsq-author-user-2453">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2453" class="dsq-comment-body">
<div id="dsq-comment-message-2453" class="dsq-comment-message"><p>That is a decision that you and your team need to take based on the application you are building. I recommend leaving the db call in place and using it to re-authenticate the user on every request. </p>
<p>As far as the deployment goes, it again depends on the load. You can see how your app performs when both the app server and db are on the same box. If the performance is not as expected, you can separate them. This is the cloud era, so problems like this are already solved. You can design your app for horizontal scaling as you need. </p>
<p>Thanks. </p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-5" id="dsq-comment-2454">
<div id="dsq-comment-header-2454" class="dsq-comment-header">
<cite id="dsq-cite-2454">
<span id="dsq-author-user-2454">Anil</span>
</cite>
</div>
<div id="dsq-comment-body-2454" class="dsq-comment-body">
<div id="dsq-comment-message-2454" class="dsq-comment-message"><p>Thanks Arvind.</p>
<p>I have one more question. When a user logs out token gets removed from the on the Angular or any other client side, but it&#8217;s still a valid token and could be used by an attacker to make request on the API until its expiration. How to handle the log out? Can you give some suggestions on that.</p>
<p>Thanks.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-2446">
<div id="dsq-comment-header-2446" class="dsq-comment-header">
<cite id="dsq-cite-2446">
<span id="dsq-author-user-2446">John</span>
</cite>
</div>
<div id="dsq-comment-body-2446" class="dsq-comment-body">
<div id="dsq-comment-message-2446" class="dsq-comment-message"><p>Hi Arvind,</p>
<p>Thanks for such a great and helpful article it really helped me a lot.</p>
<p>I using your architecture for creating an API for multiple devices and need your help in creating refresh tokens for authentication so that API can generate a refresh token without asking for username and password whenever authentication token is expired. Please can you write some code and show how this can be done in the above architecture.</p>
<p>That will really help me and maybe others too.</p>
<p>Thanks so much in advance.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2447">
<div id="dsq-comment-header-2447" class="dsq-comment-header">
<cite id="dsq-cite-2447">
./                <span id="dsq-author-user-2447">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2447" class="dsq-comment-body">
<div id="dsq-comment-message-2447" class="dsq-comment-message"><p>Hello John,</p>
<p>Thanks! First off, Auto refreshing tokens may be a security risk. Please use them with caution. Understand and see if there might be any security threats in your app. Some way &#8220;an unintended&#8221; user can gain access to another user&#8217;s machine and the token auto refreshes and the &#8220;unintended&#8221; user can see the actual user&#8217;s data. Does this makes sense?</p>
<p>If you still want, below is the solution for auto-refreshing tokens</p>
<p>Step 1 : Let server dispatch a 401 when the token is expired (<a href="http://stackoverflow.com/a/10135309/1015046" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://stackoverflow.com/a/10135309/1015046', 'http://stackoverflow.com/a/10135309/1015046');" rel="nofollow">http://stackoverflow.com/a/10135309/1015046</a>) </p>
<p>Step 2 : Create another REST End point which takes a Username/Email Address and generates a new token. Similar to the login method, expect this takes only the username/email address and generates the token after querying the DB.</p>
<p>Step 3 : Update the token interceptor inside Angularjs like</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b1b0c995407570" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
myApp.factory('TokenInterceptor', function($q, $window) {
return {
request: function(config) {
config.headers = config.headers || {};
if ($window.sessionStorage.token) {
config.headers['X-Access-Token'] = $window.sessionStorage.token;
config.headers['X-Key'] = $window.sessionStorage.user;
config.headers['Content-Type'] = "application/json";
}
return config || $q.when(config);
},
response: function(response) {
return response || $q.when(response);
},
responseError: function (rejection) { // http://stackoverflow.com/a/24321432/1015046
if(rejection.status === 401) {
// you are not authorised
// invoke a service here to refresh the token
}
return $q.reject(rejection);
}
};
});
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-2">2</div><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-4">4</div><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-6">6</div><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-8">8</div><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-10">10</div><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-12">12</div><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-14">14</div><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-16">16</div><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-18">18</div><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-20">20</div><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-22">22</div><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-24">24</div><div class="crayon-num" data-line="crayon-5a104183b1b0c995407570-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b1b0c995407570-26">26</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b1b0c995407570-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-2"><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-e">factory</span><span class="crayon-sy">(</span><span class="crayon-s">'TokenInterceptor'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">q</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183b1b0c995407570-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">request</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183b1b0c995407570-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">headers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">headers</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183b1b0c995407570-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">headers</span><span class="crayon-sy">[</span><span class="crayon-s">'X-Access-Token'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">headers</span><span class="crayon-sy">[</span><span class="crayon-s">'X-Key'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">sessionStorage</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b1b0c995407570-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">headers</span><span class="crayon-sy">[</span><span class="crayon-s">'Content-Type'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"application/json"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a104183b1b0c995407570-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">config</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">q</span><span class="crayon-sy">.</span><span class="crayon-e">when</span><span class="crayon-sy">(</span><span class="crayon-v">config</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a104183b1b0c995407570-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">response</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">q</span><span class="crayon-sy">.</span><span class="crayon-e">when</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b1b0c995407570-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-16">&nbsp;</div><div class="crayon-line" id="crayon-5a104183b1b0c995407570-17"><span class="crayon-v">responseError</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">rejection</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">// http://stackoverflow.com/a/24321432/1015046</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">rejection</span><span class="crayon-sy">.</span><span class="crayon-v">status</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-cn">401</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183b1b0c995407570-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// you are not authorised</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-20"><span class="crayon-c">// invoke a service here to refresh the token</span></div><div class="crayon-line" id="crayon-5a104183b1b0c995407570-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">q</span><span class="crayon-sy">.</span><span class="crayon-e">reject</span><span class="crayon-sy">(</span><span class="crayon-v">rejection</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b1b0c995407570-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-24"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b1b0c995407570-25"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b1b0c995407570-26">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0061 seconds] -->
<p></p>
<p>Inside the responseError, when you receive a 401,  make a request to the REST end point on Step 2 and get a new token. </p>
<p>PS : I have not tried this solution, but it should &#8220;technically&#8221; work.</p>
<p>Let me know otherwise.</p>
<p>Thanks,<br />
Arvind.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-3" id="dsq-comment-2448">
<div id="dsq-comment-header-2448" class="dsq-comment-header">
<cite id="dsq-cite-2448">
<span id="dsq-author-user-2448">John</span>
</cite>
</div>
<div id="dsq-comment-body-2448" class="dsq-comment-body">
<div id="dsq-comment-message-2448" class="dsq-comment-message"><p>Hi Arvind,</p>
<p>Thanks so much for the help and for mentioning about the unintended user security threat.</p>
<p>Actually I want to implement auto-refresh tokens for native Android app as user only usually logs in only once in it. Please give your suggestion if auto-refresh token is the right way or I should implement some other solution for native Android app authentication from the API.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-4" id="dsq-comment-2449">
<div id="dsq-comment-header-2449" class="dsq-comment-header">
<cite id="dsq-cite-2449">
./                <span id="dsq-author-user-2449">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2449" class="dsq-comment-body">
<div id="dsq-comment-message-2449" class="dsq-comment-message"><p>Hello John,</p>
<p>This totally depends on the what kind of data you are dealing with and how much security you want. As per my knowledge and experience, I would set a high value for the expiry date of the token. May be 6 months, 1 year? but not implement an auto-refreshing system. Asking a user to login after 6 months seems reasonable. </p>
<p>Also another alternative is to generate a new token on every 5th or 10th request (depending on the API usage) when a user makes a request to the server with a valid token. This may or may not be a better solution depending on the app you want to implement. But, this way you are not worried about an end-point that exposes an auto-refreshing token but rather the token refreshes on the usage of the server. </p>
<p>You can combine the above two approaches and make a system, where the token generated expires every 6 months and with every 10th request from the client to the server API, you send a flag asking the server to send a new token, after authenticating and authorizing both the request and the user. This way, your auto-refresh happens on an on-demand basis. </p>
<p>Thanks.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-2427">
<div id="dsq-comment-header-2427" class="dsq-comment-header">
<cite id="dsq-cite-2427">
<span id="dsq-author-user-2427">jack</span>
</cite>
</div>
<div id="dsq-comment-body-2427" class="dsq-comment-body">
<div id="dsq-comment-message-2427" class="dsq-comment-message"><p>Great tutorial thanks so much!! i just was curious tho if the curl command you give is incorrect or some code is?  O am getting issues trying to get a token with the fixed user you suggest and am not getting very much luck.  after removing the</p>
<p> || &#8221;</p>
<p>out of the lines:</p>
<p>var username = req.body.username || &#8221;;<br />
var password = req.body.password || &#8221;;</p>
<p>I was able to get a token with postman, but no luck with curl on the command line.  I played around a bit with the parameters but didn&#8217;t have any luck.  Was curious if you could help out.  I am using a mac, and I tried several times with your code and me replicating the project.  the error I get with curl is  </p>
<p>curl: (3) [globbing] unmatched brace in column 4<br />
curl: (7) Failed to connect to  port 80: Connection refused<br />
curl: (6) Could not resolve host: myapp.com”,<br />
curl: (6) Could not resolve host: ”password”<br />
curl: (7) Failed to connect to  port 80: Connection refused<br />
curl: (3) [globbing] unmatched close brace/bracket in column 14<br />
curl: (52) Empty reply from server</p>
<p>and when I use postman without romoving the or check for empty string I get an error for invalid credentials and tracked it to this check in auth.js</p>
<p>if (username == &#8221; || password == &#8221;) {<br />
res.status(401);<br />
res.json({<br />
&#8220;status&#8221;: 401,<br />
&#8220;message&#8221;: &#8220;Invalid credentials&#8221;<br />
});<br />
return;<br />
}</p>
<p>Well any help would be very much appreciated, but also thanks so much for a great article, hard to find stuff specifically on rest api authentication.</p>
<p>Thank!</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2436">
<div id="dsq-comment-header-2436" class="dsq-comment-header">
<cite id="dsq-cite-2436">
./                <span id="dsq-author-user-2436">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2436" class="dsq-comment-body">
<div id="dsq-comment-message-2436" class="dsq-comment-message"><p>Hello Jack. Thanks! Can you paste the curl command you are using here?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-3" id="dsq-comment-2442">
<div id="dsq-comment-header-2442" class="dsq-comment-header">
<cite id="dsq-cite-2442">
<span id="dsq-author-user-2442">jack</span>
</cite>
</div>
<div id="dsq-comment-body-2442" class="dsq-comment-body">
<div id="dsq-comment-message-2442" class="dsq-comment-message"><p>I used the command you provide in the article, the second one u use to try to get a token</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-4" id="dsq-comment-2443">
<div id="dsq-comment-header-2443" class="dsq-comment-header">
<cite id="dsq-cite-2443">
./                <span id="dsq-author-user-2443">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2443" class="dsq-comment-body">
<div id="dsq-comment-message-2443" class="dsq-comment-message"><p>It still works for me. Can you copy paste the same here?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-5" id="dsq-comment-2444">
<div id="dsq-comment-header-2444" class="dsq-comment-header">
<cite id="dsq-cite-2444">
<span id="dsq-author-user-2444">jack</span>
</cite>
</div>
<div id="dsq-comment-body-2444" class="dsq-comment-body">
<div id="dsq-comment-message-2444" class="dsq-comment-message"><p>Hmm are you using a windows machine? I think the curl command is just nota syntactically right.. The curl is the same curl u did, sorry I am away from a computer, but its curl -data&#8230; And the errors I put below. Thanks again</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2445">
<div id="dsq-comment-header-2445" class="dsq-comment-header">
<cite id="dsq-cite-2445">
./                <span id="dsq-author-user-2445">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2445" class="dsq-comment-body">
<div id="dsq-comment-message-2445" class="dsq-comment-message"><p>I use a Mac.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-2418">
<div id="dsq-comment-header-2418" class="dsq-comment-header">
<cite id="dsq-cite-2418">
<span id="dsq-author-user-2418">Vaclav</span>
</cite>
</div>
<div id="dsq-comment-body-2418" class="dsq-comment-body">
<div id="dsq-comment-message-2418" class="dsq-comment-message"><p>Hi Arvind,</p>
<p>At the beginning you mentioned that if token expires (&#8230;&#8221;If the token is not present/invalid or expired, it will throw a 401 HTTP status code.&#8221;&#8230;), server then returns 401. It seems that validateRequest.js (line 20-27) response to this situation  with status code 400 &#8211; correct me if I&#8217;m wrong.</p>
<p>Excellent article btw <img src="./wp-includes/images/smilies/simple-smile.png" alt=":)" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<p>Cheers,<br />
Vaclav</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2437">
<div id="dsq-comment-header-2437" class="dsq-comment-header">
<cite id="dsq-cite-2437">
./                <span id="dsq-author-user-2437">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2437" class="dsq-comment-body">
<div id="dsq-comment-message-2437" class="dsq-comment-message"><p>Hello Vaclav. Thanks! Yes, you are right. Look at line 63, the else clause. Here, if the token and key are not present I am sending a 401, you can add the same on line 20 as well. This is after decoding the token and validating the same.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-2408">
<div id="dsq-comment-header-2408" class="dsq-comment-header">
<cite id="dsq-cite-2408">
<span id="dsq-author-user-2408">Tadeu</span>
</cite>
</div>
<div id="dsq-comment-body-2408" class="dsq-comment-body">
<div id="dsq-comment-message-2408" class="dsq-comment-message"><p>That perfect! Thanks!</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="dsq-comment-2379">
<div id="dsq-comment-header-2379" class="dsq-comment-header">
<cite id="dsq-cite-2379">
<span id="dsq-author-user-2379">Andreas</span>
</cite>
</div>
<div id="dsq-comment-body-2379" class="dsq-comment-body">
<div id="dsq-comment-message-2379" class="dsq-comment-message"><p>Great article! Im trying to implement mongojs and put my mongo-query in the validate-method. The problem is that since it&#8217;s asynchronous dbUserObj gets undefined and the if-statement will always be false and throw me the &#8220;invalid credentials&#8221;-page. I tried to put &#8220;res.json(genToken(dbUserObj));&#8221; in the querys success callback but then I get &#8220;headers already sent&#8221;-error. Any ideas on this?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2381">
<div id="dsq-comment-header-2381" class="dsq-comment-header">
<cite id="dsq-cite-2381">
./                <span id="dsq-author-user-2381">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2381" class="dsq-comment-body">
<div id="dsq-comment-message-2381" class="dsq-comment-message"><p>Hello Andreas, Thanks! </p>
<p>As you mentioned, all I/O calls in Nodejs are Async. So you need to know how to deal with them. Checkout <a href="./node-js-design-patterns/" rel="nofollow">Nodejs design patterns</a>. You can find a live example of working with Mongojs and Nodejs : <a href="./mean-stack-hands-on-tutorial/" rel="nofollow">MEAN Stack hands on tutorial</a></p>
<p>To answer your question in simple words, move all the code below the DB call into its callback. So the response will be sent only when the DB operation is completed. </p>
<p>Thanks.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2386">
<div id="dsq-comment-header-2386" class="dsq-comment-header">
<cite id="dsq-cite-2386">
<span id="dsq-author-user-2386">Andreas</span>
</cite>
</div>
<div id="dsq-comment-body-2386" class="dsq-comment-body">
<div id="dsq-comment-message-2386" class="dsq-comment-message"><p>Thanks for the help! Solved it by moving the respons inside the callback <img src="./wp-includes/images/smilies/simple-smile.png" alt=":)" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-3081">
<div id="dsq-comment-header-3081" class="dsq-comment-header">
<cite id="dsq-cite-3081">
<span id="dsq-author-user-3081">Michal Zimmermann</span>
</cite>
</div>
<div id="dsq-comment-body-3081" class="dsq-comment-body">
<div id="dsq-comment-message-3081" class="dsq-comment-message"><p>Would you mind sharing the code?</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-2372">
<div id="dsq-comment-header-2372" class="dsq-comment-header">
<cite id="dsq-cite-2372">
<span id="dsq-author-user-2372">SGH</span>
</cite>
</div>
<div id="dsq-comment-body-2372" class="dsq-comment-body">
<div id="dsq-comment-message-2372" class="dsq-comment-message"><p>Hi Arvind,</p>
<p>Thanks for the great tutorial. I am looking forward to using this tutorial towards a project and I need some help.</p>
<p>I have mongodb running and have created the following database and user.</p>
<p>&gt;db.testdb.insert({name:&#8221;John&#8221;,username:&#8221;john&#8221;, password:&#8221;roberts&#8221;, role:&#8221;admin&#8221;})<br />
&gt; db.testdb.find({username:&#8221;john&#8221;})</p>
<p>The following proves that the user was created into the db.<br />
{ &#8220;_id&#8221; : ObjectId(&#8220;5514e6c2b6e09033d4746dca&#8221;), &#8220;name&#8221; : &#8220;John&#8221;, &#8220;username&#8221; : &#8220;john&#8221;, &#8220;password&#8221; : &#8220;roberts&#8221;, &#8220;role&#8221; : &#8220;admin&#8221; }</p>
<p>Now in my auth.js I have the following requires:</p>
<p>var mongojs = require(&#8216;mongojs&#8217;);<br />
var db = mongojs(&#8216;testdb&#8217;,[&#8216;testdb&#8217;]);</p>
<p>And, this is what I did to the validate() functions:</p>
<p>validate: function(username, password) {<br />
// spoofing the DB response for simplicity<br />
var dbUserObj = db.testdb.findOne({username:username});</p>
<p>    // var dbUserObj = { // spoofing a userobject from the DB.<br />
//   name: &#8216;arvind&#8217;,<br />
//   role: &#8216;admin&#8217;,<br />
//   username: &#8216;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="731201051a1d17331e0a1203035d101c1e">[email&#160;protected]</a>&#8217;<br />
// };<br />
return dbUserObj;<br />
},</p>
<p>And I have done the same thing for validateUser. I restart the server and it compiles fine. When I try to send the following JSON request from POSTMAN I get the following 401 error:</p>
<p> {<br />
&#8220;username&#8221; :&#8221;john&#8221;,<br />
&#8220;role&#8221; : &#8220;admin&#8221;,<br />
&#8220;password&#8221; : &#8220;roberts&#8221;<br />
}</p>
<p>With above input to postman I get :</p>
<p>{<br />
&#8220;status&#8221;: 401,<br />
&#8220;message&#8221;: &#8220;Invalid credentials&#8221;<br />
}</p>
<p>I am pretty sure my DB calls might be screwed up. Can you please help?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2373">
<div id="dsq-comment-header-2373" class="dsq-comment-header">
<cite id="dsq-cite-2373">
./                <span id="dsq-author-user-2373">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2373" class="dsq-comment-body">
<div id="dsq-comment-message-2373" class="dsq-comment-message"><p>Hello SGH, Thanks! </p>
<p>Can you try console logging the username and password inside the validate()? Also in postman, make sure you set the content-type header to application/json. Thanks. </p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2387">
<div id="dsq-comment-header-2387" class="dsq-comment-header">
<cite id="dsq-cite-2387">
<span id="dsq-author-user-2387">SGH</span>
</cite>
</div>
<div id="dsq-comment-body-2387" class="dsq-comment-body">
<div id="dsq-comment-message-2387" class="dsq-comment-message"><p>Console.Log gives me &#8220;undefined&#8221; <img src="./wp-includes/images/smilies/frownie.png" alt=":(" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-2388">
<div id="dsq-comment-header-2388" class="dsq-comment-header">
<cite id="dsq-cite-2388">
<span id="dsq-author-user-2388">SGH</span>
</cite>
</div>
<div id="dsq-comment-body-2388" class="dsq-comment-body">
<div id="dsq-comment-message-2388" class="dsq-comment-message"><p>Nevermind, it actually returns the username and password. Do you think my query has a problem?</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-5" id="dsq-comment-2389">
<div id="dsq-comment-header-2389" class="dsq-comment-header">
<cite id="dsq-cite-2389">
./                <span id="dsq-author-user-2389">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2389" class="dsq-comment-body">
<div id="dsq-comment-message-2389" class="dsq-comment-message"><p>SGH, </p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b239e696206943" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var dbUserObj = db.testdb.findOne({username:username});
//
return dbUserObj;
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b239e696206943-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b239e696206943-2">2</div><div class="crayon-num" data-line="crayon-5a104183b239e696206943-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b239e696206943-4">4</div><div class="crayon-num" data-line="crayon-5a104183b239e696206943-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b239e696206943-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b239e696206943-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">dbUserObj</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-v">testdb</span><span class="crayon-sy">.</span><span class="crayon-e">findOne</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-v">username</span><span class="crayon-o">:</span><span class="crayon-v">username</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b239e696206943-3"><span class="crayon-c">//</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b239e696206943-4"><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dbUserObj</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b239e696206943-5">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p> </p>
<p>is not the correct way, when you are dealing with MongoDB/Nodejs. You need to write</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b23a8658011144" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var dbUserObj = db.testdb.findOne({username:username}, function(err, data){
// do your validation here
// send the response here
});
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b23a8658011144-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b23a8658011144-2">2</div><div class="crayon-num" data-line="crayon-5a104183b23a8658011144-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b23a8658011144-4">4</div><div class="crayon-num" data-line="crayon-5a104183b23a8658011144-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b23a8658011144-6">6</div><div class="crayon-num" data-line="crayon-5a104183b23a8658011144-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b23a8658011144-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b23a8658011144-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">dbUserObj</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-v">testdb</span><span class="crayon-sy">.</span><span class="crayon-e">findOne</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-v">username</span><span class="crayon-o">:</span><span class="crayon-v">username</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">err</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183b23a8658011144-3"><span class="crayon-h"> </span><span class="crayon-c">// do your validation here</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b23a8658011144-4">&nbsp;</div><div class="crayon-line" id="crayon-5a104183b23a8658011144-5"><span class="crayon-c">// send the response here</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b23a8658011144-6"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b23a8658011144-7">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p></p>
<p>Checkout </p>
<p><a href="./mean-stack-hands-on-tutorial/" rel="nofollow">MEAN Stack Hands on tutorial</a> </p>
<p><a href="./nodejs-restify-mongolab-build-rest-api/" rel="nofollow">Nodejs Restify MongoDB – Build your own REST API</a></p>
<p>or </p>
<p><a href="./an-end-to-end-hybrid-app/" rel="nofollow">Ionic Restify MongoDB – An End to End Hybrid App</a> </p>
<p>to get a better understanding.</p>
<p>Thanks!</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even depth-5" id="dsq-comment-2395">
<div id="dsq-comment-header-2395" class="dsq-comment-header">
<cite id="dsq-cite-2395">
<span id="dsq-author-user-2395">SGH</span>
</cite>
</div>
<div id="dsq-comment-body-2395" class="dsq-comment-body">
<div id="dsq-comment-message-2395" class="dsq-comment-message"><p>What exactly is &#8220;data&#8221; in the function? and how do I print out its contents?</p>
<p>Thanks,</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2396">
<div id="dsq-comment-header-2396" class="dsq-comment-header">
<cite id="dsq-cite-2396">
./                <span id="dsq-author-user-2396">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2396" class="dsq-comment-body">
<div id="dsq-comment-message-2396" class="dsq-comment-message"><p>Please go through the provided links or Google about  mongojs/mongoskin or MongoDB &amp; Nodejs. </p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-2330">
<div id="dsq-comment-header-2330" class="dsq-comment-header">
<cite id="dsq-cite-2330">
<span id="dsq-author-user-2330">JL Griffin</span>
</cite>
</div>
<div id="dsq-comment-body-2330" class="dsq-comment-body">
<div id="dsq-comment-message-2330" class="dsq-comment-message"><p>ok im stuck at logging in with curl.</p>
<p>running the command exactly as you have it (copy+paste) just changing the port returns this:</p>
<p>curl: (6) Could not resolve host: xn--data-z86a<br />
curl: (3) [globbing] unmatched brace in column 4<br />
curl: (6) Could not resolve host:<br />
curl: (6) Could not resolve host: myapp.xn--com,-ib7a<br />
curl: (6) Could not resolve host: xn--password-cq3di<br />
curl: (6) Could not resolve host:<br />
curl: (3) [globbing] unmatched close brace/bracket in column 14<br />
curl: (52) Empty reply from server</p>
<p>is there something ive done wrong. also express refuses to listen on the specified port. it only works if i run it from port 38531?</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2334">
<div id="dsq-comment-header-2334" class="dsq-comment-header">
<cite id="dsq-cite-2334">
./                <span id="dsq-author-user-2334">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2334" class="dsq-comment-body">
<div id="dsq-comment-message-2334" class="dsq-comment-message"><p>Hello JL Griffin. Not sure about the express port issue, you can check what process is running on port 3000 using </p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b28c9999740885" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
lsof -wni tcp:3000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b28c9999740885-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b28c9999740885-1"><span class="crayon-v">lsof</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-e">wni </span><span class="crayon-v">tcp</span><span class="crayon-o">:</span><span class="crayon-cn">3000</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p></p>
<p>Coming to the cURL issues, you can use any of the below chrome extensions to test your API</p>
<p>* <a href="https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo" onclick="__gaTracker('send', 'event', 'outbound-comment', 'https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo', 'Advanced REST client');" rel="nofollow">Advanced REST client</a><br />
* <a href="https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm" onclick="__gaTracker('send', 'event', 'outbound-comment', 'https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm', 'Postman &#8211; REST Client');" rel="nofollow">Postman &#8211; REST Client</a></p>
<p>Let me know how it works out. Thanks.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-3" id="dsq-comment-2353">
<div id="dsq-comment-header-2353" class="dsq-comment-header">
<cite id="dsq-cite-2353">
<span id="dsq-author-user-2353">JL Griffin</span>
</cite>
</div>
<div id="dsq-comment-body-2353" class="dsq-comment-body">
<div id="dsq-comment-message-2353" class="dsq-comment-message"><p>I cannot even connect to express from those. im not following this on localhost, im implimenting it on a test server, however putting the server IP it says &#8220;The response status was 0.Check out the W3C XMLHttpRequest Level 2 spec for more details about when this happens.&#8221;</p>
<p>Now if i do the command prior to logging in with curl, it completes just fine from CLI on the server, but i get the above text when i try to log in CLI from the server. i cant get postman or Advanced to work at all</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-4" id="dsq-comment-2357">
<div id="dsq-comment-header-2357" class="dsq-comment-header">
<cite id="dsq-cite-2357">
./                <span id="dsq-author-user-2357">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2357" class="dsq-comment-body">
<div id="dsq-comment-message-2357" class="dsq-comment-message"><p>I am not sure, but this looks like a issue with the test server. Can you try the same on your local machine and check?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-5" id="dsq-comment-2397">
<div id="dsq-comment-header-2397" class="dsq-comment-header">
<cite id="dsq-cite-2397">
<span id="dsq-author-user-2397">JL Griffin</span>
</cite>
</div>
<div id="dsq-comment-body-2397" class="dsq-comment-body">
<div id="dsq-comment-message-2397" class="dsq-comment-message"><p>i can give it a try but what good does this do me if it only works from local host, this would need to be deployed to a server.</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2405">
<div id="dsq-comment-header-2405" class="dsq-comment-header">
<cite id="dsq-cite-2405">
./                <span id="dsq-author-user-2405">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2405" class="dsq-comment-body">
<div id="dsq-comment-message-2405" class="dsq-comment-message"><p>The good it does is for you to identify how your server setup is different from the local machine so that you can either change your JS source code to match it or modify the configs of your server.</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even depth-5" id="dsq-comment-2480">
<div id="dsq-comment-header-2480" class="dsq-comment-header">
<cite id="dsq-cite-2480">
<span id="dsq-author-user-2480">JL Griffin</span>
</cite>
</div>
<div id="dsq-comment-body-2480" class="dsq-comment-body">
<div id="dsq-comment-message-2480" class="dsq-comment-message"><p>same issues on localhost</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="dsq-comment-2414">
<div id="dsq-comment-header-2414" class="dsq-comment-header">
<cite id="dsq-cite-2414">
<span id="dsq-author-user-2414">jack</span>
</cite>
</div>
<div id="dsq-comment-body-2414" class="dsq-comment-body">
<div id="dsq-comment-message-2414" class="dsq-comment-message"><p>I got the same error just running on localhost.. not sure what to do..</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-3" id="dsq-comment-2415">
<div id="dsq-comment-header-2415" class="dsq-comment-header">
<cite id="dsq-cite-2415">
<span id="dsq-author-user-2415">jack</span>
</cite>
</div>
<div id="dsq-comment-body-2415" class="dsq-comment-body">
<div id="dsq-comment-message-2415" class="dsq-comment-message"><p>ehh the curl still wont work for me but i just got a token from postman submitting a form!!! had to remove the  || &#8221;; part out of the lines var username = req.body.username || &#8221;; and var password = req.body.password || &#8221;;  still working on why curl gives so many errors not sure why tho</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-4" id="dsq-comment-2479">
<div id="dsq-comment-header-2479" class="dsq-comment-header">
<cite id="dsq-cite-2479">
<span id="dsq-author-user-2479">JL Griffin</span>
</cite>
</div>
<div id="dsq-comment-body-2479" class="dsq-comment-body">
<div id="dsq-comment-message-2479" class="dsq-comment-message"><p>same here this is frustrating to say the least</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-5" id="dsq-comment-2481">
<div id="dsq-comment-header-2481" class="dsq-comment-header">
<cite id="dsq-cite-2481">
<span id="dsq-author-user-2481">jack</span>
</cite>
</div>
<div id="dsq-comment-body-2481" class="dsq-comment-body">
<div id="dsq-comment-message-2481" class="dsq-comment-message"><p>Yea I feel yea, I moved on and made a simple token based backend that works alright.. building the frontend now.  I checked it into this repo <a href="https://github.com/jziesing/NodeAuthStarter/blob/master/app.js" onclick="__gaTracker('send', 'event', 'download', 'https://github.com/jziesing/NodeAuthStarter/blob/master/app.js');" rel="nofollow">https://github.com/jziesing/NodeAuthStarter/blob/master/app.js</a> but it needs this code</p>
<p>app.all(&#8216;/*&#8217;, function(req, res, next) {</p>
<p>  // CORS headers</p>
<p>  res.header(&#8220;Access-Control-Allow-Origin&#8221;, &#8220;*&#8221;); // restrict it to the required domain</p>
<p>  res.header(&#8216;Access-Control-Allow-Methods&#8217;, &#8216;GET,PUT,POST,DELETE,OPTIONS&#8217;);</p>
<p>  // Set custom headers for CORS</p>
<p>  res.header(&#8216;Access-Control-Allow-Headers&#8217;, &#8216;Content-type,Accept,X-Access-Token,X-Key&#8217;);</p>
<p>  if (req.method == &#8216;OPTIONS&#8217;) {</p>
<p>    res.status(200).end();</p>
<p>  } else {</p>
<p>    next();</p>
<p>  }</p>
<p>});</p>
<p>to work with a client of a different host.  It works well with postman and you can generate a token by sending a get with username and password in the header.  I am working on a frontend and will write more about it when i finish,</p>
<p>but yes very frustrating, the curl command seems incorrect though I am no master of curl</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-2299">
<div id="dsq-comment-header-2299" class="dsq-comment-header">
<cite id="dsq-cite-2299">
<span id="dsq-author-user-2299">ghzmdr</span>
</cite>
</div>
<div id="dsq-comment-body-2299" class="dsq-comment-body">
<div id="dsq-comment-message-2299" class="dsq-comment-message"><p>Very nice article (and blog), I&#8217;d like to add a few things about the token.</p>
<p>I&#8217;m building a service where &#8216;/api/username/caregory/thing&#8217; maps to a DB<br />
resource, these resources are private to the user who owns them.</p>
<p>So when the token is created for user &#8216;foo&#8217; he should be able to access only &#8216;/api/foo/category/&#8230;&#8217; but since the token doesn&#8217;t store any info on the user it has been created for, user &#8216;bar&#8217; can log as &#8216;bar&#8217;, get a token and access &#8216;/api/foo/&#8230;&#8217;.</p>
<p>I solved this by adding an username field to the token, then checking if<br />
the required path starts with that username and run next() only if this<br />
condition holds true.  </p>
<p>I&#8217;d like to know what do you think about this implementation</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2300">
<div id="dsq-comment-header-2300" class="dsq-comment-header">
<cite id="dsq-cite-2300">
./                <span id="dsq-author-user-2300">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2300" class="dsq-comment-body">
<div id="dsq-comment-message-2300" class="dsq-comment-message"><p>Hello ghzmdr, Thanks! </p>
<p>The solution you have provided seems fine. I would recommend 2 things in the token </p>
<p>1. Email/username/db unique id<br />
2. User role </p>
<p>Use #1 for authentication purposes after successful validation of token.<br />
Use #2 for authorizing the request after successful authentication. </p>
<p>#2 decides if the current client/request is authorized to access the resources it is requesting. And you may have a Role vs. Route mapping in an object, fetch it and include that as part of the validate request middleware.  This will recheck the authorization part. </p>
<p>In your case #1 should be equal to request.params.username. Then the user is said to be authorized. You can add this condition to your middleware along with the above. You can branch this logic into another middleware as not all routes would require this check. </p>
<p>I think this would make the solution a bit tighter for all routes. </p>
<p>Does that make sense? </p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2306">
<div id="dsq-comment-header-2306" class="dsq-comment-header">
<cite id="dsq-cite-2306">
<span id="dsq-author-user-2306">ghzmdr</span>
</cite>
</div>
<div id="dsq-comment-body-2306" class="dsq-comment-body">
<div id="dsq-comment-message-2306" class="dsq-comment-message"><p>Yes, it does, but in my application there&#8217;s only one role: user, which can only access it&#8217;s own resources, so for the time he&#8217;s authenticated he&#8217;s authorized.</p>
<p>Every user has a field wich points via ObjectID to it&#8217;s root category, So he has no way of requesting a resource owned by someone else, thus application logic alone prevents unauthorized access.</p>
<p>Eg: foo has a category named &#8216;quests&#8217;, bar has a category named &#8216;jewels&#8217;.<br />
foo can&#8217;t lookup bar&#8217;s &#8216;jewels&#8217; since he has no pointer to the root category of bar, nor a way to gain it, since categories alone are not mapped to routes but only accessed via the user&#8217;s pointer. Basically he can only search inside it&#8217;s own category tree.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-2318">
<div id="dsq-comment-header-2318" class="dsq-comment-header">
<cite id="dsq-cite-2318">
./                <span id="dsq-author-user-2318">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2318" class="dsq-comment-body">
<div id="dsq-comment-message-2318" class="dsq-comment-message"><p>In this scenario, I guess your solution is fine. I cannot think of any other scenarios at this moment. If I get any I will let you know. </p>
<p>Thanks for sharing. </p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="dsq-comment-2295">
<div id="dsq-comment-header-2295" class="dsq-comment-header">
<cite id="dsq-cite-2295">
<span id="dsq-author-user-2295">Tsao</span>
</cite>
</div>
<div id="dsq-comment-body-2295" class="dsq-comment-body">
<div id="dsq-comment-message-2295" class="dsq-comment-message"><p>Thanks for this great tutorial.However I have a question. If a hacker get the key and token,will he get authenticated and authorized successfully?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2298">
<div id="dsq-comment-header-2298" class="dsq-comment-header">
<cite id="dsq-cite-2298">
./                <span id="dsq-author-user-2298">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2298" class="dsq-comment-body">
<div id="dsq-comment-message-2298" class="dsq-comment-message"><p>Thanks Tsao.  Yes, it is as good as sharing your username and password with the hacker. But, one upside to JWT is that you can set the token to expire. If the token expires and the hacker sends the expired token to the server, he will get a 403 response. At this point  the hacker would need a valid username and password to get a fresh token. Else the hacker is locked out of the system. </p>
<p>Does that make sense? </p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-2282">
<div id="dsq-comment-header-2282" class="dsq-comment-header">
<cite id="dsq-cite-2282">
<span id="dsq-author-user-2282">Gluay</span>
</cite>
</div>
<div id="dsq-comment-body-2282" class="dsq-comment-body">
<div id="dsq-comment-message-2282" class="dsq-comment-message"><p>Thank you for sharing. However I get the following error when I try to access <a href="http://localhost:3000/login" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:3000/login', 'http://localhost:3000/login');" rel="nofollow">http://localhost:3000/login</a> </p>
<p>What have I done wrong?</p>
<p>Error: Not Found &nbsp; &nbsp;at /tmp/server/server.js:28:11 &nbsp; &nbsp;at Layer.handle [as handle_request] (/tmp/server/node_modules/express/lib/router/layer.js:82:5) &nbsp; &nbsp;at trim_prefix (/tmp/server/node_modules/express/lib/router/index.js:302:13) &nbsp; &nbsp;at /tmp/server/node_modules/express/lib/router/index.js:270:7 &nbsp; &nbsp;at Function.proto.process_params (/tmp/server/node_modules/express/lib/router/index.js:321:12) &nbsp; &nbsp;at next (/tmp/server/node_modules/express/lib/router/index.js:261:10) &nbsp; &nbsp;at /tmp/server/node_modules/express/lib/router/index.js:603:15 &nbsp; &nbsp;at next (/tmp/server/node_modules/express/lib/router/index.js:246:14) &nbsp; &nbsp;at Function.proto.handle (/tmp/server/node_modules/express/lib/router/index.js:166:3) &nbsp; &nbsp;at router (/tmp/server/node_modules/express/lib/router/index.js:35:12)</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2288">
<div id="dsq-comment-header-2288" class="dsq-comment-header">
<cite id="dsq-cite-2288">
./                <span id="dsq-author-user-2288">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2288" class="dsq-comment-body">
<div id="dsq-comment-message-2288" class="dsq-comment-message"><p>Hello Gluay. Thanks!</p>
<p>Are you trying to access </p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b3018971693817" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
http://localhost:3000/login</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b3018971693817-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b3018971693817-1"><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//localhost:3000/login</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p> from the browser?</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2290">
<div id="dsq-comment-header-2290" class="dsq-comment-header">
<cite id="dsq-cite-2290">
<span id="dsq-author-user-2290">Gluay</span>
</cite>
</div>
<div id="dsq-comment-body-2290" class="dsq-comment-body">
<div id="dsq-comment-message-2290" class="dsq-comment-message"><p>I use RESTClient Firefox plugin</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-2292">
<div id="dsq-comment-header-2292" class="dsq-comment-header">
<cite id="dsq-cite-2292">
./                <span id="dsq-author-user-2292">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2292" class="dsq-comment-body">
<div id="dsq-comment-message-2292" class="dsq-comment-message"><p>And you are making a POST request? </p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-5" id="dsq-comment-2294">
<div id="dsq-comment-header-2294" class="dsq-comment-header">
<cite id="dsq-cite-2294">
<span id="dsq-author-user-2294">hd</span>
</cite>
</div>
<div id="dsq-comment-body-2294" class="dsq-comment-body">
<div id="dsq-comment-message-2294" class="dsq-comment-message"><p>I am getting the same error just by going to <a href="http://localhost:3000/" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:3000/', 'http://localhost:3000/');" rel="nofollow">http://localhost:3000/</a> or <a href="http://localhost:3000/login" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://localhost:3000/login', 'http://localhost:3000/login');" rel="nofollow">http://localhost:3000/login</a> from Safari</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even depth-5" id="dsq-comment-2296">
<div id="dsq-comment-header-2296" class="dsq-comment-header">
<cite id="dsq-cite-2296">
<span id="dsq-author-user-2296">hd</span>
</cite>
</div>
<div id="dsq-comment-body-2296" class="dsq-comment-body">
<div id="dsq-comment-message-2296" class="dsq-comment-message"><p>Never mind. I have not seen the ngClient folder earlier :). Great article by the way !!!</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2297">
<div id="dsq-comment-header-2297" class="dsq-comment-header">
<cite id="dsq-cite-2297">
./                <span id="dsq-author-user-2297">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2297" class="dsq-comment-body">
<div id="dsq-comment-message-2297" class="dsq-comment-message"><p>Thanks! </p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-2259">
<div id="dsq-comment-header-2259" class="dsq-comment-header">
<cite id="dsq-cite-2259">
<span id="dsq-author-user-2259">Josef</span>
</cite>
</div>
<div id="dsq-comment-body-2259" class="dsq-comment-body">
<div id="dsq-comment-message-2259" class="dsq-comment-message"><p>One question Arvind. How can you send form data to mongodb using your code above?</p>
<p>I have a DB model &#8216;Product&#8217; and use your code.. Can you post an example how to save data from a form to mongoDB ? I cant get the controller to get the form data, push data to factory and then to products.js where it saves the product to DB.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2260">
<div id="dsq-comment-header-2260" class="dsq-comment-header">
<cite id="dsq-cite-2260">
./                <span id="dsq-author-user-2260">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2260" class="dsq-comment-body">
<div id="dsq-comment-message-2260" class="dsq-comment-message"><p>Hello Josef, You can follow this tutorial <a href="./mean-stack-hands-on-tutorial/" rel="nofollow">MEAN stack – A Hands on Tutorial</a> to see how to work with a MEAN stack application, where you save data from a Form to DB. Let me know if you still face issues. Thanks!</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-2247">
<div id="dsq-comment-header-2247" class="dsq-comment-header">
<cite id="dsq-cite-2247">
<span id="dsq-author-user-2247">Sean</span>
</cite>
</div>
<div id="dsq-comment-body-2247" class="dsq-comment-body">
<div id="dsq-comment-message-2247" class="dsq-comment-message"><p>Nice article, one of the things that I would&#8217;ve liked to see covered is the following. I have a secure REST endpoint that can be consumed by any device, as long as they have a token.  We have a way to create tasks within the system. What prevents a hacker from using the rest API and calling a for loop and just filling out our database? Do you have maybe an alert that alerts you when someone is legitimately trying to screw you, and set some boundaries that you can make only this amount of requests per minute? What is your recommended solution of protecting against abuse of API?</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2250">
<div id="dsq-comment-header-2250" class="dsq-comment-header">
<cite id="dsq-cite-2250">
./                <span id="dsq-author-user-2250">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2250" class="dsq-comment-body">
<div id="dsq-comment-message-2250" class="dsq-comment-message"><p>Hello Sean, Thanks!</p>
<p>A very nice question! IMO, the solution as you have suggested &#8211; Rate limiting &#8211; is very apt. You can set a threshold for every single client for number of API request per second or per minute depending on the expected traffic. Then you could use a module like <a href="https://github.com/jhurliman/node-rate-limiter" onclick="__gaTracker('send', 'event', 'outbound-comment', 'https://github.com/jhurliman/node-rate-limiter', 'node-rate-limiter');" rel="nofollow">node-rate-limiter</a> or <a href="https://github.com/tj/node-ratelimiter" onclick="__gaTracker('send', 'event', 'outbound-comment', 'https://github.com/tj/node-ratelimiter', 'node-ratelimiter');" rel="nofollow">node-ratelimiter</a> or <a href="https://www.npmjs.com/package/simple-rate-limiter" onclick="__gaTracker('send', 'event', 'outbound-comment', 'https://www.npmjs.com/package/simple-rate-limiter', 'simple-rate-limiter');" rel="nofollow">simple-rate-limiter</a> and wrap the authorization middleware with it. </p>
<p>So the flow would be</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b3488834381607" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Client &gt;&gt;&gt; REST API Call &gt;&gt;&gt; Server &gt;&gt;&gt; Rate limiter &gt;&gt;&gt; Auth Middleware &gt;&gt;&gt; Application logic
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b3488834381607-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b3488834381607-2">2</div><div class="crayon-num" data-line="crayon-5a104183b3488834381607-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b3488834381607-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b3488834381607-2"><span class="crayon-v">Client</span><span class="crayon-h"> </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">REST </span><span class="crayon-e">API </span><span class="crayon-v">Call</span><span class="crayon-h"> </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">Server</span><span class="crayon-h"> </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">Rate </span><span class="crayon-v">limiter</span><span class="crayon-h"> </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">Auth </span><span class="crayon-v">Middleware</span><span class="crayon-h"> </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">Application </span><span class="crayon-i">logic</span></div><div class="crayon-line" id="crayon-5a104183b3488834381607-3">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p></p>
<p>So if the rate is exceeded, we would send a HTTP 429 status code back. This way, we do not need to authorize the requests that are rate limited.</p>
<p>Let me know if this helps.</p>
<p>Thanks.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-3" id="dsq-comment-2251">
<div id="dsq-comment-header-2251" class="dsq-comment-header">
<cite id="dsq-cite-2251">
<span id="dsq-author-user-2251">Sean</span>
</cite>
</div>
<div id="dsq-comment-body-2251" class="dsq-comment-body">
<div id="dsq-comment-message-2251" class="dsq-comment-message"><p>This helps, thank you so much!! Great little node package</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-4" id="dsq-comment-2252">
<div id="dsq-comment-header-2252" class="dsq-comment-header">
<cite id="dsq-cite-2252">
./                <span id="dsq-author-user-2252">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2252" class="dsq-comment-body">
<div id="dsq-comment-message-2252" class="dsq-comment-message"><p>Yup. Thanks. </p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-2244">
<div id="dsq-comment-header-2244" class="dsq-comment-header">
<cite id="dsq-cite-2244">
<span id="dsq-author-user-2244">kc</span>
</cite>
</div>
<div id="dsq-comment-body-2244" class="dsq-comment-body">
<div id="dsq-comment-message-2244" class="dsq-comment-message"><p>Hi Arvind,<br />
Very good article.Can you please tell how can i add more than 1 admin or create a profile for role of user?</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2245">
<div id="dsq-comment-header-2245" class="dsq-comment-header">
<cite id="dsq-cite-2245">
./                <span id="dsq-author-user-2245">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2245" class="dsq-comment-body">
<div id="dsq-comment-message-2245" class="dsq-comment-message"><p>Thanks kc. You can create your own role based registration and add users at various role. And the use the above auth middle to authenticate and authorise them.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-2238">
<div id="dsq-comment-header-2238" class="dsq-comment-header">
<cite id="dsq-cite-2238">
<span id="dsq-author-user-2238">Josef</span>
</cite>
</div>
<div id="dsq-comment-body-2238" class="dsq-comment-body">
<div id="dsq-comment-message-2238" class="dsq-comment-message"><p>I following your tutorial and when i come to &#8220;Testing the REST API&#8221;, when trying to login i get</p>
<p>Raw: {&#8220;status&#8221;:401,&#8221;message&#8221;:&#8221;Invalid credentials&#8221;}</p>
<p>I have everything like you have in your files. Can this be a problem with express 4?</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-2239">
<div id="dsq-comment-header-2239" class="dsq-comment-header">
<cite id="dsq-cite-2239">
./                <span id="dsq-author-user-2239">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2239" class="dsq-comment-body">
<div id="dsq-comment-message-2239" class="dsq-comment-message"><p>Hello Josef. Can you console log the credentials you are receiving at your server, just to check if the data is passed correctly?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-3" id="dsq-comment-2240">
<div id="dsq-comment-header-2240" class="dsq-comment-header">
<cite id="dsq-cite-2240">
<span id="dsq-author-user-2240">Josef</span>
</cite>
</div>
<div id="dsq-comment-body-2240" class="dsq-comment-body">
<div id="dsq-comment-message-2240" class="dsq-comment-message"><p>It looks like it&#8217;s fails on line 7 in auth.js &#8211; if statement </p>
<p>if (username == &#8221; || password == &#8221;) {</p>
<p>I have everything in server.js as you have in the tutorial. I saw you mentioned earlier in this thread about app.use(bodParser.json()); and i also check and its in the server.js to.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-4" id="dsq-comment-2241">
<div id="dsq-comment-header-2241" class="dsq-comment-header">
<cite id="dsq-cite-2241">
./                <span id="dsq-author-user-2241">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2241" class="dsq-comment-body">
<div id="dsq-comment-message-2241" class="dsq-comment-message"><p>Strange. When you send the request from client, it does have the content-type : application/json right? </p>
</div>
</div>
<ul class="children">
<li class="comment even depth-5" id="dsq-comment-2257">
<div id="dsq-comment-header-2257" class="dsq-comment-header">
<cite id="dsq-cite-2257">
<span id="dsq-author-user-2257">Josef</span>
</cite>
</div>
<div id="dsq-comment-body-2257" class="dsq-comment-body">
<div id="dsq-comment-message-2257" class="dsq-comment-message"><p>Fixed! <img src="./wp-includes/images/smilies/simple-smile.png" alt=":)" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2258">
<div id="dsq-comment-header-2258" class="dsq-comment-header">
<cite id="dsq-cite-2258">
./                <span id="dsq-author-user-2258">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2258" class="dsq-comment-body">
<div id="dsq-comment-message-2258" class="dsq-comment-message"><p>Cool! </p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even depth-5" id="dsq-comment-2456">
<div id="dsq-comment-header-2456" class="dsq-comment-header">
<cite id="dsq-cite-2456">
<span id="dsq-author-user-2456">salesmen library</span>
</cite>
</div>
<div id="dsq-comment-body-2456" class="dsq-comment-body">
<div id="dsq-comment-message-2456" class="dsq-comment-message"><p>Hi Josef, could you please share your solution? I am also having the same issue. when I do a console.log(&#8216;username&#8217;+username); in routes/auth.json, i receive an empty value. Seems querystring params are not readable for me.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="dsq-comment-2185">
<div id="dsq-comment-header-2185" class="dsq-comment-header">
<cite id="dsq-cite-2185">
<span id="dsq-author-user-2185">NewNoder</span>
</cite>
</div>
<div id="dsq-comment-body-2185" class="dsq-comment-body">
<div id="dsq-comment-message-2185" class="dsq-comment-message"><p>Hi Arvind,<br />
Thank you very much for this excellent tutorial, it has helped me a great deal. I am trying to learn these technologies and was wondering if you could point me in the direction of an example which connects to a mysql database for the username/password check? I am about to start a project which is heavily reliant upon a mysql datastore. Once again, thanks for your work.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2186">
<div id="dsq-comment-header-2186" class="dsq-comment-header">
<cite id="dsq-cite-2186">
./                <span id="dsq-author-user-2186">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2186" class="dsq-comment-body">
<div id="dsq-comment-message-2186" class="dsq-comment-message"><p>Hello NewNoder!,</p>
<p>Thanks much. Take a look at <a href="https://github.com/felixge/node-mysql/" onclick="__gaTracker('send', 'event', 'outbound-comment', 'https://github.com/felixge/node-mysql/', 'node-mysql');" rel="nofollow">node-mysql</a> module. This module is specifically used for working with MySQL. Let me know if this works for you.</p>
<p>Thanks.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2187">
<div id="dsq-comment-header-2187" class="dsq-comment-header">
<cite id="dsq-cite-2187">
<span id="dsq-author-user-2187">NewNoder</span>
</cite>
</div>
<div id="dsq-comment-body-2187" class="dsq-comment-body">
<div id="dsq-comment-message-2187" class="dsq-comment-message"><p>Thanks for pointing me in the right direction. I just can&#8217;t figure out how to use the mysql &#8216;pool&#8217; (defined in server.js) inside auth.js. Is there some way I can &#8216;include&#8217; it? Apologies if this is a stupid question. I am very new to javascript/node.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-2192">
<div id="dsq-comment-header-2192" class="dsq-comment-header">
<cite id="dsq-cite-2192">
./                <span id="dsq-author-user-2192">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2192" class="dsq-comment-body">
<div id="dsq-comment-message-2192" class="dsq-comment-message"><p>You can export this value and require it in the required file. More info on require : <a href="http://openmymind.net/2012/2/3/Node-Require-and-Exports/" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://openmymind.net/2012/2/3/Node-Require-and-Exports/', 'Node.js, Require and Exports');" rel="nofollow">Node.js, Require and Exports</a></p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-2158">
<div id="dsq-comment-header-2158" class="dsq-comment-header">
<cite id="dsq-cite-2158">
<span id="dsq-author-user-2158">Auine .</span>
</cite>
</div>
<div id="dsq-comment-body-2158" class="dsq-comment-body">
<div id="dsq-comment-message-2158" class="dsq-comment-message"><p>why you fetch user from db by username instead of token? Why we can&#8217;t save token to bd, and fetch user by it token?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2160">
<div id="dsq-comment-header-2160" class="dsq-comment-header">
<cite id="dsq-cite-2160">
./                <span id="dsq-author-user-2160">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2160" class="dsq-comment-body">
<div id="dsq-comment-message-2160" class="dsq-comment-message"><p>Hello Auine,</p>
<p>If you want to use, you can save the token to database whenever it is generated and then use that token to get the user data. But do remember to decode the token first to get the expiry value and check if the token is still valid and then fetch the user assigned with this token. Either way you cannot skip the decode token step.</p>
<p>You can encode all the user data using JWT, but how will you decode on the client? If you are planning to implement a copy of JWT on client, then you will also need the secret with which you can decode the server side encoded user object and when you do this on client side, anyone who views the source can know all the security implementations you have done on the server side.</p>
<p>That is why we do not encode the entire object.</p>
<p>Does this makes sense?</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="dsq-comment-2137">
<div id="dsq-comment-header-2137" class="dsq-comment-header">
<cite id="dsq-cite-2137">
<span id="dsq-author-user-2137">Chris</span>
</cite>
</div>
<div id="dsq-comment-body-2137" class="dsq-comment-body">
<div id="dsq-comment-message-2137" class="dsq-comment-message"><p>Hi Arvind, I can&#8217;t consume the login using postman, can you pls help me?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2138">
<div id="dsq-comment-header-2138" class="dsq-comment-header">
<cite id="dsq-cite-2138">
./                <span id="dsq-author-user-2138">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2138" class="dsq-comment-body">
<div id="dsq-comment-message-2138" class="dsq-comment-message"><p>Hello Chris, </p>
<p>Were you able to successfully create a new user? And was it with the same credentials above?</p>
<p>Thanks.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2139">
<div id="dsq-comment-header-2139" class="dsq-comment-header">
<cite id="dsq-cite-2139">
<span id="dsq-author-user-2139">Chris</span>
</cite>
</div>
<div id="dsq-comment-body-2139" class="dsq-comment-body">
<div id="dsq-comment-message-2139" class="dsq-comment-message"><p>No, the problem is in auth.js, when i sent a request using post with username and password, the req.body.username or req.body.password is empty that&#8217;s why the server is giving me 401.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-2140">
<div id="dsq-comment-header-2140" class="dsq-comment-header">
<cite id="dsq-cite-2140">
./                <span id="dsq-author-user-2140">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2140" class="dsq-comment-body">
<div id="dsq-comment-message-2140" class="dsq-comment-message"><p>Did you add </p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b3dba966892707" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
app.use(bodyParser.json());</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b3dba966892707-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b3dba966892707-1"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-v">bodyParser</span><span class="crayon-sy">.</span><span class="crayon-e">json</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p></p>
<p>before the routes are called?</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-5" id="dsq-comment-2141">
<div id="dsq-comment-header-2141" class="dsq-comment-header">
<cite id="dsq-cite-2141">
<span id="dsq-author-user-2141">Chris</span>
</cite>
</div>
<div id="dsq-comment-body-2141" class="dsq-comment-body">
<div id="dsq-comment-message-2141" class="dsq-comment-message"><p>Actually i used your code just for testing.</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even depth-5" id="dsq-comment-2143">
<div id="dsq-comment-header-2143" class="dsq-comment-header">
<cite id="dsq-cite-2143">
./                <span id="dsq-author-user-2143">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2143" class="dsq-comment-body">
<div id="dsq-comment-message-2143" class="dsq-comment-message"><p>cool.</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2184">
<div id="dsq-comment-header-2184" class="dsq-comment-header">
<cite id="dsq-cite-2184">
<span id="dsq-author-user-2184">djohnsonkc</span>
</cite>
</div>
<div id="dsq-comment-body-2184" class="dsq-comment-body">
<div id="dsq-comment-message-2184" class="dsq-comment-message"><p>The Postman solution is to add a header parameter for Content-Type: application/json. This has bit me before when testing using Postman <img src="./wp-includes/images/smilies/simple-smile.png" alt=":-)" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment even depth-5" id="dsq-comment-2142">
<div id="dsq-comment-header-2142" class="dsq-comment-header">
<cite id="dsq-cite-2142">
<span id="dsq-author-user-2142">Chris</span>
</cite>
</div>
<div id="dsq-comment-body-2142" class="dsq-comment-body">
<div id="dsq-comment-message-2142" class="dsq-comment-message"><p>Arvind, I already solved the problem. Reason I&#8217;m passing invalid json.</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-2237">
<div id="dsq-comment-header-2237" class="dsq-comment-header">
<cite id="dsq-cite-2237">
<span id="dsq-author-user-2237">Josef</span>
</cite>
</div>
<div id="dsq-comment-body-2237" class="dsq-comment-body">
<div id="dsq-comment-message-2237" class="dsq-comment-message"><p>How did you solve this problem?</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-2127">
<div id="dsq-comment-header-2127" class="dsq-comment-header">
<cite id="dsq-cite-2127">
<span id="dsq-author-user-2127">Alex</span>
</cite>
</div>
<div id="dsq-comment-body-2127" class="dsq-comment-body">
<div id="dsq-comment-message-2127" class="dsq-comment-message"><p>Excellent article! Thank you!</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="dsq-comment-2125">
<div id="dsq-comment-header-2125" class="dsq-comment-header">
<cite id="dsq-cite-2125">
<span id="dsq-author-user-2125">Amine</span>
</cite>
</div>
<div id="dsq-comment-body-2125" class="dsq-comment-body">
<div id="dsq-comment-message-2125" class="dsq-comment-message"><p>is it necessary to use gulp command ?? if yes , if we want to deploy the application will we  find any problems ???<br />
please answer me because im using this project in prod</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2126">
<div id="dsq-comment-header-2126" class="dsq-comment-header">
<cite id="dsq-cite-2126">
./                <span id="dsq-author-user-2126">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2126" class="dsq-comment-body">
<div id="dsq-comment-message-2126" class="dsq-comment-message"><p>Hey Amine, you need gulp only to host the angular files locally. If you are already hosting the angular code on a server, you can access it directly.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-2111">
<div id="dsq-comment-header-2111" class="dsq-comment-header">
<cite id="dsq-cite-2111">
http://julianalimin.com                <span id="dsq-author-user-2111">Julian</span>
</cite>
</div>
<div id="dsq-comment-body-2111" class="dsq-comment-body">
<div id="dsq-comment-message-2111" class="dsq-comment-message"><p>Hi Arvind,<br />
Love your articles!</p>
<p>I was trying to push these to Heroku. Has success with the Server by adding forever and a procfile.<br />
But I have no idea how to push the AngularJS Client to Heroku. Any pointers on what I should do?</p>
<p>Thanks</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2112">
<div id="dsq-comment-header-2112" class="dsq-comment-header">
<cite id="dsq-cite-2112">
./                <span id="dsq-author-user-2112">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2112" class="dsq-comment-body">
<div id="dsq-comment-message-2112" class="dsq-comment-message"><p>Hey Julian, Thanks!</p>
<p>Take a look at <a href="./deploying-node-application" rel="nofollow">Deploying Node Applications to Heroku</a> for deploying files to heroku.</p>
<p>Also make sure you commit your changes before pushing changes to Heroku.</p>
<p>Thanks.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="dsq-comment-2103">
<div id="dsq-comment-header-2103" class="dsq-comment-header">
<cite id="dsq-cite-2103">
<span id="dsq-author-user-2103">T-Money</span>
</cite>
</div>
<div id="dsq-comment-body-2103" class="dsq-comment-body">
<div id="dsq-comment-message-2103" class="dsq-comment-message"><p>Thanks for the great article&#8230;quick question: What size of apps would this architecture be suitable for? Is the architecture really all I need for a real world line of business app?</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2104">
<div id="dsq-comment-header-2104" class="dsq-comment-header">
<cite id="dsq-cite-2104">
./                <span id="dsq-author-user-2104">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2104" class="dsq-comment-body">
<div id="dsq-comment-message-2104" class="dsq-comment-message"><p>Thanks T-Money. Technically yes, and this architecture is quite scalable too. I have not tested this on clusters but I think it should work fine. This architecture can be used as a base for your app and you can build on top of it.  But do not believe this 100%. Add your checks where possible.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2105">
<div id="dsq-comment-header-2105" class="dsq-comment-header">
<cite id="dsq-cite-2105">
<span id="dsq-author-user-2105">T-Money</span>
</cite>
</div>
<div id="dsq-comment-body-2105" class="dsq-comment-body">
<div id="dsq-comment-message-2105" class="dsq-comment-message"><p>Thank you for your response!</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-2089">
<div id="dsq-comment-header-2089" class="dsq-comment-header">
<cite id="dsq-cite-2089">
<span id="dsq-author-user-2089">p.florian91</span>
</cite>
</div>
<div id="dsq-comment-body-2089" class="dsq-comment-body">
<div id="dsq-comment-message-2089" class="dsq-comment-message"><p>Thank you! Flawless</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="dsq-comment-2080">
<div id="dsq-comment-header-2080" class="dsq-comment-header">
<cite id="dsq-cite-2080">
<span id="dsq-author-user-2080">Davids</span>
</cite>
</div>
<div id="dsq-comment-body-2080" class="dsq-comment-body">
<div id="dsq-comment-message-2080" class="dsq-comment-message"><p>Excelent Article Arvind, thanks a lot, this may be my nodejs app foundments for a long. Just a question, i am new in writing apps in nodejs, do this rest app implement the mvc pattern ? </p>
<p>Thanks a lot Again !</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2084">
<div id="dsq-comment-header-2084" class="dsq-comment-header">
<cite id="dsq-cite-2084">
./                <span id="dsq-author-user-2084">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2084" class="dsq-comment-body">
<div id="dsq-comment-message-2084" class="dsq-comment-message"><p>Hello David. Thanks!</p>
<p>We are using Express.js (<a href="http://expressjs.com/" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://expressjs.com/', 'http://expressjs.com/');" rel="nofollow">http://expressjs.com/</a> ) as the web framework. This acts as the MVC web framework for the app. </p>
<p>Thanks.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-2058">
<div id="dsq-comment-header-2058" class="dsq-comment-header">
<cite id="dsq-cite-2058">
<span id="dsq-author-user-2058">Mercea</span>
</cite>
</div>
<div id="dsq-comment-body-2058" class="dsq-comment-body">
<div id="dsq-comment-message-2058" class="dsq-comment-message"><p>Hi Arvind, </p>
<p>Thanks for such a well written tutorial! I love it.</p>
<p>In my validaterequest.js file, which looks exactly like yours, on line 65, I keep getting this error. It also happens if I include a status in the response (line 64). The error then would be &#8220;IncomingMessage&gt; has no method &#8216;status'&#8221;. Any ideas why? Setting the status and json response works for the routes but doesn&#8217;t work in my validaterequest file.</p>
<p>Thanks.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2059">
<div id="dsq-comment-header-2059" class="dsq-comment-header">
<cite id="dsq-cite-2059">
./                <span id="dsq-author-user-2059">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2059" class="dsq-comment-body">
<div id="dsq-comment-message-2059" class="dsq-comment-message"><p>Hello Mercea,</p>
<p>Thanks! Glad you liked it.</p>
<p>I have not faced a issue like this so far. But a quick googling suggests</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b45d9643239657" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// http://stackoverflow.com/a/19142847/1015046
&gt; function(res,req)
Your parameters are backwards.
Express passes the request, followed by the response.
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b45d9643239657-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b45d9643239657-2">2</div><div class="crayon-num" data-line="crayon-5a104183b45d9643239657-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b45d9643239657-4">4</div><div class="crayon-num" data-line="crayon-5a104183b45d9643239657-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b45d9643239657-6">6</div><div class="crayon-num" data-line="crayon-5a104183b45d9643239657-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b45d9643239657-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b45d9643239657-2"><span class="crayon-c">// http://stackoverflow.com/a/19142847/1015046</span></div><div class="crayon-line" id="crayon-5a104183b45d9643239657-3"><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">res</span><span class="crayon-sy">,</span><span class="crayon-v">req</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b45d9643239657-4">&nbsp;</div><div class="crayon-line" id="crayon-5a104183b45d9643239657-5"><span class="crayon-e">Your </span><span class="crayon-e">parameters </span><span class="crayon-e">are </span><span class="crayon-v">backwards</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b45d9643239657-6"><span class="crayon-e">Express </span><span class="crayon-e">passes </span><span class="crayon-e">the </span><span class="crayon-v">request</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">followed </span><span class="crayon-e">by </span><span class="crayon-e">the </span><span class="crayon-v">response</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5a104183b45d9643239657-7">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p></p>
<p>Another reason could be </p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b45e4139558626" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
//http://stackoverflow.com/a/22382521/1015046
app.configure(function (){
app.use(express.cookieParser('keyboard cat'));
app.use(express.session({ cookie: { maxAge: 60000 }}));
app.use(passport.initialize());
app.use(passport.session());
app.use(flash());
})
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b45e4139558626-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b45e4139558626-2">2</div><div class="crayon-num" data-line="crayon-5a104183b45e4139558626-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b45e4139558626-4">4</div><div class="crayon-num" data-line="crayon-5a104183b45e4139558626-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b45e4139558626-6">6</div><div class="crayon-num" data-line="crayon-5a104183b45e4139558626-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b45e4139558626-8">8</div><div class="crayon-num" data-line="crayon-5a104183b45e4139558626-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b45e4139558626-10">10</div><div class="crayon-num" data-line="crayon-5a104183b45e4139558626-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b45e4139558626-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b45e4139558626-2"><span class="crayon-c">//http://stackoverflow.com/a/22382521/1015046</span></div><div class="crayon-line" id="crayon-5a104183b45e4139558626-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b45e4139558626-4"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">configure</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183b45e4139558626-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-v">express</span><span class="crayon-sy">.</span><span class="crayon-e">cookieParser</span><span class="crayon-sy">(</span><span class="crayon-s">'keyboard cat'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b45e4139558626-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-v">express</span><span class="crayon-sy">.</span><span class="crayon-e">session</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">cookie</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">maxAge</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">60000</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b45e4139558626-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-v">passport</span><span class="crayon-sy">.</span><span class="crayon-e">initialize</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b45e4139558626-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-v">passport</span><span class="crayon-sy">.</span><span class="crayon-e">session</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b45e4139558626-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-e">flash</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b45e4139558626-10"><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a104183b45e4139558626-11">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0027 seconds] -->
<p></p>
<p>Let me if it works out.</p>
<p>Thanks.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2064">
<div id="dsq-comment-header-2064" class="dsq-comment-header">
<cite id="dsq-cite-2064">
<span id="dsq-author-user-2064">mercea</span>
</cite>
</div>
<div id="dsq-comment-body-2064" class="dsq-comment-body">
<div id="dsq-comment-message-2064" class="dsq-comment-message"><p>Thanks a lot! I had the req and res switched. Bad idea to code when tired <img src="./wp-includes/images/smilies/simple-smile.png" alt=":)" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
</div>
</div>
<ul class="children">
<li class="comment even depth-4" id="dsq-comment-2065">
<div id="dsq-comment-header-2065" class="dsq-comment-header">
<cite id="dsq-cite-2065">
./                <span id="dsq-author-user-2065">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2065" class="dsq-comment-body">
<div id="dsq-comment-message-2065" class="dsq-comment-message"><p>Glad it worked out. Thanks. </p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="dsq-comment-2033">
<div id="dsq-comment-header-2033" class="dsq-comment-header">
<cite id="dsq-cite-2033">
<span id="dsq-author-user-2033">Marcus</span>
</cite>
</div>
<div id="dsq-comment-body-2033" class="dsq-comment-body">
<div id="dsq-comment-message-2033" class="dsq-comment-message"><p>Hi Arvind,</p>
<p>Thank you so much for the nice written article! I was looking for a template like this for my experimental node.js REST API. Awesome <img src="./wp-includes/images/smilies/simple-smile.png" alt=":)" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2035">
<div id="dsq-comment-header-2035" class="dsq-comment-header">
<cite id="dsq-cite-2035">
./                <span id="dsq-author-user-2035">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2035" class="dsq-comment-body">
<div id="dsq-comment-message-2035" class="dsq-comment-message"><p>Great! Thanks Marcus. </p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-2005">
<div id="dsq-comment-header-2005" class="dsq-comment-header">
<cite id="dsq-cite-2005">
<span id="dsq-author-user-2005">Cerberus</span>
</cite>
</div>
<div id="dsq-comment-body-2005" class="dsq-comment-body">
<div id="dsq-comment-message-2005" class="dsq-comment-message"><p>Hey Arvind,</p>
<p>Thanks for the article. I&#8217;m a bit new to node and angular and I was just curious about the statement:</p>
<p> return config || $q.when(config);</p>
<p>I&#8217;ve tried examining what&#8217;s returned by the $q.when() and it doesn&#8217;t seem like anything useful&#8230; I&#8217;m currently looking into $q and $http intercepters, so forgive my ignorance.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-2" id="dsq-comment-2006">
<div id="dsq-comment-header-2006" class="dsq-comment-header">
<cite id="dsq-cite-2006">
./                <span id="dsq-author-user-2006">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-2006" class="dsq-comment-body">
<div id="dsq-comment-message-2006" class="dsq-comment-message"><p>Thanks Cerberus! These SO post explains your question : <a href="http://stackoverflow.com/q/16770821/1015046" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://stackoverflow.com/q/16770821/1015046', 'http://stackoverflow.com/q/16770821/1015046');" rel="nofollow">http://stackoverflow.com/q/16770821/1015046</a> and <a href="http://stackoverflow.com/a/19771163/1015046" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://stackoverflow.com/a/19771163/1015046', 'http://stackoverflow.com/a/19771163/1015046');" rel="nofollow">http://stackoverflow.com/a/19771163/1015046</a> &#8212; Thanks.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="dsq-comment-2007">
<div id="dsq-comment-header-2007" class="dsq-comment-header">
<cite id="dsq-cite-2007">
<span id="dsq-author-user-2007">Cerberus</span>
</cite>
</div>
<div id="dsq-comment-body-2007" class="dsq-comment-body">
<div id="dsq-comment-message-2007" class="dsq-comment-message"><p>Wow, thanks for the quick response and thank you for your contribution with these quality articles!</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-1772">
<div id="dsq-comment-header-1772" class="dsq-comment-header">
<cite id="dsq-cite-1772">
<span id="dsq-author-user-1772">Cyber</span>
</cite>
</div>
<div id="dsq-comment-body-1772" class="dsq-comment-body">
<div id="dsq-comment-message-1772" class="dsq-comment-message"><p>Thank you for your time devoted to write this article. Would love to see more of some advance stuffs in nodejs rest api.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-1773">
<div id="dsq-comment-header-1773" class="dsq-comment-header">
<cite id="dsq-cite-1773">
./                <span id="dsq-author-user-1773">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-1773" class="dsq-comment-body">
<div id="dsq-comment-message-1773" class="dsq-comment-message"><p>Thanks Cyber! Are you looking for anything specific?</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-1620">
<div id="dsq-comment-header-1620" class="dsq-comment-header">
<cite id="dsq-cite-1620">
<span id="dsq-author-user-1620">Abdurrahman</span>
</cite>
</div>
<div id="dsq-comment-body-1620" class="dsq-comment-body">
<div id="dsq-comment-message-1620" class="dsq-comment-message"><p>Hello Arvind,</p>
<p>Thanks for the great article. But I get an error below when I try to post a request from PostMan extension. Do you have any idea that how I can handle it?</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-1621">
<div id="dsq-comment-header-1621" class="dsq-comment-header">
<cite id="dsq-cite-1621">
./                <span id="dsq-author-user-1621">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-1621" class="dsq-comment-body">
<div id="dsq-comment-message-1621" class="dsq-comment-message"><p>Hi Abdurrahman, Thanks!</p>
<p>Is that route defined in your code? any sample code I can take a look at. Thanks.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-3" id="dsq-comment-1622">
<div id="dsq-comment-header-1622" class="dsq-comment-header">
<cite id="dsq-cite-1622">
<span id="dsq-author-user-1622">Abdurrahman</span>
</cite>
</div>
<div id="dsq-comment-body-1622" class="dsq-comment-body">
<div id="dsq-comment-message-1622" class="dsq-comment-message"><p>Actually I&#8217;m running your repo on my local.<br />
<a href="https://github.com/arvindr21/myRESTApp" onclick="__gaTracker('send', 'event', 'outbound-comment', 'https://github.com/arvindr21/myRESTApp', 'https://github.com/arvindr21/myRESTApp');" rel="nofollow">https://github.com/arvindr21/myRESTApp</a></p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-4" id="dsq-comment-1623">
<div id="dsq-comment-header-1623" class="dsq-comment-header">
<cite id="dsq-cite-1623">
./                <span id="dsq-author-user-1623">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-1623" class="dsq-comment-body">
<div id="dsq-comment-message-1623" class="dsq-comment-message"><p>So, you cloned the repo. Ran <code>npm install</code> inside the server folder, then init server with <code>node server.js</code> and then tried to access <code>http://localhost:3000/api/v1/products</code> without any request headers right? </p>
<p>You should ideally get a  <code>401</code>. Can you pl. try cloning the repo and running again?</p>
<p>Thanks.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-5" id="dsq-comment-1624">
<div id="dsq-comment-header-1624" class="dsq-comment-header">
<cite id="dsq-cite-1624">
<span id="dsq-author-user-1624">Abdurrahman</span>
</cite>
</div>
<div id="dsq-comment-body-1624" class="dsq-comment-body">
<div id="dsq-comment-message-1624" class="dsq-comment-message"><p>Ok, I found the problem. I&#8217;ve forgotten request method as POST, changing it to GET resolved my issue.Thanks again for the quick reply and great article Arvind.</p>
</div>
</div>
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="dsq-comment-1625">
<div id="dsq-comment-header-1625" class="dsq-comment-header">
<cite id="dsq-cite-1625">
./                <span id="dsq-author-user-1625">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-1625" class="dsq-comment-body">
<div id="dsq-comment-message-1625" class="dsq-comment-message"><p>Great! Thanks!</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-1478">
<div id="dsq-comment-header-1478" class="dsq-comment-header">
<cite id="dsq-cite-1478">
<span id="dsq-author-user-1478">Christian Martin</span>
</cite>
</div>
<div id="dsq-comment-body-1478" class="dsq-comment-body">
<div id="dsq-comment-message-1478" class="dsq-comment-message"><p>Thanks for the tutorial! I really appreciate it! By the way, the username should be baked into the token instead of the x-key. Now you can easily change it by typing  sessionStorage.user= &#8220;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="82e3e6efebecc2efe3ebeeace1edef">[email&#160;protected]</a>&#8221; in the console.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-1479">
<div id="dsq-comment-header-1479" class="dsq-comment-header">
<cite id="dsq-cite-1479">
./                <span id="dsq-author-user-1479">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-1479" class="dsq-comment-body">
<div id="dsq-comment-message-1479" class="dsq-comment-message"><p>Thanks Christian. Yes, that is another good/a more secure way to handle it. </p>
<p>We can always do the below in <code>routes/auth.js</code></p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b4d89972342553" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var token = jwt.encode({
exp: expires,
username : username
}, require('../config/secret')());
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b4d89972342553-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b4d89972342553-2">2</div><div class="crayon-num" data-line="crayon-5a104183b4d89972342553-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b4d89972342553-4">4</div><div class="crayon-num" data-line="crayon-5a104183b4d89972342553-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b4d89972342553-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b4d89972342553-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b4d89972342553-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">jwt</span><span class="crayon-sy">.</span><span class="crayon-e">encode</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a104183b4d89972342553-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">exp</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">expires</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b4d89972342553-4"><span class="crayon-v">username</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">username</span></div><div class="crayon-line" id="crayon-5a104183b4d89972342553-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'../config/secret'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b4d89972342553-6">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p></p>
<p>But, on the client, you will not know what is in the token, as we are not decoding the same. And the only reason we store the username on the client is to handle the page refresh and maintain the login of the client. You can use a cookie too to do this.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-1149">
<div id="dsq-comment-header-1149" class="dsq-comment-header">
<cite id="dsq-cite-1149">
<span id="dsq-author-user-1149">Ward Bell</span>
</cite>
</div>
<div id="dsq-comment-body-1149" class="dsq-comment-body">
<div id="dsq-comment-message-1149" class="dsq-comment-message"><p>I forgot to mention perhaps the most important omission: you&#8217;re not encrypting at the transport level with HTTPS. All communications are in clear text &#8230; including the login credentials. Any man-in-the-middle (say, someone listening in a coffee shop) can pick up the credentials or the the JWT token (good for 7 days).</p>
<p>It&#8217;s not hard to turn on TLS (HTTPS). Search the web; here&#8217;s an example: <a href="http://www.hacksparrow.com/express-js-https.html" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://www.hacksparrow.com/express-js-https.html', 'http://www.hacksparrow.com/express-js-https.html');" rel="nofollow">http://www.hacksparrow.com/express-js-https.html</a> </p>
<p>Note also that EVERY exchange with the site must be via HTTPS, not just the login. Search the web for why; here&#8217;s one such explanation: <a href="http://mashable.com/2011/05/31/https-web-security/" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://mashable.com/2011/05/31/https-web-security/', 'http://mashable.com/2011/05/31/https-web-security/');" rel="nofollow">http://mashable.com/2011/05/31/https-web-security/</a>  I quote:</p>
<p>&#8220;To be clear, sniffing attacks don’t need to grab your password in order to impersonate you. Web apps that use HTTPS for authentication protect your password. If they use regular HTTP after you log in, they’re not protecting your privacy or your temporary identity.&#8221;</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-1157">
<div id="dsq-comment-header-1157" class="dsq-comment-header">
<cite id="dsq-cite-1157">
./                <span id="dsq-author-user-1157">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-1157" class="dsq-comment-body">
<div id="dsq-comment-message-1157" class="dsq-comment-message"><p>Very valid comment. I have added this info to the post itself. Thanks for pointing it out.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-1148">
<div id="dsq-comment-header-1148" class="dsq-comment-header">
<cite id="dsq-cite-1148">
<span id="dsq-author-user-1148">Ward Bell</span>
</cite>
</div>
<div id="dsq-comment-body-1148" class="dsq-comment-body">
<div id="dsq-comment-message-1148" class="dsq-comment-message"><p>Thanks for this abundantly clear example. I do think there are two danger points: (1) clear text user name and (2) home-brew identity management.</p>
<p>1. User name concern</p>
<p>Why do you respect the clear-text value of the user coming from the client. Couldn&#8217;t a rogue client who had authenticated as a non-admin easily poke in the user name of an admin &#8230; and thus be granted admin rights?  </p>
<p>It seems to me that the user name (user_id, whatever one uses to find the app authorization) must be encrypted in the JWT. The conventional place for that is as the {sub: user_id} member; see <a href="https://docs.auth0.com/jwt" onclick="__gaTracker('send', 'event', 'outbound-comment', 'https://docs.auth0.com/jwt', 'https://docs.auth0.com/jwt');" rel="nofollow">https://docs.auth0.com/jwt</a> for example which also recommends other settings for conventional claims (see <a href="http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html#RegisteredClaimName" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html#RegisteredClaimName', 'http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html#RegisteredClaimName');" rel="nofollow">http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html#RegisteredClaimName</a>).</p>
<p>2. Identity Management</p>
<p>I understand that your app (your database) is holding username and password for the simplicity of this example. I would use a real identity provider myself. Roll-your-own authentication is dangerous, IMO and the opinion of folks with far more experience than I have.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-1155">
<div id="dsq-comment-header-1155" class="dsq-comment-header">
<cite id="dsq-cite-1155">
./                <span id="dsq-author-user-1155">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-1155" class="dsq-comment-body">
<div id="dsq-comment-message-1155" class="dsq-comment-message"><p>Hello Ward,</p>
<p>To clarify a few things,</p>
<p>1. This article is just one of the generic solution on how one can go about implementing a secure REST API.<br />
2. To overcome the username concern, apart from encrypting the user_id, you can send in the logged in user&#8217;s UID (<code>1fa2fae0f7a34f8da68fa252f43561e8</code>) along with the username.  If this is also a concern, you can work with a private and public key concept.<br />
3. Completely agree on IDM. If the app is built for a small ideas, then IDM will be an overhead. So DB would suffice. If you already have an Active Directory available, you can always plug it in.  </p>
<p>Again, this is just one of the generic solutions.  </p>
<p>+ Thanks for initiating a discussion on this!</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-3" id="dsq-comment-1159">
<div id="dsq-comment-header-1159" class="dsq-comment-header">
<cite id="dsq-cite-1159">
<span id="dsq-author-user-1159">Ward Bell</span>
</cite>
</div>
<div id="dsq-comment-body-1159" class="dsq-comment-body">
<div id="dsq-comment-message-1159" class="dsq-comment-message"><p>&#8220;Initiating discussion&#8221; is really my point. You&#8217;ve demystified many concepts and mechanics by simplifying. Whether one should actually follow this prescriptively is another matter.</p>
<p>Curious that you didn&#8217;t mention passport (<a href="http://passportjs.org/" onclick="__gaTracker('send', 'event', 'outbound-comment', 'http://passportjs.org/', 'http://passportjs.org/');" rel="nofollow">http://passportjs.org/</a>) which has become a popular (and easy) node module for authentication.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-4" id="dsq-comment-1160">
<div id="dsq-comment-header-1160" class="dsq-comment-header">
<cite id="dsq-cite-1160">
./                <span id="dsq-author-user-1160">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-1160" class="dsq-comment-body">
<div id="dsq-comment-message-1160" class="dsq-comment-message"><p>True that. From a bird&#8217;s eye view, this is more of an awareness on how you can go about secure REST API. A few of these concepts may be helpful when one architect the apps for their startups. </p>
<p>I wanted this example to be a &#8220;from the scratch design and development&#8221;. I would rather leave the decision (of including passport or other IDMs) to the Architect!</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-953">
<div id="dsq-comment-header-953" class="dsq-comment-header">
<cite id="dsq-cite-953">
<span id="dsq-author-user-953">acveer</span>
</cite>
</div>
<div id="dsq-comment-body-953" class="dsq-comment-body">
<div id="dsq-comment-message-953" class="dsq-comment-message"><p>Awesome article Arvind. I applaud your careful attention for laying out things clearly with line numbers. I am a huge fan of your articles as they provide clear &amp; quick intro to web technologies. </p>
<p>Every API request from the &#8220;ngclient&#8221; is actually making 2 requests to the REST app, for example, if the client is making login request, the REST app has 2 calls in the log.<br />
OPTIONS /login 200 0.923 ms &#8211; 2<br />
POST /login 200 27.115 ms &#8211; 211 </p>
<p>Although there are no errors for POST, GET requests are followed with this error, for ex:<br />
For getProducts, I was getting this error on the OPTIONS call<br />
OPTIONS /api/v1/products 200 0.414 ms &#8211; 3<br />
Error: Can&#8217;t set headers after they are sent.<br />
GET /api/v1/products 200 1.939 ms &#8211; 121</p>
<p>After some goggling, I have added the below code to line#17 in server.js resolve this issue. What do you think about it ?</p>
<p>if (req.method == &#8216;OPTIONS&#8217;) {<br />
res.send(200);<br />
}<br />
else {<br />
next();<br />
}</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-959">
<div id="dsq-comment-header-959" class="dsq-comment-header">
<cite id="dsq-cite-959">
./                <span id="dsq-author-user-959">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-959" class="dsq-comment-body">
<div id="dsq-comment-message-959" class="dsq-comment-message"><p>Hello acveer. Thanks! Glad you like it. </p>
<p>If you do notice our API server is on port 3000 and the client is on 2772. This is Cross Origin Resource Sharing scenario. And CORS specs dictate that the client (a web browser in this case) would need to make a pre-flighted request to the server to check if the resource it is trying access is safe. This would be of the type OPTIONS. And once this is a success, we fire the actual API call. That is why you see 2 calls made for fetching a single resource. </p>
<p>Pls. refer here for more info on Preflighted requests : <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#Preflighted_requests" onclick="__gaTracker('send', 'event', 'outbound-comment', 'https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#Preflighted_requests', 'https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#Preflighted_requests');" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#Preflighted_requests</a> </p>
<p>If you do notice Line 11 of <code>server/middlewares/validateRequest.js</code> we have added </p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div id="crayon-5a104183b52e7465226961" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if(req.method == 'OPTIONS') next();
</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a104183b52e7465226961-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a104183b52e7465226961-2">2</div><div class="crayon-num" data-line="crayon-5a104183b52e7465226961-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a104183b52e7465226961-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a104183b52e7465226961-2"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">.</span><span class="crayon-v">method</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'OPTIONS'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">next</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5a104183b52e7465226961-3">&nbsp;</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p></p>
<p>This is to skip authentication/authorization for the requests of type OPTIONS and directly dispatch a 200. I did not observe the errors on the console &#8211; my bad.</p>
<p>And yes, what you have pointed out should be there to avoid the warning/error and dispatch the response even earlier. Thanks for pointing that out. I have updated this post/code accordingly.</p>
<p>Thanks.</p>
</div>
</div>
<ul class="children">
<li class="comment even depth-3" id="dsq-comment-979">
<div id="dsq-comment-header-979" class="dsq-comment-header">
<cite id="dsq-cite-979">
<span id="dsq-author-user-979">acveer</span>
</cite>
</div>
<div id="dsq-comment-body-979" class="dsq-comment-body">
<div id="dsq-comment-message-979" class="dsq-comment-message"><p>Thank you Arvind for the info. on CORS. Did you notice, now the requests are made twice for each call from the client. ex:<br />
OPTIONS /api/v1/products 200 0.275 ms &#8211; &#8211;<br />
OPTIONS /api/v1/products 200 0.332 ms &#8211; &#8211;<br />
GET /api/v1/products 200 0.627 ms &#8211; 91<br />
GET /api/v1/products 200 0.517 ms &#8211; 91</p>
<p>It looks like the browser itself is making the duplicate calls. could not source out why. (also tried your code at github, same issue.)</p>
<p>For my curiosity sake, I wanted to see, if we can avoid pre-flight CORS requests, by adding the access_token in the url and removing it from the header, but no luck here. Do you know any way to avoid pre-flight CORS requests ( reducing calls to increase performance )</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-4" id="dsq-comment-999">
<div id="dsq-comment-header-999" class="dsq-comment-header">
<cite id="dsq-cite-999">
./                <span id="dsq-author-user-999">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-999" class="dsq-comment-body">
<div id="dsq-comment-message-999" class="dsq-comment-message"><p>Hello acveer. Did some quick testing and I did notice that. Not sure why the 2 requests. Let me see if I can debug this. Thanks.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="dsq-comment-935">
<div id="dsq-comment-header-935" class="dsq-comment-header">
<cite id="dsq-cite-935">
<span id="dsq-author-user-935">Omar</span>
</cite>
</div>
<div id="dsq-comment-body-935" class="dsq-comment-body">
<div id="dsq-comment-message-935" class="dsq-comment-message"><p>Great article. Line 24 of server.js why do you pass &#8216;bodyParser.json()&#8217; since it&#8217;s already being used on line 9 &#8216;app.use(bodyParser.json());&#8217;</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-938">
<div id="dsq-comment-header-938" class="dsq-comment-header">
<cite id="dsq-cite-938">
./                <span id="dsq-author-user-938">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-938" class="dsq-comment-body">
<div id="dsq-comment-message-938" class="dsq-comment-message"><p>Thanks and nice catch Omar. Fixed it. (probably a copy paste error).</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-893">
<div id="dsq-comment-header-893" class="dsq-comment-header">
<cite id="dsq-cite-893">
<span id="dsq-author-user-893">Jean-Francois Bouzereau</span>
</cite>
</div>
<div id="dsq-comment-body-893" class="dsq-comment-body">
<div id="dsq-comment-message-893" class="dsq-comment-message"><p>Hello, in index.js, the products.delete and user.delete routes are wrong, they should be declared with a router.delete command.</p>
</div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="dsq-comment-896">
<div id="dsq-comment-header-896" class="dsq-comment-header">
<cite id="dsq-cite-896">
./                <span id="dsq-author-user-896">Arvind Ravulavaru</span>
</cite>
</div>
<div id="dsq-comment-body-896" class="dsq-comment-body">
<div id="dsq-comment-message-896" class="dsq-comment-message"><p>Thanks Jean. Fixed it.</p>
</div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul>
<div class="navigation">
<div class="nav-previous">
<span class="meta-nav">&larr;</span>
&nbsp;                </div>
<div class="nav-next">
<a href="./architecting-a-restful-node-js-app/#comments" >Newer Comments</a>                    &nbsp;<span class="meta-nav">&rarr;</span>
</div>
</div><!-- .navigation -->
</div>
</div>
<script src="/cdn-cgi/scripts/0e574bed/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
var disqus_url = './architecting-a-restful-node-js-app/';
var disqus_identifier = '2043 ./?p=2043';
var disqus_container_id = 'disqus_thread';
var disqus_shortname = 'thejackalofjavascriptcom';
var disqus_title = "Architecting a Secure RESTful Node.js app";
var disqus_config_custom = window.disqus_config;
var disqus_config = function () {
/*
All currently supported events:
onReady: fires when everything is ready,
onNewComment: fires when a new comment is posted,
onIdentify: fires when user is authenticated
*/
this.language = '';
this.callbacks.onReady.push(function () {
// sync comments in the background so we don't block the page
var script = document.createElement('script');
script.async = true;
script.src = '?cf_action=sync_comments&post_id=2043';
var firstScript = document.getElementsByTagName('script')[0];
firstScript.parentNode.insertBefore(script, firstScript);
});
if (disqus_config_custom) {
disqus_config_custom.call(this);
}
};
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript';
dsq.async = true;
dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
</main><!-- #main -->
</div><!-- #primary -->
<div id="secondary" class="widget-area" role="complementary">
<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="./">
<label>
<span class="screen-reader-text">Search for:</span>
<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s">
</label>
<input type="submit" class="search-submit" value="Search">
</form>
</aside><aside id="text-2" class="widget widget_text"><h1 class="widget-title">This is me!!</h1>			<div class="textwidget"><style>
.socl-btn
{
padding: 3px;
background: #f45145;
border-radius: 3px;
color: rgba(255, 255, 255, 0.6) !important;
margin-top: 9px;
display: inline-block;
text-align: center;
width:100%;
-webkit-transition: all 0.2s ease-in-out;
-moz-transition: all 0.2s ease-in-out;
-o-transition: all 0.2s ease-in-out;
transition: all 0.2s ease-in-out;
}
.socl-btn:hover{
color:#fff !important;
}
.lkdin{
background-image: url(./wp-content/uploads/2014/08/l.png);
background-repeat: no-repeat;
background-position: left;
}
.gplus{
background-image: url(./wp-content/uploads/2014/08/g.png);
background-repeat: no-repeat;
background-position: left;
}
.mongodir{
background-image: url(./wp-content/uploads/2014/08/m.png);
background-repeat: no-repeat;
background-position: left;
}
.sitept{
background-image: url(./wp-content/uploads/2014/08/s.png);
background-repeat: no-repeat;
background-position: left;
}
</style>
<img src="./wp-content/uploads/2014/02/030a49b.jpg" alt="Arvind Ravulavaru" style="width: 81px; margin: 0px auto;display: block;border-radius: 45px;"/>
<br/>
<label>
Hello.. I am Arvind Ravulavaru a Full Stack Consultant based out of Hyderabad, India. This blog is my way of giving back to the Javascript Community!</label>
<br/>
<div style="text-align:center;" ><a  href="./portfolio/">Know more about me</a></div>
<br/>
<div  style="text-align:center;">
<a href="https://twitter.com/arvindr21" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://twitter.com/arvindr21', 'Follow @arvindr21');" class="twitter-follow-button" data-show-count="false">Follow @arvindr21</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script> 
<iframe src="http://ghbtns.com/github-btn.html?user=arvindr21&type=follow"
allowtransparency="true" frameborder="0" scrolling="0" width="132" height="20"></iframe><br/><br/>
<a href="http://in.linkedin.com/in/arvindravulavaru" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://in.linkedin.com/in/arvindravulavaru', 'Linked In');" target="_blank"  class="socl-btn lkdin">Linked In</a>
<a href="https://plus.google.com/+ArvindRavulavaru" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://plus.google.com/+ArvindRavulavaru', 'Google Plus');" target="_blank"  class="socl-btn gplus">Google Plus</a><br/>
<a href="http://blog.mongodirector.com/author/arvindr" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://blog.mongodirector.com/author/arvindr', 'Mongo Director');" target="_blank"  class="socl-btn mongodir">Mongo Director</a> <a href="http://www.sitepoint.com/author/aravulavaru/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://www.sitepoint.com/author/aravulavaru/', 'Site Point');" target="_blank"  class="socl-btn sitept">Site Point</a> <br/><br/>
<a href="https://paper.li/arvindr21/1409328222#!headlines/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://paper.li/arvindr21/1409328222#!headlines/', 'Chronicles of the Jackal of Javascript');" target="_blank"  class="socl-btn">Chronicles of the Jackal of Javascript</a>
</div></div>
</aside><aside id="text-5" class="widget widget_text">			<div class="textwidget"><style>
.crm-app, .crm-ext
{
padding: 9px;
background: #787878;
border-radius: 45px;
color: #EFEFEE !important;
margin-top: 9px;
display: inline-block;
text-align: center;
}
</style>
<a href="https://chrome.google.com/webstore/detail/the-jackal-of-javascript/oiaebkkgbicadojhdipjajkhjkeencdm" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://chrome.google.com/webstore/detail/the-jackal-of-javascript/oiaebkkgbicadojhdipjajkhjkeencdm', 'Chrome App');" target ="_blank" class="crm-app">Chrome App</a>
<a href="https://chrome.google.com/webstore/detail/the-jackal-of-javascript/dokdjofgoglghfljkpmmkgfpipgcmjme" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://chrome.google.com/webstore/detail/the-jackal-of-javascript/dokdjofgoglghfljkpmmkgfpipgcmjme', 'Chrome Extension');" target ="_blank" class="crm-ext">Chrome Extension</a></div>
</aside><aside id="text-7" class="widget widget_text"><h1 class="widget-title">Workshops</h1>			<div class="textwidget"><ul>
<li><a href="http://mean-workshop.herokuapp.com" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://mean-workshop.herokuapp.com', 'o/ M.E.A.N. Workshop');" target="_blank">\o/ M.E.A.N. Workshop</a>
</li>
</ul></div>
</aside><aside id="text-6" class="widget widget_text"><h1 class="widget-title">Presentations</h1>			<div class="textwidget"><ul>
<li><a href="http://arvindr21.github.io/ng-overview" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://arvindr21.github.io/ng-overview', 'Overview of Angularjs');" target="_blank">Overview of Angularjs</a>
</li>
<li><a href="http://arvindr21.github.io/howBrowserWorks" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://arvindr21.github.io/howBrowserWorks', 'How Browser Works');" target="_blank">How Browser Works</a>
</li>
<li><a href="http://arvindr21.github.io/WebComponents" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://arvindr21.github.io/WebComponents', 'Web Components');" target="_blank">Web Components</a>
</li>
<li><a href="http://arvindr21.github.io/building-n-Scaffolding" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://arvindr21.github.io/building-n-Scaffolding', 'Modern UI Build Systems and Scaffolding Tools');" target="_blank">Modern UI Build Systems and Scaffolding Tools</a>
</li>
<li><a href="http://arvindr21.github.io/backbonejs" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://arvindr21.github.io/backbonejs', 'Backbonejs');" target="_blank">Backbonejs</a>
</li>
<li><a href="http://arvindr21.github.io/rwd" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://arvindr21.github.io/rwd', 'Responsive Web Design');" target="_blank">Responsive Web Design</a>
</li>
</ul></div>
</aside><aside id="text-3" class="widget widget_text"><h1 class="widget-title">Projects</h1>			<div class="textwidget"><ul><li><a href="./rotten-tomatoes-jquery-rest-client/" target="_blank">Rotten Tomatoes jQuery Rest Client</a>
</li>
<li>
<a href="./uploading-files-made-fun/" target="_blank">blueimp-file-upload-expressjs</a> - A Node Package
</li>
<li>
<a href="http://arvindr21.github.io/lazyboy/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://arvindr21.github.io/lazyboy/', 'lazyboy');" target="_blank">lazyboy</a> - Command line laziness redefined
</li>
<li>
<a href="http://arvindr21.github.io/diskDB/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://arvindr21.github.io/diskDB/', 'diskDB');" target="_blank">diskDB</a> - A Light Weight Disk based JSON Database - A Node Package
</li>
<li>
<a href="https://github.com/search?utf8=%E2%9C%93&q=user%3Aarvindr21+slush&type=Repositories&ref=searchresults" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://github.com/search?utf8=%E2%9C%93&amp;q=user%3Aarvindr21+slush&amp;type=Repositories&amp;ref=searchresults', 'My Slush Generators');" target="_blank">My Slush Generators</a>
</li>
<li>
<a href="https://github.com/search?utf8=%E2%9C%93&q=user%3Aarvindr21+yeoman&type=Repositories&ref=searchresults" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://github.com/search?utf8=%E2%9C%93&amp;q=user%3Aarvindr21+yeoman&amp;type=Repositories&amp;ref=searchresults', 'My Yeoman Generators');" target="_blank">My Yeoman Generators</a>
</li>
<li>
<a href="https://github.com/arvindr21/myWebComponents#mywebcomponents" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://github.com/arvindr21/myWebComponents#mywebcomponents', 'My Web Components');" target="_blank">My Web Components</a>
</li>
<li>
<a href="http://bower.io/search/?q=owner:arvindr21" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://bower.io/search/?q=owner:arvindr21', 'My Bower Packages');" target="_blank">My Bower Packages</a>
</li>
</ul></div>
</aside><aside id="latestseries-2" class="widget widget_latestseries"><h1 class="widget-title">Series</h1>			<ul>
<div class="latest-series"><ul><li><a href="./series/a-reminder-app/" class="series-145" title="Ionic, Twilio and Node Scheduler – A Reminder App">Ionic, Twilio and Node Scheduler – A Reminder App</a></li><li><a href="./series/node-webkit-apps/" class="series-150" title="Node Webkit Apps">Node Webkit Apps</a></li><li><a href="./series/rpi/" class="series-148" title="Raspberry Pi">Raspberry Pi</a></li></ul></div>			</ul>
</aside><aside id="text-4" class="widget widget_text"><h1 class="widget-title">Guest Posts</h1>			<div class="textwidget"><ul>
<li><a href="http://www.sitepoint.com/building-chat-app-node-webkit-firebase-angularjs/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://www.sitepoint.com/building-chat-app-node-webkit-firebase-angularjs/', 'Building a Chat App with node-webkit, Firebase, and AngularJS');" target="_blank">Building a Chat App with node-webkit, Firebase, and AngularJS</a></li>
<li><a href="http://www.sitepoint.com/creating-sentiment-analysis-application-using-node-js/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://www.sitepoint.com/creating-sentiment-analysis-application-using-node-js/', 'Creating a Sentiment Analysis Application Using Node.js');" target="_blank">Creating a Sentiment Analysis Application Using Node.js</a></li>
<li><a href="http://blog.mongodirector.com/implementing-pagination-with-mongodb-express-js-slush/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://blog.mongodirector.com/implementing-pagination-with-mongodb-express-js-slush/', 'Implementing pagination with MongoDB, Express.js &amp; Slush');" target="_blank">Implementing pagination with MongoDB, Express.js & Slush</a></li>
<li><a href="http://www.sitepoint.com/creating-firebase-powered-end-end-ionic-application/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://www.sitepoint.com/creating-firebase-powered-end-end-ionic-application/', 'Creating a Firebase Powered End to End Ionic Application');" target="_blank">Creating a Firebase Powered End to End Ionic Application</a></li>
<li><a href="http://blog.mongodirector.com/getting-started-with-mongodb-and-mongoose/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://blog.mongodirector.com/getting-started-with-mongodb-and-mongoose/', 'Getting started with MongoDB and Mongoose');" target="_blank">Getting started with MongoDB and Mongoose</a></li>
<li><a href="http://blog.mongodirector.com/yeoman-mongoose-and-mongodb/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://blog.mongodirector.com/yeoman-mongoose-and-mongodb/', 'Yeoman, Mongoose and MongoDB');" target="_blank">Yeoman, Mongoose and MongoDB</a></li>
</ul></div>
</aside><aside id="views-2" class="widget widget_views"><h1 class="widget-title">Top5 Posts</h1><ul>
<li><a href="./architecting-a-restful-node-js-app/"  title="Architecting a Secure RESTful Node.js app">Architecting a Secure RESTful Node.js app</a> - 215,319 views</li><li><a href="./getting-started-with-angular-2-0/"  title="Getting Started with Angular 2.0">Getting Started with Angular 2.0</a> - 177,582 views</li><li><a href="./developing-a-mean-app-with-angular-2-0/"  title="Developing a MEAN app with Angular 2.0">Developing a MEAN app with Angular 2.0</a> - 149,713 views</li><li><a href="./getting-started-with-node-webkit-apps/"  title="Node Webkit &ndash; Build Desktop Apps with Node and Web Technologies">Node Webkit &ndash; Build Desktop Apps with Node and Web Technologies</a> - 93,571 views</li><li><a href="./rpi-live-streaming/"  title="Raspberry Pi, Camera and Node.js &ndash; Live Streaming with Websockets #IoT">Raspberry Pi, Camera and Node.js &ndash; Live Streaming with Websockets #IoT</a> - 91,974 views</li></ul>
</aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h1 class="widget-title">Recent Posts</h1>		<ul>
<li>
<a href="./learning-ionic/">Learning Ionic</a>
</li>
<li>
<a href="./electron-wordpress-angular-material-an-offline-viewer/">Electron, WordPress &#038; Angular Material &#8211; An Offline Viewer</a>
</li>
<li>
<a href="./developing-a-mean-app-with-angular-2-0/">Developing a MEAN app with Angular 2.0</a>
</li>
<li>
<a href="./pushbots-and-cordova/">Pushbots and Cordova &#8211; Easy Push Notifications for your app</a>
</li>
<li>
<a href="./getting-started-with-client-side-storage/">Getting Started with Client Side Storage</a>
</li>
</ul>
</aside><aside id="categories-2" class="widget widget_categories"><h1 class="widget-title">Categories</h1>		<ul>
<li class="cat-item cat-item-141"><a href="./architecture/" >Architecture</a> (8)
</li>
<li class="cat-item cat-item-3"><a href="./css/" >CSS</a> (9)
<ul class='children'>
<li class="cat-item cat-item-5"><a href="./css/css3/" >CSS3</a> (6)
</li>
<li class="cat-item cat-item-26"><a href="./css/less/" >LESS</a> (3)
</li>
<li class="cat-item cat-item-55"><a href="./css/sass/" >SASS</a> (1)
</li>
</ul>
</li>
<li class="cat-item cat-item-117"><a href="./database/" >Database</a> (17)
<ul class='children'>
<li class="cat-item cat-item-136"><a href="./database/disk-db/" >Disk DB</a> (6)
</li>
<li class="cat-item cat-item-131"><a href="./database/firebase/" >Firebase</a> (4)
</li>
<li class="cat-item cat-item-118"><a href="./database/mongodb/" >MongoDB</a> (8)
<ul class='children'>
<li class="cat-item cat-item-119"><a href="./database/mongodb/mongolab/" >MongoLab</a> (3)
</li>
<li class="cat-item cat-item-123"><a href="./database/mongodb/monk/" >Monk</a> (1)
</li>
</ul>
</li>
</ul>
</li>
<li class="cat-item cat-item-125"><a href="./deployments/" >Deployments</a> (4)
<ul class='children'>
<li class="cat-item cat-item-126"><a href="./deployments/heroku/" >Heroku</a> (2)
</li>
</ul>
</li>
<li class="cat-item cat-item-135"><a href="./desktop-apps/" >Desktop Apps</a> (8)
</li>
<li class="cat-item cat-item-155"><a href="./dna-analysis/" >DNA Analysis</a> (1)
</li>
<li class="cat-item cat-item-112"><a href="./es6/" >ECMAScript 6</a> (3)
</li>
<li class="cat-item cat-item-162"><a href="./electron-atom-shell/" >Electron (atom shell)</a> (1)
</li>
<li class="cat-item cat-item-25"><a href="./frameworks/" >Frameworks</a> (42)
<ul class='children'>
<li class="cat-item cat-item-160"><a href="./frameworks/angular-2-0/" >Angular 2.0</a> (2)
</li>
<li class="cat-item cat-item-108"><a href="./frameworks/angularjs/" >Angularjs</a> (21)
</li>
<li class="cat-item cat-item-132"><a href="./frameworks/backbonejs/" >Backbonejs</a> (1)
</li>
<li class="cat-item cat-item-105"><a href="./frameworks/bootstrap/" >Bootstrap</a> (9)
</li>
<li class="cat-item cat-item-159"><a href="./frameworks/emberjs/" >Emberjs</a> (1)
</li>
<li class="cat-item cat-item-56"><a href="./frameworks/foundation/" >Foundation</a> (3)
</li>
<li class="cat-item cat-item-110"><a href="./frameworks/framework7/" >Framework7</a> (1)
</li>
<li class="cat-item cat-item-107"><a href="./frameworks/ionic/" >Ionic</a> (11)
</li>
<li class="cat-item cat-item-157"><a href="./frameworks/lumx/" >Lumx</a> (1)
</li>
<li class="cat-item cat-item-138"><a href="./frameworks/mean/" >MEAN</a> (4)
</li>
<li class="cat-item cat-item-116"><a href="./frameworks/meteorjs/" >Meteorjs</a> (1)
</li>
<li class="cat-item cat-item-122"><a href="./frameworks/onsen-ui/" >Onsen UI</a> (2)
</li>
</ul>
</li>
<li class="cat-item cat-item-101"><a href="./git/" >Git</a> (12)
<ul class='children'>
<li class="cat-item cat-item-102"><a href="./git/github/" >GitHub</a> (10)
</li>
</ul>
</li>
<li class="cat-item cat-item-2"><a href="./html/" >HTML</a> (22)
<ul class='children'>
<li class="cat-item cat-item-4"><a href="./html/html5/" >HTML5</a> (21)
<ul class='children'>
<li class="cat-item cat-item-158"><a href="./html/html5/webrtc/" >WebRTC</a> (1)
</li>
<li class="cat-item cat-item-106"><a href="./html/html5/websockets/" >WebSockets</a> (6)
</li>
</ul>
</li>
</ul>
</li>
<li class="cat-item cat-item-137"><a href="./intels-app-ui/" >Intel&#039;s App UI</a> (1)
</li>
<li class="cat-item cat-item-143"><a href="./iot/" >IoT</a> (6)
</li>
<li class="cat-item cat-item-1"><a href="./javascript/" >Javascript</a> (75)
<ul class='children'>
<li class="cat-item cat-item-6"><a href="./javascript/jquery/" >jQuery</a> (14)
</li>
</ul>
</li>
<li class="cat-item cat-item-151"><a href="./material-design/" >Material Design</a> (3)
</li>
<li class="cat-item cat-item-99"><a href="./mobile/" >Mobile</a> (21)
<ul class='children'>
<li class="cat-item cat-item-103"><a href="./mobile/android/" >Android</a> (15)
</li>
<li class="cat-item cat-item-113"><a href="./mobile/firefox-os/" >Firefox OS</a> (2)
</li>
<li class="cat-item cat-item-104"><a href="./mobile/ios/" >iOS</a> (11)
</li>
<li class="cat-item cat-item-100"><a href="./mobile/phonegap/" >PhoneGap</a> (16)
</li>
</ul>
</li>
<li class="cat-item cat-item-149"><a href="./mqtt/" >MQTT</a> (1)
</li>
<li class="cat-item cat-item-163"><a href="./my-books/" >My Books</a> (1)
</li>
<li class="cat-item cat-item-45"><a href="./node/" >Node</a> (60)
<ul class='children'>
<li class="cat-item cat-item-152"><a href="./node/cli/" >CLI</a> (3)
</li>
<li class="cat-item cat-item-121"><a href="./node/expressjs/" >Expressjs</a> (18)
</li>
<li class="cat-item cat-item-156"><a href="./node/genome/" >Genome</a> (1)
</li>
<li class="cat-item cat-item-62"><a href="./node/grunt/" >Grunt</a> (8)
</li>
<li class="cat-item cat-item-124"><a href="./node/koa/" >Koa</a> (1)
</li>
<li class="cat-item cat-item-134"><a href="./node/node-webkit/" >Node Webkit</a> (7)
</li>
<li class="cat-item cat-item-54"><a href="./node/npm/" >NPM</a> (15)
</li>
<li class="cat-item cat-item-120"><a href="./node/restify/" >Restify</a> (3)
</li>
</ul>
</li>
<li class="cat-item cat-item-161"><a href="./push-notifications/" >Push Notifications</a> (1)
</li>
<li class="cat-item cat-item-59"><a href="./quick-and-dirty/" >Quick and Dirty</a> (42)
</li>
<li class="cat-item cat-item-142"><a href="./raspberry-pi/" >Raspberry Pi</a> (9)
</li>
<li class="cat-item cat-item-60"><a href="./setup/" >Setup</a> (60)
</li>
<li class="cat-item cat-item-61"><a href="./testing/" >Testing</a> (5)
<ul class='children'>
<li class="cat-item cat-item-129"><a href="./testing/jasmine/" >Jasmine</a> (1)
</li>
<li class="cat-item cat-item-128"><a href="./testing/protractor/" >Protractor</a> (1)
</li>
<li class="cat-item cat-item-98"><a href="./testing/test-automation/" >Test Automation</a> (1)
</li>
<li class="cat-item cat-item-41"><a href="./testing/tdd/" >Test Driven Developement</a> (2)
</li>
</ul>
</li>
<li class="cat-item cat-item-139"><a href="./third-party-products/" >Third Party Products</a> (4)
<ul class='children'>
<li class="cat-item cat-item-140"><a href="./third-party-products/twilio/" >Twilio</a> (4)
</li>
</ul>
</li>
<li class="cat-item cat-item-58"><a href="./tutorial/" >Tutorial</a> (79)
</li>
<li class="cat-item cat-item-130"><a href="./performance-analysis/" >UI Performance</a> (1)
</li>
<li class="cat-item cat-item-109"><a href="./web-components/" >Web Components</a> (3)
</li>
<li class="cat-item cat-item-133"><a href="./google-web-starter-kit/" >Web Starter Kit</a> (1)
</li>
</ul>
</aside><aside id="archives-2" class="widget widget_archive"><h1 class="widget-title">Archives</h1>		<ul>
<li><a href='./2015/07/'>July 2015</a></li>
<li><a href='./2015/05/'>May 2015</a></li>
<li><a href='./2015/04/'>April 2015</a></li>
<li><a href='./2015/03/'>March 2015</a></li>
<li><a href='./2015/02/'>February 2015</a></li>
<li><a href='./2015/01/'>January 2015</a></li>
<li><a href='./2014/12/'>December 2014</a></li>
<li><a href='./2014/11/'>November 2014</a></li>
<li><a href='./2014/10/'>October 2014</a></li>
<li><a href='./2014/09/'>September 2014</a></li>
<li><a href='./2014/08/'>August 2014</a></li>
<li><a href='./2014/07/'>July 2014</a></li>
<li><a href='./2014/06/'>June 2014</a></li>
<li><a href='./2014/05/'>May 2014</a></li>
<li><a href='./2014/04/'>April 2014</a></li>
<li><a href='./2014/03/'>March 2014</a></li>
<li><a href='./2014/02/'>February 2014</a></li>
</ul>
</aside><aside id="wysija-3" class="widget widget_wysija"><h1 class="widget-title">Inform me about new posts</h1><div class="widget_wysija_cont"><div id="msg-form-wysija-3" class="wysija-msg ajax"></div><form id="form-wysija-3" method="post" action="#wysija" class="widget_wysija">
<p class="wysija-paragraph">
<label>Email <span class="wysija-required">*</span></label>
<input type="text" name="wysija[user][email]" class="wysija-input validate[required,custom[email]]" title="Email"  value="" />
<span class="abs-req">
<input type="text" name="wysija[user][abs][email]" class="wysija-input validated[abs][email]" value="" />
</span>
</p>
<input class="wysija-submit wysija-submit-field" type="submit" value="Subscribe!" />
<input type="hidden" name="form_id" value="1" />
<input type="hidden" name="action" value="save" />
<input type="hidden" name="controller" value="subscribers" />
<input type="hidden" value="1" name="wysija-page" />
<input type="hidden" name="wysija[user_list][list_ids]" value="3" />
</form></div></aside>	</div><!-- #secondary -->
	<script>
var _prum = [['id', '544090ababe53d0e3e76d6ce'],
['mark', 'firstbyte', (new Date()).getTime()]];
(function() {
var s = document.getElementsByTagName('script')[0]
, p = document.createElement('script');
p.async = 'async';
p.src = '//rum-static.pingdom.net/prum.min.js';
s.parentNode.insertBefore(p, s);
})();
</script>
</div><!-- #content -->
<footer id="colophon" class="site-footer" role="contentinfo">
<div class="site-info">
All Rights Reserved
<span class="sep"> | </span>
The Jackal of Javascript
</div><!-- .site-info -->
<div class="rnd-circle" style="
background: black;
width: 10px;
height: 10px;
border-radius: 50%;
"></div>
</footer><!-- #colophon -->
</div><!-- #page -->
<script type='text/javascript'><!--
var seriesdropdown = document.getElementById("orgseries_dropdown");
if (seriesdropdown) {
function onSeriesChange() {
if ( seriesdropdown.options[seriesdropdown.selectedIndex].value != ( 0 || -1 ) ) {
location.href = "./series/"+seriesdropdown.options[seriesdropdown.selectedIndex].value;
}
}
seriesdropdown.onchange = onSeriesChange;
}
--></script>
<script type="text/javascript">
// <![CDATA[
var disqus_shortname = 'thejackalofjavascriptcom';
(function () {
var nodes = document.getElementsByTagName('span');
for (var i = 0, url; i < nodes.length; i++) {
if (nodes[i].className.indexOf('dsq-postid') != -1) {
nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('data-dsqidentifier'));
url = nodes[i].parentNode.href.split('#', 1);
if (url.length == 1) { url = url[0]; }
else { url = url[1]; }
nodes[i].parentNode.href = url + '#disqus_thread';
}
}
var s = document.createElement('script'); 
s.async = true;
s.type = 'text/javascript';
s.src = '//' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
// ]]>
</script>
<div class="scroll-back-to-top-wrapper">
<span class="scroll-back-to-top-inner">
<i class="fa fa-2x fa-arrow-circle-up"></i>
</span>
</div>
<style type="text/css">
#wpfront-notification-bar 
{
background: #242d36;
background: -moz-linear-gradient(top, #242d36 0%, #242d36 100%);
background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#242d36), color-stop(100%,#242d36));
background: -webkit-linear-gradient(top, #242d36 0%,#242d36 100%);
background: -o-linear-gradient(top, #242d36 0%,#242d36 100%);
background: -ms-linear-gradient(top, #242d36 0%,#242d36 100%);
background: linear-gradient(to bottom, #242d36 0%, #242d36 100%);
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#242d36', endColorstr='#242d36',GradientType=0 );
}
#wpfront-notification-bar div.wpfront-message
{
color: #ffffff;
}
#wpfront-notification-bar a.wpfront-button
{
background: #f45145;
background: -moz-linear-gradient(top, #f45145 0%, #f45145 100%);
background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f45145), color-stop(100%,#f45145));
background: -webkit-linear-gradient(top, #f45145 0%,#f45145 100%);
background: -o-linear-gradient(top, #f45145 0%,#f45145 100%);
background: -ms-linear-gradient(top, #f45145 0%,#f45145 100%);
background: linear-gradient(to bottom, #f45145 0%, #f45145 100%);
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f45145', endColorstr='#f45145',GradientType=0 );
color: #ffffff;
}
#wpfront-notification-bar-open-button
{
background-color: #00b7ea;
}
#wpfront-notification-bar  div.wpfront-close 
{
border: 1px solid #555555;
background-color: #555555;
color: #000000;
}
#wpfront-notification-bar  div.wpfront-close:hover 
{
border: 1px solid #aaaaaa;
background-color: #aaaaaa;
}
</style>
<div id="wpfront-notification-bar-spacer"  style="display: none;">
<div id="wpfront-notification-bar-open-button" class="top wpfront-bottom-shadow"></div>
<div id="wpfront-notification-bar" class="wpfront-fixed ">
<div class="wpfront-close">X</div>
<table border="0" cellspacing="0" cellpadding="0">
<tr>
<td>
<div class="wpfront-message">
Learn your way around Ionic framework. Check out Learning Ionic!                     </div>
<div>
<a class="wpfront-button" href="https://www.packtpub.com/application-development/learning-ionic/?utm_source=Jkthejackalofjavascript&utm_medium=referral&utm_campaign=1783552603"  target="_blank" >Buy</a>
</div>
</td>
</tr>
</table>
</div>
</div>
<style type="text/css">
.wpfront-message{line-height:27px; vertical-align:baseline !important;}</style>
<script type="text/javascript">if(typeof wpfront_notification_bar == "function") wpfront_notification_bar({"position":1,"height":0,"fixed_position":"on","animate_delay":0.5,"close_button":true,"button_action_close_bar":false,"auto_close_after":0,"display_after":1,"is_admin_bar_showing":false,"display_open_button":false,"keep_closed":"on","keep_closed_for":1,"position_offset":0,"display_scroll":"on","display_scroll_offset":100});</script><script type='text/javascript' src='./wp-content/plugins/jetpack/modules/photon/photon.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var scrollBackToTop = {"scrollDuration":"500","fadeDuration":"0.5"};
/* ]]> */
</script>
<script type='text/javascript' src='./wp-content/plugins/scroll-back-to-top/assets/js/scroll-back-to-top.js'></script>
<script type='text/javascript' src='./wp-content/plugins/simple-share-buttons-adder/js/ssba.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var viewsCacheL10n = {"admin_ajax_url":".\/wp-admin\/admin-ajax.php","post_id":"2043"};
/* ]]> */
</script>
<script type='text/javascript' src='./wp-content/plugins/wp-postviews/postviews-cache.js'></script>
<script type='text/javascript' src='http://s0.wp.com/wp-content/js/devicepx-jetpack.js'></script>
<script type='text/javascript' src='./wp-content/themes/sorbet/js/menus.js'></script>
<script type='text/javascript' src='./wp-content/themes/sorbet/js/skip-link-focus-fix.js'></script>
<script type='text/javascript' src='./wp-includes/js/comment-reply.min.js'></script>
<script type='text/javascript' src='./wp-content/plugins/lazy-load/js/jquery.sonar.min.js'></script>
<script type='text/javascript' src='./wp-content/plugins/lazy-load/js/lazy-load.js'></script>
<script type='text/javascript' src='./wp-content/plugins/jetpack/_inc/postmessage.js'></script>
<script type='text/javascript' src='./wp-content/plugins/jetpack/_inc/jquery.jetpack-resize.js'></script>
<script type='text/javascript' src='./wp-content/plugins/jetpack/_inc/jquery.inview.js'></script>
<script type='text/javascript' src='./wp-content/plugins/jetpack/modules/likes/queuehandler.js'></script>
<script type='text/javascript' src='./wp-content/plugins/wysija-newsletters/js/validate/languages/jquery.validationEngine-en.js'></script>
<script type='text/javascript' src='./wp-content/plugins/wysija-newsletters/js/validate/jquery.validationEngine.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wysijaAJAX = {"action":"wysija_ajax","controller":"subscribers","ajaxurl":".\/wp-admin\/admin-ajax.php","loadingTrans":"Loading...","is_rtl":""};
var wysijaAJAX = {"action":"wysija_ajax","controller":"subscribers","ajaxurl":".\/wp-admin\/admin-ajax.php","loadingTrans":"Loading...","is_rtl":""};
/* ]]> */
</script>
<script type='text/javascript' src='./wp-content/plugins/wysija-newsletters/js/front-subscribers.js'></script>
<iframe src='http://widgets.wp.com/likes/master.html?ver=20141028#ver=20141028' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
<div id='likes-other-gravatars'><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
<script type="text/javascript">
jQuery.noConflict();
(function( $ ) {
$(function() {
// More code using $ as alias to jQuery
$("area[href*=#],a[href*=#]:not([href=#]):not([href^='#tab']):not([href^='#quicktab']):not([href^='#pane'])").click(function() {
if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
var target = $(this.hash);
target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
if (target.length) {
$('html,body').animate({
scrollTop: target.offset().top - 20  
},900 ,'easeOutQuint');
return false;
}
}
});
});
})(jQuery);	
</script>				
<script type='text/javascript' src='http://stats.wp.com/e-201746.js' async defer></script>
<script type='text/javascript'>
_stq = window._stq || [];
_stq.push([ 'view', {v:'ext',j:'1:3.7',blog:'70838519',post:'2043',tz:'5.5',srv:'thejackalofjavascript.com'} ]);
_stq.push([ 'clickTrackerInit', '70838519', '2043' ]);
</script>
<div id="upprev_box"><h6>Read previous post:</h6><div class="upprev_excerpt"><h5><a href="./maintaining-a-private-npm-registry/" rel="Architecting a Secure RESTful Node.js app">Maintaining a Private NPM registry for your Organization with Sinopia</a></h5><p>Maintaining a Private NPM registry with Sinopia In this post, we will take a quick dig at setting up our...</p></div><a id="upprev_close" href="#" rel="close">Close</a></div><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-47881846-1', 'auto');
ga('send', 'pageview');
</script>
<a style="display:none;" href="http://www.alexa.com/siteinfo/./"><script type="text/javascript" src="http://xslt.alexa.com/site_stats/js/t/a?url=./"></script></a>
</body>
</html><script>if(document.getElementById('to-contents') == null){ } else {var a = document.getElementById('to-contents').getElementsByTagName('a'); for(var i=0; i< a.length;i++){var b = a[i].getAttribute('href').split('#');if(b.length >=2)a[i].setAttribute('href', '#'+b[1]);}}</script>
<script>if(typeof jQuery == 'function'){jQuery('.widgetGuts.shortcode h3').html('Inform Me About New Posts')}</script><!-- WP Fastest Cache file was created in 5.84885287285 seconds, on 18-11-17 14:19:53 -->